<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ç°ä»£æµ®ç”Ÿè®° / Surviving</title>
    <!-- Vue 3 CDN -->
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@400;500;700&family=Orbitron:wght@700&family=Inter:wght@400;500;700&display=swap');
        
        * {
            -webkit-tap-highlight-color: transparent;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Noto Sans SC', sans-serif;
            background: #0a0a0f;
            color: #e0e0e0;
            overscroll-behavior: none;
            user-select: none;
        }
        
        .font-cyber {
            font-family: 'Orbitron', sans-serif;
        }
        
        /* Custom scrollbar */
        ::-webkit-scrollbar {
            width: 4px;
        }
        ::-webkit-scrollbar-track {
            background: #1a1a2e;
        }
        ::-webkit-scrollbar-thumb {
            background: #00f5d4;
            border-radius: 2px;
        }
        
        /* Neon glow effects */
        .neon-cyan {
            box-shadow: 0 0 5px #00f5d4, 0 0 10px #00f5d4, inset 0 0 5px rgba(0, 245, 212, 0.1);
            border: 1px solid #00f5d4;
        }
        .neon-pink {
            box-shadow: 0 0 5px #ff006e, 0 0 10px #ff006e, inset 0 0 5px rgba(255, 0, 110, 0.1);
            border: 1px solid #ff006e;
        }
        .neon-yellow {
            box-shadow: 0 0 5px #ffd60a, 0 0 10px #ffd60a, inset 0 0 5px rgba(255, 214, 10, 0.1);
            border: 1px solid #ffd60a;
        }
        .neon-purple {
            box-shadow: 0 0 5px #9b5de5, 0 0 10px #9b5de5, inset 0 0 5px rgba(155, 93, 229, 0.1);
            border: 1px solid #9b5de5;
        }
        
        .text-glow-cyan {
            text-shadow: 0 0 10px #00f5d4, 0 0 20px #00f5d4;
        }
        .text-glow-pink {
            text-shadow: 0 0 10px #ff006e, 0 0 20px #ff006e;
        }
        
        /* Gradient backgrounds */
        .bg-cyber-gradient {
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%);
        }
        .bg-card-gradient {
            background: linear-gradient(180deg, rgba(26, 26, 46, 0.9) 0%, rgba(15, 15, 30, 0.95) 100%);
        }
        
        /* Animations */
        @keyframes pulse-neon {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }
        .animate-pulse-neon {
            animation: pulse-neon 2s ease-in-out infinite;
        }
        
        @keyframes slide-up {
            from { transform: translateY(100%); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
        .animate-slide-up {
            animation: slide-up 0.3s ease-out;
        }
        
        /* æœˆä»½è¿‡æ¸¡åŠ¨ç”» */
        .month-transition-overlay {
            background: radial-gradient(ellipse at center, rgba(0,0,0,0.95) 0%, rgba(0,0,0,0.8) 100%);
            animation: month-fade-in 0.2s ease-out;
        }
        @keyframes month-fade-in {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        .month-transition-content {
            animation: month-zoom-in 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
        }
        @keyframes month-zoom-in {
            from { 
                transform: scale(0.5); 
                opacity: 0; 
            }
            to { 
                transform: scale(1); 
                opacity: 1; 
            }
        }
        .month-pulse {
            animation: month-pulse-glow 0.8s ease-in-out infinite alternate;
        }
        @keyframes month-pulse-glow {
            from { 
                transform: scale(1); 
                filter: drop-shadow(0 0 10px rgba(0, 255, 255, 0.5));
            }
            to { 
                transform: scale(1.1); 
                filter: drop-shadow(0 0 30px rgba(0, 255, 255, 0.8));
            }
        }
        
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            75% { transform: translateX(5px); }
        }
        .animate-shake {
            animation: shake 0.3s ease-in-out;
        }
        
        /* Price change indicators */
        .price-up {
            color: #00f5d4;
        }
        .price-down {
            color: #ff006e;
        }
        
        /* German Bauhaus style overrides */
        .bauhaus-mode body,
        .bauhaus-mode {
            font-family: 'Inter', sans-serif !important;
        }
        .bauhaus-mode .bg-cyber-gradient {
            background: linear-gradient(180deg, #1a1a1a 0%, #0d0d0d 100%) !important;
        }
        .bauhaus-mode .bg-cyber-card,
        .bauhaus-mode .bg-cyber-darker {
            background: #1a1a1a !important;
        }
        .bauhaus-mode .text-cyber-cyan {
            color: #FFD700 !important; /* German gold */
        }
        .bauhaus-mode .text-cyber-pink {
            color: #DD0000 !important; /* German red */
        }
        .bauhaus-mode .border-cyber-cyan\/20,
        .bauhaus-mode .border-cyber-cyan\/30,
        .bauhaus-mode .border-cyber-cyan\/50 {
            border-color: rgba(255, 215, 0, 0.3) !important;
        }
        .bauhaus-mode .from-cyber-cyan {
            --tw-gradient-from: #FFD700 !important;
        }
        .bauhaus-mode .to-cyber-purple {
            --tw-gradient-to: #DD0000 !important;
        }
        .bauhaus-mode .text-glow-cyan {
            text-shadow: none !important;
        }
        
        /* Safe area for notched phones */
        .safe-top {
            padding-top: env(safe-area-inset-top, 12px);
        }
        .safe-bottom {
            padding-bottom: env(safe-area-inset-bottom, 12px);
        }
        
        /* Touch feedback */
        .touch-feedback:active {
            transform: scale(0.95);
            opacity: 0.8;
        }
        
        /* Modal backdrop */
        .modal-backdrop {
            background: rgba(0, 0, 0, 0.85);
            backdrop-filter: blur(8px);
        }
        
        /* Item card hover */
        .item-card {
            transition: all 0.2s ease;
        }
        .item-card:active {
            transform: scale(0.98);
            border-color: #00f5d4;
        }
        
        /* Progress bar */
        .progress-bar {
            background: linear-gradient(90deg, #00f5d4, #9b5de5);
        }
        
        /* Tab indicator */
        .tab-active {
            background: linear-gradient(180deg, rgba(0, 245, 212, 0.2) 0%, transparent 100%);
            border-top: 2px solid #00f5d4;
        }
        
        /* Slider styling - visible track */
        .slider {
            -webkit-appearance: none;
            appearance: none;
            width: 100%;
            height: 10px;
            border-radius: 5px;
            background: #374151;
            outline: none;
            cursor: pointer;
        }
        
        .slider::-webkit-slider-runnable-track {
            height: 10px;
            border-radius: 5px;
            background: #374151;
        }
        
        .slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 26px;
            height: 26px;
            border-radius: 50%;
            background: linear-gradient(135deg, #00f5d4 0%, #9b5de5 100%);
            cursor: pointer;
            border: 3px solid #fff;
            box-shadow: 0 2px 10px rgba(0, 245, 212, 0.6);
            margin-top: -8px;
            transition: transform 0.15s ease, box-shadow 0.15s ease;
        }
        
        .slider::-webkit-slider-thumb:hover {
            transform: scale(1.1);
            box-shadow: 0 2px 14px rgba(0, 245, 212, 0.9);
        }
        
        .slider::-webkit-slider-thumb:active {
            transform: scale(1.15);
        }
        
        .slider::-moz-range-track {
            height: 10px;
            border-radius: 5px;
            background: #374151;
        }
        
        .slider::-moz-range-thumb {
            width: 26px;
            height: 26px;
            border-radius: 50%;
            background: linear-gradient(135deg, #00f5d4 0%, #9b5de5 100%);
            cursor: pointer;
            border: 3px solid #fff;
            box-shadow: 0 2px 10px rgba(0, 245, 212, 0.6);
        }
    </style>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        cyber: {
                            dark: '#0a0a0f',
                            darker: '#050508',
                            card: '#1a1a2e',
                            cyan: '#00f5d4',
                            pink: '#ff006e',
                            yellow: '#ffd60a',
                            purple: '#9b5de5',
                        }
                    }
                }
            }
        }
    </script>
    <!-- ä¸è’œå­è®¿å®¢ç»Ÿè®¡ -->
    <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    <style>
        /* éšè—çš„ç»Ÿè®¡é¢æ¿æ ·å¼ */
        .admin-stats-panel {
            position: fixed;
            bottom: 80px;
            right: 20px;
            background: rgba(0, 0, 0, 0.9);
            border: 1px solid #00f5d4;
            border-radius: 8px;
            padding: 12px 16px;
            font-size: 12px;
            z-index: 9999;
            box-shadow: 0 0 20px rgba(0, 245, 212, 0.3);
            backdrop-filter: blur(10px);
            transition: all 0.3s ease;
        }
        .admin-stats-panel.hidden {
            opacity: 0;
            pointer-events: none;
            transform: translateY(20px);
        }
        .admin-stats-panel .stat-row {
            display: flex;
            justify-content: space-between;
            gap: 20px;
            padding: 4px 0;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }
        .admin-stats-panel .stat-row:last-child {
            border-bottom: none;
        }
        .admin-stats-panel .stat-label {
            color: #888;
        }
        .admin-stats-panel .stat-value {
            color: #00f5d4;
            font-weight: bold;
        }
        .admin-stats-panel .close-btn {
            position: absolute;
            top: 4px;
            right: 8px;
            color: #666;
            cursor: pointer;
            font-size: 14px;
        }
        .admin-stats-panel .close-btn:hover {
            color: #ff006e;
        }
    </style>
</head>
<body class="min-h-screen bg-cyber-dark overflow-hidden">
    <div id="app"></div>
    
    <!-- éšè—çš„ç®¡ç†å‘˜ç»Ÿè®¡é¢æ¿ (Ctrl+Shift+V æ˜¾ç¤º) -->
    <div id="admin-stats" class="admin-stats-panel hidden">
        <span class="close-btn" onclick="toggleAdminStats()">Ã—</span>
        <div style="margin-bottom: 8px; color: #00f5d4; font-weight: bold;">ğŸ“Š è®¿å®¢ç»Ÿè®¡</div>
        <div class="stat-row">
            <span class="stat-label">æ€»è®¿é—®é‡</span>
            <span class="stat-value" id="busuanzi_value_site_pv">--</span>
        </div>
        <div class="stat-row">
            <span class="stat-label">è®¿å®¢æ•°</span>
            <span class="stat-value" id="busuanzi_value_site_uv">--</span>
        </div>
        <div class="stat-row">
            <span class="stat-label">æœ¬é¡µæµè§ˆ</span>
            <span class="stat-value" id="busuanzi_value_page_pv">--</span>
        </div>
        <div class="stat-row" style="font-size: 10px; color: #555; margin-top: 8px;">
            <span>æŒ‰ Ctrl+Shift+V åˆ‡æ¢æ˜¾ç¤º</span>
        </div>
    </div>
    
    <script>
        // ç®¡ç†å‘˜ç»Ÿè®¡é¢æ¿åˆ‡æ¢
        let adminStatsVisible = false;
        function toggleAdminStats() {
            adminStatsVisible = !adminStatsVisible;
            const panel = document.getElementById('admin-stats');
            if (adminStatsVisible) {
                panel.classList.remove('hidden');
            } else {
                panel.classList.add('hidden');
            }
        }
        
        // ç›‘å¬å¿«æ·é”® Ctrl+Shift+V
        document.addEventListener('keydown', function(e) {
            if (e.ctrlKey && e.shiftKey && e.key === 'V') {
                e.preventDefault();
                toggleAdminStats();
            }
        });
    </script>

    <script>
    const { createApp, ref, reactive, computed, watch, onMounted } = Vue;

    // ==================== DIFFICULTY SYSTEM ====================
    
    // ä¸­æ–‡éš¾åº¦é…ç½®
    const DIFFICULTY_CN = {
        hard: {
            id: 'hard',
            name: 'å°é•‡åšé¢˜å®¶',
            emoji: 'ğŸ”´',
            desc: 'ç‹¬è‡ªåŒ—æ¼‚ï¼Œä»é›¶å¼€å§‹',
            subtitle: 'å¤§å­¦æ¯•ä¸šç‹¬è‡ªæ¥åˆ°å¤§åŸå¸‚ï¼Œç§Ÿæˆ¿ã€æŒ¤åœ°é“ã€996...',
            // æ ¹æ®åŸå¸‚è·å–åˆå§‹èµ„é‡‘ï¼ˆå®¶é‡Œå‡‘çš„+è‡ªå·±æ”’çš„ï¼‰
            getInitialMoney: (cityId) => ({
                beijing: 8000, shanghai: 8000, guangzhou: 12000, shenzhen: 10000,
                hegang: 20000, hangzhou: 12000, chengdu: 15000, hongkong: 5000
            })[cityId] || 10000,
            // æœˆè–ªï¼ˆæ™®é€šæ‰“å·¥äººï¼‰
            getSalary: (cityId) => ({
                beijing: 6000, shanghai: 6500, guangzhou: 5000, shenzhen: 5500,
                hegang: 3000, hangzhou: 5500, chengdu: 4500, hongkong: 8000
            })[cityId] || 5000,
            ownsHouse: false,  // æ— æˆ¿
            storageLevel: 1,
            maxStorage: 20,    // å°ä»“åº“ï¼ˆç§Ÿçš„å°æˆ¿é—´ï¼‰
            needsRent: true,   // éœ€è¦ä»˜æˆ¿ç§Ÿ
            // ç”Ÿæ´»è´¹æ ¹æ®åŸå¸‚æ¶ˆè´¹æ°´å¹³è°ƒæ•´ï¼ˆå¤§åŸå¸‚é«˜ï¼Œå°åŸå¸‚ä½ï¼‰
            // æˆ¿ç§Ÿ+ç”Ÿæ´»è´¹å¯èƒ½>å·¥èµ„ï¼Œæ­¤æ—¶ä¼šè§¦å‘"çœåƒä¿­ç”¨"æœºåˆ¶ï¼ˆé™ä½å®é™…ç”Ÿæ´»è´¹ä½†å¥åº·ä¸‹é™ï¼‰
            // åŒ—äº¬: å·¥èµ„6000, æˆ¿ç§Ÿ5000, æ ‡å‡†ç”Ÿæ´»è´¹1800 â†’ éœ€çœåƒä¿­ç”¨
            // é¹¤å²—: å·¥èµ„3000, æˆ¿ç§Ÿ500, æ ‡å‡†ç”Ÿæ´»è´¹500 â†’ æœˆä½™2000
            getLivingCost: (cityId) => ({
                beijing: 1800, shanghai: 2000, guangzhou: 1200, shenzhen: 1500,
                hegang: 500, hangzhou: 1300, chengdu: 800, hongkong: 2500
            })[cityId] || 1000,
            canBuyHouseMonths: 24, // 24ä¸ªæœˆåæ‰æœ‰è´­æˆ¿èµ„æ ¼
            familyEvents: true, // æœ‰å®¶åº­äº‹ä»¶ï¼ˆè€å®¶æ¥ç”µè¯è¦é’±ï¼‰
            winNetWorth: 100000, // èƒœåˆ©å‡€èµ„äº§é—¨æ§›
            tips: 'é€‚åˆç¡¬æ ¸ç©å®¶ï¼Œä½“éªŒçœŸå®åŒ—æ¼‚ç”Ÿæ´»'
        },
        normal: {
            id: 'normal',
            name: 'æœ¬åœ°é’å¹´',
            emoji: 'ğŸŸ¡',
            desc: 'ä½å®¶é‡Œï¼Œä½†æˆ¿å­è¿˜å¾—è‡ªå·±ä¹°',
            subtitle: 'è™½ç„¶æ²¡æœ‰å¯Œè£•å®¶åº­ï¼Œä½†è‡³å°‘æœ‰ä¸ªè½è„šçš„åœ°æ–¹',
            getInitialMoney: (cityId) => ({
                beijing: 50000, shanghai: 45000, guangzhou: 40000, shenzhen: 45000,
                hegang: 25000, hangzhou: 40000, chengdu: 35000, hongkong: 30000
            })[cityId] || 40000,
            getSalary: (cityId) => ({
                beijing: 12000, shanghai: 13000, guangzhou: 9000, shenzhen: 10000,
                hegang: 4000, hangzhou: 10000, chengdu: 8000, hongkong: 15000
            })[cityId] || 10000,
            ownsHouse: false,  // æ— æˆ¿ä½†ä½çˆ¶æ¯å®¶
            storageLevel: 2,
            maxStorage: 50,    // ä¸­ç­‰ä»“åº“ï¼ˆçˆ¶æ¯å®¶è½¦åº“ï¼‰
            needsRent: false,  // ä½çˆ¶æ¯å®¶ä¸ç”¨æˆ¿ç§Ÿ
            // äº¤ç»™çˆ¶æ¯çš„ç”Ÿæ´»è´¹ï¼ˆä½å®¶é‡Œä½†è¦ç»™å®¶ç”¨ï¼ŒæŒ‰åŸå¸‚æ¶ˆè´¹æ°´å¹³ï¼‰
            // æ™®é€šæ¨¡å¼ä¸ç”¨ä»˜æˆ¿ç§Ÿï¼Œç”Ÿæ´»è´¹æŒ‰åŸå¸‚å¤§å°
            getLivingCost: (cityId) => ({
                beijing: 2500, shanghai: 2800, guangzhou: 1800, shenzhen: 2200,
                hegang: 800, hangzhou: 2000, chengdu: 1200, hongkong: 4000
            })[cityId] || 1500,
            canBuyHouseMonths: 0, // ç«‹å³å¯ä¹°æˆ¿
            familyEvents: false,
            familyLoanAvailable: true, // å¯å‘çˆ¶æ¯å€Ÿé’±
            maxFamilyLoan: (cityId) => ({
                beijing: 100000, shanghai: 100000, guangzhou: 80000, shenzhen: 80000,
                hegang: 20000, hangzhou: 80000, chengdu: 50000, hongkong: 50000
            })[cityId] || 50000,
            winNetWorth: 0,
            tips: 'é€‚åˆæ™®é€šç©å®¶ï¼Œå¹³è¡¡çš„æ¸¸æˆä½“éªŒ'
        },
        easy: {
            id: 'easy',
            name: 'äººç”Ÿèµ¢å®¶',
            emoji: 'ğŸŸ¢',
            desc: 'æŠ•èƒæŠ€æœ¯è¿‡ç¡¬ï¼Œäººç”Ÿå¼€æŒ‚',
            subtitle: 'çˆ¶æ¯åœ¨ä½ æ¯•ä¸šå‰å°±å¸®ä½ ä»˜äº†é¦–ä»˜ï¼Œå·¥ä½œæ˜¯å®¶é‡Œæ‰˜å…³ç³»å®‰æ’çš„',
            getInitialMoney: (cityId) => ({
                beijing: 200000, shanghai: 180000, guangzhou: 150000, shenzhen: 160000,
                hegang: 50000, hangzhou: 150000, chengdu: 120000, hongkong: 100000
            })[cityId] || 150000,
            getSalary: (cityId) => ({
                beijing: 25000, shanghai: 28000, guangzhou: 18000, shenzhen: 20000,
                hegang: 8000, hangzhou: 20000, chengdu: 15000, hongkong: 35000
            })[cityId] || 20000,
            ownsHouse: true,   // æœ‰æˆ¿ï¼ˆå®¶é‡Œé¦–ä»˜ï¼‰
            storageLevel: 3,
            maxStorage: 100,   // å¤§ä»“åº“ï¼ˆè‡ªå®¶è½¦åº“ï¼‰
            needsRent: false,
            // ç”Ÿæ´»è´¹ï¼ˆäººç”Ÿèµ¢å®¶æ¶ˆè´¹æ°´å¹³é«˜ï¼ŒæŒ‰åŸå¸‚æ¶ˆè´¹ç­‰çº§ï¼‰
            // ç®€å•æ¨¡å¼æœ‰æˆ¿æœ‰è½¦ï¼Œç”Ÿæ´»å“è´¨å¥½
            getLivingCost: (cityId) => ({
                beijing: 4000, shanghai: 4500, guangzhou: 3000, shenzhen: 3500,
                hegang: 1500, hangzhou: 3200, chengdu: 2500, hongkong: 6000
            })[cityId] || 3000,
            canBuyHouseMonths: 0,
            familyEvents: false,
            insiderInfo: true, // æœ‰å†…å¹•æ¶ˆæ¯
            winNetWorth: 2000000,
            tips: 'é€‚åˆä¼‘é—²ç©å®¶ï¼Œè½»æ¾ä½“éªŒä¹°å–ä¹è¶£'
        }
    };
    
    // å¾·è¯­éš¾åº¦é…ç½®
    const DIFFICULTY_DE = {
        hard: {
            id: 'hard',
            name: 'Dorfkind',
            emoji: 'ğŸ”´',
            desc: 'Vom Land in die GroÃŸstadt',
            subtitle: 'Nach dem Studium allein in der GroÃŸstadt. WG-Zimmer, Ã¼berfÃ¼llte U-Bahn...',
            getInitialMoney: (cityId) => ({
                berlin: 3000, muenchen: 2500, hamburg: 3000, frankfurt: 2800,
                koeln: 3200, leipzig: 4000, schwarzwald: 4500, chemnitz: 5000
            })[cityId] || 3000,
            getSalary: (cityId) => ({
                berlin: 2200, muenchen: 2800, hamburg: 2400, frankfurt: 2600,
                koeln: 2300, leipzig: 1800, schwarzwald: 2000, chemnitz: 1600
            })[cityId] || 2000,
            ownsHouse: false,
            storageLevel: 1,
            maxStorage: 20,
            needsRent: true,
            // ç”Ÿæ´»è´¹æŒ‰åŸå¸‚å¤§å°ï¼ˆæ…•å°¼é»‘æœ€è´µï¼Œä¸œå¾·åŸå¸‚ä¾¿å®œï¼‰
            getLivingCost: (cityId) => ({
                berlin: 700, muenchen: 900, hamburg: 750, frankfurt: 800,
                koeln: 650, leipzig: 400, schwarzwald: 450, chemnitz: 350
            })[cityId] || 500,
            canBuyHouseMonths: 24,
            familyEvents: true,
            winNetWorth: 50000,
            tips: 'FÃ¼r Hardcore-Spieler'
        },
        normal: {
            id: 'normal',
            name: 'Einheimischer',
            emoji: 'ğŸŸ¡',
            desc: 'Wohnt noch bei Mama',
            subtitle: 'Keine reiche Familie, aber immerhin ein Dach Ã¼ber dem Kopf',
            getInitialMoney: (cityId) => ({
                berlin: 15000, muenchen: 12000, hamburg: 14000, frankfurt: 13000,
                koeln: 14000, leipzig: 18000, schwarzwald: 16000, chemnitz: 20000
            })[cityId] || 15000,
            getSalary: (cityId) => ({
                berlin: 3500, muenchen: 4500, hamburg: 3800, frankfurt: 4200,
                koeln: 3600, leipzig: 2800, schwarzwald: 3000, chemnitz: 2500
            })[cityId] || 3500,
            ownsHouse: false,
            storageLevel: 2,
            maxStorage: 50,
            needsRent: false,
            // ä½çˆ¶æ¯å®¶çš„ç”Ÿæ´»è´¹ï¼ˆæŒ‰åŸå¸‚å¤§å°ï¼‰
            getLivingCost: (cityId) => ({
                berlin: 500, muenchen: 650, hamburg: 550, frankfurt: 600,
                koeln: 500, leipzig: 350, schwarzwald: 400, chemnitz: 300
            })[cityId] || 400,
            canBuyHouseMonths: 0,
            familyEvents: false,
            familyLoanAvailable: true,
            maxFamilyLoan: (cityId) => ({
                berlin: 30000, muenchen: 25000, hamburg: 28000, frankfurt: 27000,
                koeln: 28000, leipzig: 35000, schwarzwald: 32000, chemnitz: 40000
            })[cityId] || 30000,
            winNetWorth: 0,
            tips: 'FÃ¼r normale Spieler'
        },
        easy: {
            id: 'easy',
            name: 'Erbe',
            emoji: 'ğŸŸ¢',
            desc: 'Mit goldenem LÃ¶ffel geboren',
            subtitle: 'Papa hat schon die Anzahlung geleistet, der Job war durch Vitamin B',
            getInitialMoney: (cityId) => ({
                berlin: 80000, muenchen: 70000, hamburg: 75000, frankfurt: 72000,
                koeln: 75000, leipzig: 90000, schwarzwald: 85000, chemnitz: 100000
            })[cityId] || 80000,
            getSalary: (cityId) => ({
                berlin: 6000, muenchen: 8000, hamburg: 6500, frankfurt: 7500,
                koeln: 6200, leipzig: 5000, schwarzwald: 5500, chemnitz: 4500
            })[cityId] || 6000,
            ownsHouse: true,
            storageLevel: 3,
            maxStorage: 100,
            needsRent: false,
            // äººç”Ÿèµ¢å®¶ç”Ÿæ´»è´¹ï¼ˆæŒ‰åŸå¸‚æ¶ˆè´¹æ°´å¹³ï¼‰
            getLivingCost: (cityId) => ({
                berlin: 1200, muenchen: 1600, hamburg: 1300, frankfurt: 1400,
                koeln: 1100, leipzig: 800, schwarzwald: 900, chemnitz: 700
            })[cityId] || 1000,
            canBuyHouseMonths: 0,
            familyEvents: false,
            insiderInfo: true,
            winNetWorth: 500000,
            tips: 'FÃ¼r Casual-Spieler'
        }
    };
    
    // è·å–å½“å‰è¯­è¨€çš„éš¾åº¦é…ç½®
    const getDifficulty = (lang) => lang === 'de' ? DIFFICULTY_DE : DIFFICULTY_CN;
    
    // å›°éš¾æ¨¡å¼ä¸“å±äº‹ä»¶ - ä¸­æ–‡
    const FAMILY_EVENTS_CN = [
        {
            id: 'family_house',
            title: 'ğŸ“± è€å®¶æ¥ç”µè¯äº†',
            desc: 'å®¶é‡Œç›–æˆ¿å­éœ€è¦é’±ï¼Œçˆ¸å¦ˆå¼€å£äº†...',
            effect: (state) => {
                const amount = Math.floor(Math.random() * 15000) + 5000;
                state.money -= amount;
                return `ç»™å®¶é‡Œå¯„äº† Â¥${amount.toLocaleString()}`;
            },
            chance: 0.15,
            yearRange: [2020, 2025]
        },
        {
            id: 'family_medical',
            title: 'ğŸ¥ çˆ¶æ¯ç”Ÿç—…äº†',
            desc: 'åŒ»è¯è´¹éœ€è¦ä½ å¸®å¿™åˆ†æ‹…...',
            effect: (state) => {
                const amount = Math.floor(Math.random() * 30000) + 10000;
                state.money -= amount;
                state.mood = Math.max(0, state.mood - 20);
                return `åŒ»è¯è´¹æ”¯å‡º Â¥${amount.toLocaleString()}ï¼Œå¿ƒæƒ… -20`;
            },
            chance: 0.08,
            yearRange: [2020, 2025]
        },
        {
            id: 'family_wedding',
            title: 'ğŸ’’ äº²æˆšç»“å©š',
            desc: 'è¡¨å¼Ÿ/è¡¨å¦¹ç»“å©šï¼Œå¾—éšä»½å­é’±...',
            effect: (state) => {
                const amount = Math.floor(Math.random() * 1500) + 500;
                state.money -= amount;
                return `éšç¤¼ Â¥${amount.toLocaleString()}`;
            },
            chance: 0.12,
            yearRange: [2020, 2025]
        },
        {
            id: 'family_tuition',
            title: 'ğŸ“ å¼Ÿå¼Ÿ/å¦¹å¦¹å­¦è´¹',
            desc: 'å®¶é‡Œè¿˜æœ‰å¼Ÿå¼Ÿå¦¹å¦¹åœ¨ä¸Šå­¦ï¼Œéœ€è¦å‡‘å­¦è´¹...',
            effect: (state) => {
                const amount = Math.floor(Math.random() * 8000) + 3000;
                state.money -= amount;
                return `å¸®äº¤å­¦è´¹ Â¥${amount.toLocaleString()}`;
            },
            chance: 0.1,
            yearRange: [2020, 2025]
        },
        {
            id: 'rent_increase',
            title: 'ğŸ  æˆ¿ä¸œæ¶¨ç§Ÿ',
            desc: 'æˆ¿ä¸œè¯´ä¸‹ä¸ªæœˆå¼€å§‹æ¶¨æˆ¿ç§Ÿ...',
            effect: (state, _, cityRent) => {
                // æ¶¨ç§Ÿ20%
                return 'ä¸‹ä¸ªæœˆå¼€å§‹æˆ¿ç§Ÿä¸Šæ¶¨20%ï¼';
            },
            chance: 0.1,
            yearRange: [2020, 2025],
            special: 'rent_increase'
        },
        {
            id: 'eviction',
            title: 'ğŸšª è¢«æˆ¿ä¸œèµ¶äº†',
            desc: 'æˆ¿ä¸œè¦å–æˆ¿ï¼Œé™ä½ ä¸€å‘¨æ¬èµ°...',
            effect: (state) => {
                const moveCost = 5000;
                state.money -= moveCost;
                state.mood = Math.max(0, state.mood - 30);
                return `æ¬å®¶è´¹ Â¥${moveCost.toLocaleString()}ï¼Œå¿ƒæƒ… -30`;
            },
            chance: 0.06,
            yearRange: [2020, 2025]
        },
        {
            id: '996_blessing',
            title: 'ğŸ’¼ 996ç¦æŠ¥',
            desc: 'å…¬å¸å¼€å§‹å¼ºåˆ¶åŠ ç­...è€æ¿è¯´è¿™æ˜¯ç¦æŠ¥',
            effect: (state) => {
                state.health = Math.max(0, state.health - 20);
                const bonus = Math.floor(state.salary * 0.3);
                state.money += bonus;
                return `å¥åº· -20ï¼ŒåŠ ç­è´¹ +Â¥${bonus.toLocaleString()}`;
            },
            chance: 0.12,
            yearRange: [2020, 2025]
        },
        {
            id: 'pickpocket',
            title: 'ğŸ’ è¢«å·äº†',
            desc: 'åœ°é“ä¸Šé’±åŒ…è¢«å·äº†...',
            effect: (state) => {
                const loss = Math.floor(Math.random() * 1500) + 500;
                state.money -= loss;
                return `ä¸¢å¤± Â¥${loss.toLocaleString()}`;
            },
            chance: 0.08,
            yearRange: [2020, 2025]
        },
        {
            id: 'annual_bonus',
            title: 'ğŸ’° å¹´ç»ˆå¥–',
            desc: 'ä»Šå¹´æ•ˆç›Šä¸é”™ï¼Œå‘å¹´ç»ˆå¥–äº†ï¼',
            effect: (state) => {
                const bonus = Math.floor(state.salary * 2);
                state.money += bonus;
                state.mood = Math.min(100, state.mood + 20);
                return `å¹´ç»ˆå¥– +Â¥${bonus.toLocaleString()}ï¼Œå¿ƒæƒ… +20`;
            },
            chance: 0.1,
            yearRange: [2020, 2025]
        }
    ];
    
    // å›°éš¾æ¨¡å¼ä¸“å±äº‹ä»¶ - å¾·è¯­
    const FAMILY_EVENTS_DE = [
        {
            id: 'eltern_hilfe',
            title: 'ğŸ“± Anruf von zu Hause',
            desc: 'Die Eltern brauchen UnterstÃ¼tzung...',
            effect: (state) => {
                const amount = Math.floor(Math.random() * 500) + 200;
                state.money -= amount;
                return `An die Familie Ã¼berwiesen: â‚¬${amount}`;
            },
            chance: 0.12,
            yearRange: [2020, 2025]
        },
        {
            id: 'geschwister_ausbildung',
            title: 'ğŸ“ Geschwister-Ausbildung',
            desc: 'Dein Bruder/Schwester braucht Geld fÃ¼r die Ausbildung...',
            effect: (state) => {
                const amount = Math.floor(Math.random() * 400) + 200;
                state.money -= amount;
                return `Ausbildungskosten: â‚¬${amount}`;
            },
            chance: 0.1,
            yearRange: [2020, 2025]
        },
        {
            id: 'mietsteigerung',
            title: 'ğŸ  MieterhÃ¶hung!',
            desc: 'Der Vermieter erhÃ¶ht die Miete...',
            effect: (state) => {
                return 'Miete steigt um 20% ab nÃ¤chstem Monat!';
            },
            chance: 0.1,
            yearRange: [2020, 2025],
            special: 'rent_increase'
        },
        {
            id: 'kuendigung',
            title: 'ğŸšª KÃ¼ndigung!',
            desc: 'Der Vermieter hat Eigenbedarf angemeldet...',
            effect: (state) => {
                const moveCost = 2000;
                state.money -= moveCost;
                state.mood = Math.max(0, state.mood - 30);
                return `Umzugskosten: â‚¬${moveCost}, Stimmung -30`;
            },
            chance: 0.06,
            yearRange: [2020, 2025]
        },
        {
            id: 'ueberstunden',
            title: 'ğŸ’¼ Ãœberstunden',
            desc: 'Der Chef will, dass du mehr arbeitest...',
            effect: (state) => {
                state.health = Math.max(0, state.health - 15);
                const bonus = Math.floor(state.salary * 0.2);
                state.money += bonus;
                return `Gesundheit -15, Ãœberstundengeld +â‚¬${bonus}`;
            },
            chance: 0.12,
            yearRange: [2020, 2025]
        },
        {
            id: 'weihnachtsgeld',
            title: 'ğŸ„ Weihnachtsgeld!',
            desc: 'Du bekommst Weihnachtsgeld!',
            effect: (state) => {
                const bonus = Math.floor(state.salary);
                state.money += bonus;
                state.mood = Math.min(100, state.mood + 15);
                return `Weihnachtsgeld +â‚¬${bonus}, Stimmung +15`;
            },
            chance: 0.1,
            yearRange: [2020, 2025]
        },
        {
            id: 'fahrrad_geklaut',
            title: 'ğŸš² Fahrrad geklaut!',
            desc: 'Jemand hat dein Fahrrad gestohlen...',
            effect: (state) => {
                const loss = Math.floor(Math.random() * 300) + 100;
                state.money -= loss;
                return `Verlust: â‚¬${loss}`;
            },
            chance: 0.08,
            yearRange: [2020, 2025]
        }
    ];
    
    // è·å–å®¶åº­äº‹ä»¶
    const getFamilyEvents = (lang) => lang === 'de' ? FAMILY_EVENTS_DE : FAMILY_EVENTS_CN;

    // ==================== LOCALIZATION SYSTEM ====================
    
    // ä»URLå‚æ•°æˆ–localStorageè·å–è¯­è¨€è®¾ç½®ï¼ˆä¸æ€»ç›®å½•åŒæ­¥ï¼‰
    const getInitialLang = () => {
        // 1. é¦–å…ˆæ£€æŸ¥URLå‚æ•°
        const urlParams = new URLSearchParams(window.location.search);
        const urlLang = urlParams.get('lang');
        if (urlLang === 'de' || urlLang === 'en') return 'de'; // ENä¹Ÿç”¨å¾·è¯­ç‰ˆ
        if (urlLang === 'zh') return 'zh';
        
        // 2. ç„¶åæ£€æŸ¥localStorageï¼ˆä¸æ€»ç›®å½•i18nåŒæ­¥ï¼‰
        const storedLang = localStorage.getItem('app_lang');
        if (storedLang === 'de' || storedLang === 'en') return 'de';
        if (storedLang === 'zh') return 'zh';
        
        // 3. é»˜è®¤ä¸­æ–‡
        return 'zh';
    };
    
    // å½“å‰è¯­è¨€ (zh = ä¸­æ–‡, de = å¾·è¯­)
    const currentLang = ref(getInitialLang());
    
    // åˆå§‹åŒ–æ—¶åº”ç”¨Bauhausæ ·å¼
    if (currentLang.value === 'de') {
        document.body.classList.add('bauhaus-mode');
    }
    
    // åˆ‡æ¢è¯­è¨€
    const toggleLang = () => {
        currentLang.value = currentLang.value === 'zh' ? 'de' : 'zh';
        document.body.classList.toggle('bauhaus-mode', currentLang.value === 'de');
        // åŒæ­¥åˆ°localStorage
        localStorage.setItem('app_lang', currentLang.value);
    };
    
    // è¿”å›ç›®å½•
    const goBackToCatalog = () => {
        window.location.href = '../index.html';
    };
    
    // UIæ–‡æœ¬ç¿»è¯‘
    const T = {
        zh: {
            gameTitle: 'ç°ä»£æµ®ç”Ÿè®°',
            gameSubtitle: '2020 - 2025',
            gameQuote: '"å·å¾—æµ®ç”ŸåŠæ—¥é—²"',
            gameDesc: 'åœ¨æ—¶ä»£çš„æµªæ½®ä¸­ï¼Œä¹°ä½å–é«˜ï¼Œè¿˜æ¸…æˆ¿è´·ï¼Œå®ç°è´¢åŠ¡è‡ªç”±',
            initialFunds: 'åˆå§‹èµ„é‡‘',
            mortgage: 'æˆ¿è´·',
            mortgageDesc: 'æŒ‰æˆ¿ä»·ç®—ï¼ˆæœ€é«˜100ä¸‡ï¼‰',
            mortgageHint: 'é¹¤å²—5ä¸‡æˆ¿è´·æœˆä¾›Â¥268ï¼ŒåŒ—äº¬100ä¸‡æœˆä¾›Â¥5,368',
            duration: 'æ¸¸æˆæ—¶é•¿',
            months: 'ä¸ªæœˆ',
            years: 'å¹´',
            winConditions: 'èƒœåˆ©æ¡ä»¶',
            winCond1: 'åœ¨2025å¹´12æœˆå‰è¿˜æ¸…æˆ¿è´·',
            winCond2: 'å‡€èµ„äº§ä¸ºæ­£æ•°ï¼ˆç°é‡‘+èµ„äº§+æˆ¿äº§-æˆ¿è´·>0ï¼‰',
            loseConditions: 'å¤±è´¥æ¡ä»¶',
            loseCond1: 'å¥åº·å€¼å½’é›¶',
            loseCond2: 'ç ´äº§ï¼ˆç°é‡‘<-10ä¸‡ä¸”æ— èµ„äº§æ— æˆ¿ï¼‰',
            loseCond3: 'æ—¶é—´åˆ°ä½†æˆ¿è´·æœªè¿˜æ¸…æˆ–å‡€èµ„äº§ä¸ºè´Ÿ',
            selectCity: 'é€‰æ‹©èµ·å§‹åŸå¸‚',
            selectCityDesc: 'ä½ å°†åœ¨è¿™é‡Œä¹°æˆ¿å®‰å®¶ï¼Œæˆ¿äº§ä»·å€¼å’Œæˆ¿ç§Ÿå› åŸå¸‚è€Œå¼‚',
            housePrice: 'æˆ¿ä»·',
            loanAmount: 'æˆ¿è´·',
            monthlyPayment: 'æœˆä¾›',
            cityHint: 'æˆ¿è´·æŒ‰å®é™…æˆ¿ä»·è®¡ç®—ï¼ˆæœ€é«˜100ä¸‡ï¼‰',
            warehouse: 'ä»“åº“åœ¨ä½ çš„æˆ¿å­é‡Œï¼Œå¼‚åœ°å–è´§éœ€ä»˜5%è¿è´¹',
            startTip: 'æç¤ºï¼šé€‰æ‹©ä¸€ä¸ªåŸå¸‚ä¹°æˆ¿å®‰å®¶ï¼Œç„¶åå¼€å§‹ä½ çš„å€’ä¹°å€’å–ä¹‹æ—…',
            market: 'å¸‚åœº',
            inventory: 'ä»“åº“',
            actions: 'æ“ä½œ',
            marketTitle: 'å¸‚åœºè¡Œæƒ…',
            marketHint: 'ç‚¹å‡»å•†å“äº¤æ˜“',
            emptyInventory: 'ä»“åº“ç©ºç©ºå¦‚ä¹Ÿ',
            goShop: 'å»å¸‚åœºä¹°ç‚¹ä¸œè¥¿å§ï¼',
            actionCenter: 'æ“ä½œä¸­å¿ƒ',
            moveCity: 'ç§»åŠ¨åŸå¸‚',
            moveCost: 'æ¶ˆè€—1ä¸ªæœˆ',
            hospital: 'å»åŒ»é™¢',
            hospitalCost: 'èŠ±è´¹Â¥5000',
            prepayLoan: 'æå‰è¿˜è´·',
            remaining: 'å‰©ä½™',
            news: 'çœ‹æ–°é—»',
            newsHistory: 'å†å²äº‹ä»¶',
            expandStorage: 'æ‰©å±•ä»“åº“',
            housing: 'æˆ¿äº§ç®¡ç†',
            yourHouse: 'çš„æˆ¿å­',
            endMonth: 'ç»“æŸæœ¬æœˆ',
            nextMonth: 'æ¨è¿›åˆ°ä¸‹ä¸ªæœˆ',
            housingStatus: 'ä½æˆ¿çŠ¶æ€',
            hasHouse: 'æœ‰æˆ¿',
            renting: 'ç§Ÿæˆ¿ä¸­',
            currentValue: 'å½“æœˆå¸‚å€¼',
            basePrice2: 'åŸºå‡†ä»·æ ¼',
            remainingLoan: 'å‰©ä½™æˆ¿è´·',
            houseEquity: 'æˆ¿äº§å‡€å€¼',
            warehouseLocation: 'ä»“åº“ä½ç½®',
            monthlyPmt: 'æ¯æœˆæœˆä¾›',
            loanTerms: '30å¹´æœŸï¼Œå¹´åˆ©ç‡5%',
            cannotSell: 'æˆ¿äº§ä»·å€¼ä¸è¶³ä»¥å¿è¿˜æˆ¿è´·ï¼Œæ— æ³•å‡ºå”®',
            sellWarning: 'å–æˆ¿åä½ å°†å˜æˆæ— æˆ¿æ—ï¼Œéœ€è¦æ¯æœˆæ”¯ä»˜æˆ¿ç§Ÿ',
            sellProceeds: 'å–æˆ¿å¯å¾—',
            currentRent: 'å½“å‰åŸå¸‚æˆ¿ç§Ÿ',
            sellHouse: 'å–æ‰æˆ¿å­',
            netProceeds: 'å‡€å¾—',
            noHouse: 'ä½ ç›®å‰æ²¡æœ‰æˆ¿äº§',
            currentCity: 'å½“å‰åŸå¸‚',
            monthlyRent: 'æ¯æœˆæˆ¿ç§Ÿ',
            changeRentHint: 'æ¢åŸå¸‚å±…ä½ä¼šæ”¹å˜æˆ¿ç§Ÿé‡‘é¢',
            close: 'å…³é—­',
            otherStatus: 'å…¶ä»–çŠ¶æ€',
            mood: 'å¿ƒæƒ…å€¼',
            credit: 'ä¿¡ç”¨åˆ†',
            salary: 'æœˆè–ªæ”¶å…¥',
            moveStatus: 'ç§»åŠ¨çŠ¶æ€',
            canMove: 'å¯ç§»åŠ¨',
            lockdown: 'å°æ§ä¸­',
            buy: 'è´­ä¹°',
            sell: 'å‡ºå”®',
            owned: 'æŒæœ‰',
            avgCost: 'å‡ä»·',
            buyAmount: 'è´­ä¹°æ•°é‡',
            buyAll: 'å…¨éƒ¨ä¹°å…¥',
            unitPrice: 'å•ä»·',
            totalCost: 'æ€»ä»·',
            availableFunds: 'å¯ç”¨èµ„é‡‘',
            confirmBuy: 'ç¡®è®¤è´­ä¹°',
            sellAmount: 'å‡ºå”®æ•°é‡',
            sellAll: 'å…¨éƒ¨å‡ºå”®',
            costPrice: 'æˆæœ¬ä»·',
            sellPrice: 'å–å‡ºä»·',
            transportFee: 'è¿è¾“è´¹',
            expectedProfit: 'å®é™…ç›ˆäº',
            confirmSell: 'ç¡®è®¤å‡ºå”®',
            cancel: 'å–æ¶ˆ',
            selectDest: 'é€‰æ‹©ç›®çš„åœ°',
            moveTime: 'ç§»åŠ¨å°†æ¶ˆè€—1ä¸ªæœˆæ—¶é—´',
            hospitalTitle: 'å»åŒ»é™¢',
            healthLow: 'å¥åº·è¿‡ä½ä¼šå½±å“å·¥ä½œæ•ˆç‡',
            currentHealth: 'å½“å‰å¥åº·',
            healCost: 'æ²»ç–—è´¹ç”¨',
            heal: 'æ²»ç–—',
            prepayTitle: 'æå‰è¿˜è´·',
            currentLoan: 'å‰©ä½™æˆ¿è´·',
            currentPmt: 'å½“å‰æœˆä¾›',
            availableFunds2: 'å¯ç”¨èµ„é‡‘',
            prepayHint: 'æå‰è¿˜è´·å¯å‡å°‘åˆ©æ¯æ”¯å‡ºï¼Œæå‰è¿˜æ¸…æˆ¿è´·æ˜¯èƒœåˆ©æ¡ä»¶ä¹‹ä¸€',
            loanCleared: 'æˆ¿è´·å·²è¿˜æ¸…ï¼',
            keepEarning: 'ç»§ç»­èµšé’±å¢åŠ å‡€èµ„äº§å§ï¼',
            payAll: 'è¿˜æˆ‘æ‰€æœ‰',
            payOff: 'å…¨éƒ¨è¿˜æ¸…',
            newsTitle: 'æ–°é—»å†å²',
            noNews: 'æš‚æ— æ–°é—»',
            storageTitle: 'æ‰©å±•ä»“åº“',
            currentStorage: 'å½“å‰å®¹é‡',
            usedStorage: 'å·²ä½¿ç”¨',
            nextLevel: 'ä¸‹ä¸€çº§',
            upgradeCost: 'å‡çº§è´¹ç”¨',
            upgrade: 'å‡çº§',
            maxStorage: 'å·²è¾¾æœ€å¤§å®¹é‡',
            money: 'èµ„é‡‘',
            loan: 'æˆ¿è´·',
            health: 'å¥åº·',
            storage: 'ä»“åº“',
            remainingMonths: 'å‰©ä½™',
            gameOver: 'æ¸¸æˆç»“æŸ',
            finalMoney: 'æœ€ç»ˆèµ„é‡‘',
            finalLoan: 'å‰©ä½™æˆ¿è´·',
            finalHouseValue: 'æˆ¿äº§å‡€å€¼',
            finalNetWorth: 'æ€»å‡€èµ„äº§',
            restart: 'é‡æ–°å¼€å§‹',
            youWin: 'è´¢åŠ¡è‡ªç”±ï¼',
            winMsg: 'æ­å–œä½ åœ¨6å¹´å†…è¿˜æ¸…æˆ¿è´·ï¼Œå®ç°äº†è´¢åŠ¡è‡ªç”±ï¼',
            yourHouse2: 'æˆ¿äº§',
            playAgain: 'å†æ¥ä¸€å±€',
            currency: 'Â¥',
            transportWarning: 'å¼‚åœ°å‡ºå”®éœ€ä»˜è¿è¾“è´¹',
            warehouseAt: 'ä»“åº“åœ¨',
            currentAt: 'å½“å‰åœ¨',
            transportRate: 'è¿è´¹ï¼šè´§å€¼çš„',
            toastEarn: 'èµšäº†',
            toastLose: 'äºäº†',
            toastBought: 'ä¹°å…¥',
            toastSold: 'å–å‡º',
            toastTransport: 'è¿è´¹',
            healthZero: 'ä½ çš„å¥åº·å€¼å½’é›¶äº†...',
            bankrupt: 'ä½ ç ´äº§äº†ï¼Œæ— å®¶å¯å½’...',
            timeUp: '6å¹´ç»“æŸäº†',
            loanRemain: 'æˆ¿è´·è¿˜å‰©',
            negativeWorth: 'å‡€èµ„äº§ä¸ºè´Ÿ',
            netWorth: 'å‡€èµ„äº§',
            freeHealthcare: '',
            // æ¨¡æ€æ¡†å’Œç•Œé¢æ–‡æœ¬
            myInventory: 'æˆ‘çš„ä»“åº“',
            slots: 'æ ¼',
            warehouseLocated: 'ä»“åº“ä½äº',
            remoteWarning: 'å¼‚åœ°å–è´§éœ€ä»˜5%è¿è´¹',
            emptyWarehouse: 'ä»“åº“ç©ºç©ºå¦‚ä¹Ÿ',
            goShopping: 'å»å¸‚åœºä¹°ç‚¹ä¸œè¥¿å§ï¼',
            quantity: 'æ•°é‡',
            space: 'å ç”¨',
            currentPrice: 'ç°ä»·',
            cost: 'æˆæœ¬',
            value: 'ç°å€¼',
            profitLoss: 'ç›ˆäº',
            totalCostSum: 'æ€»æˆæœ¬',
            totalValueSum: 'æ€»ç°å€¼',
            totalProfitLoss: 'æ€»ç›ˆäº',
            propertyStatus: 'æˆ¿äº§çŠ¶æ€',
            hasProperty: 'æœ‰æˆ¿',
            isRenting: 'ç§Ÿæˆ¿ä¸­',
            monthlyPayOrRent: 'æ¯æœˆ',
            paymentText: 'æœˆä¾›',
            rentText: 'æˆ¿ç§Ÿ',
            otherStats: 'å…¶ä»–çŠ¶æ€',
            moodValue: 'å¿ƒæƒ…å€¼',
            creditScore: 'ä¿¡ç”¨åˆ†',
            salaryIncome: 'æœˆè–ªæ”¶å…¥',
            iKnow: 'æˆ‘çŸ¥é“äº†',
            selectDestination: 'é€‰æ‹©ç›®çš„åœ°',
            travelCostTime: 'ç§»åŠ¨å°†æ¶ˆè€—1ä¸ªæœˆæ—¶é—´',
            hospitalTitle2: 'åŒ»é™¢',
            currentHealthIs: 'å½“å‰å¥åº·å€¼',
            healDescription: 'èŠ±è´¹æ¢å¤40ç‚¹å¥åº·',
            prepayModalTitle: 'æå‰è¿˜è´·',
            prepayTip: 'æå‰è¿˜è´·å¯å‡å°‘åˆ©æ¯æ”¯å‡ºï¼Œæå‰è¿˜æ¸…æˆ¿è´·æ˜¯èƒœåˆ©æ¡ä»¶ä¹‹ä¸€',
            loanClearedMsg: 'æˆ¿è´·å·²è¿˜æ¸…ï¼',
            keepEarningMsg: 'ç»§ç»­èµšé’±å¢åŠ å‡€èµ„äº§å§ï¼',
            repayPrefix: 'è¿˜',
            repayAllMy: 'è¿˜æˆ‘æ‰€æœ‰',
            repayComplete: 'å…¨éƒ¨è¿˜æ¸…',
            housingManage: 'æˆ¿äº§ç®¡ç†',
            propertyLocation: 'æˆ¿äº§ä½ç½®',
            monthlyMarketValue: 'å½“æœˆå¸‚å€¼',
            basePrice3: 'åŸºå‡†ä»·æ ¼',
            warehouseLocationLabel: 'ä»“åº“ä½ç½®',
            monthlyMortgage: 'æ¯æœˆæœˆä¾›',
            loanTermsDetail: '30å¹´æœŸï¼Œå¹´åˆ©ç‡5%',
            sellHouseWarning: 'å–æˆ¿åä½ å°†å˜æˆæ— æˆ¿æ—ï¼Œéœ€è¦æ¯æœˆæ”¯ä»˜æˆ¿ç§Ÿ',
            sellHouseProceeds: 'å–æˆ¿å¯å¾—',
            currentCityRent: 'å½“å‰åŸå¸‚æˆ¿ç§Ÿ',
            sellHouseBtn: 'å–æ‰æˆ¿å­',
            netProceedsLabel: 'å‡€å¾—',
            cannotSellHouse: 'æˆ¿äº§ä»·å€¼ä¸è¶³ä»¥å¿è¿˜æˆ¿è´·ï¼Œæ— æ³•å‡ºå”®',
            noPropertyNow: 'ä½ ç›®å‰æ²¡æœ‰æˆ¿äº§',
            currentCityLabel: 'å½“å‰åŸå¸‚',
            monthlyRentLabel: 'æ¯æœˆæˆ¿ç§Ÿ',
            rentChangeHint: 'æ¢åŸå¸‚å±…ä½ä¼šæ”¹å˜æˆ¿ç§Ÿé‡‘é¢',
            newsHistoryTitle: 'æ–°é—»å†å²',
            noNewsYet: 'æš‚æ— æ–°é—»',
            storageUpgradeTitle: 'ä»“åº“å‡çº§',
            currentStorageLabel: 'å½“å‰ä»“åº“',
            capacityLabel: 'å®¹é‡',
            upgradeToNextLevel: 'å‡çº§åˆ°ä¸‹ä¸€çº§ï¼š',
            upgradeFee: 'å‡çº§è´¹ç”¨',
            maxLevelReached: 'å·²è¾¾åˆ°æœ€é«˜ç­‰çº§ï¼',
            allStorageLevels: 'æ‰€æœ‰ä»“åº“ç­‰çº§ï¼š',
            // éš¾åº¦ç³»ç»Ÿ
            selectDifficulty: 'é€‰æ‹©éš¾åº¦',
            selectDifficultyDesc: 'ä¸åŒçš„å‡ºèº«ï¼Œä¸åŒçš„äººç”Ÿ',
            difficultyHard: 'å°é•‡åšé¢˜å®¶',
            difficultyNormal: 'æœ¬åœ°é’å¹´',
            difficultyEasy: 'äººç”Ÿèµ¢å®¶',
            noHouse: 'æ— æˆ¿ï¼ˆç§Ÿæˆ¿ï¼‰',
            hasHouseLabel: 'æœ‰æˆ¿ï¼ˆå®¶é‡Œé¦–ä»˜ï¼‰',
            livesWithParents: 'ä½çˆ¶æ¯å®¶',
            salaryLabel: 'æœˆè–ª',
            livingCostLabel: 'ç”Ÿæ´»è´¹',
            rentLabel: 'æˆ¿ç§Ÿ',
            storageLabel: 'ä»“åº“',
            familyEventsLabel: 'å®¶åº­äº‹ä»¶',
            yes: 'æ˜¯',
            no: 'å¦',
            needWorkMonths: 'å·¥ä½œæ»¡{n}ä¸ªæœˆå¯ä¹°æˆ¿',
            canBuyNow: 'ç«‹å³å¯ä¹°æˆ¿',
            back: 'â† è¿”å›',
            rentMultiplier: 'æˆ¿ç§Ÿä¸Šæ¶¨ä¸­',
            monthsWorked: 'å·¥ä½œ',
            monthsUnit: 'ä¸ªæœˆ',
            buyHouseBtn: 'è´­ä¹°æˆ¿äº§',
            buyHouseNotQualified: 'éœ€è¦{n}ä¸ªæœˆå·¥ä½œç»éªŒæ‰èƒ½ä¹°æˆ¿',
            buyHouseSuccess: 'æ­å–œè´­æˆ¿ï¼å¼€å§‹è¿˜è´·æ¬¾å§ï¼',
            familyLoanBtn: 'å‘çˆ¶æ¯å€Ÿé’±',
            familyLoanMax: 'æœ€å¤šå¯å€Ÿ',
            familyLoanAmount: 'å€Ÿæ¬¾é‡‘é¢',
            familyLoanConfirm: 'ç¡®è®¤å€Ÿæ¬¾',
            familyLoanOwed: 'æ¬ çˆ¶æ¯',
            familyLoanRepay: 'è¿˜é’±ç»™çˆ¶æ¯',
            // é€€å‡ºæ¸¸æˆ
            exitGame: 'é€€å‡ºæ¸¸æˆ',
            exitConfirmTitle: 'é€€å‡ºæ¸¸æˆ',
            exitConfirmMsg: 'ç¡®å®šè¦é€€å‡ºå—ï¼Ÿ',
            exitWithSave: 'ä¿å­˜å¹¶é€€å‡º',
            exitWithoutSave: 'ä¸ä¿å­˜é€€å‡º',
            cancelExit: 'å–æ¶ˆ',
            // å­˜æ¡£ç³»ç»Ÿ
            backToCatalog: 'â† è¿”å›ç›®å½•',
            gameSaved: 'âœ… æ¸¸æˆå·²ä¿å­˜',
            gameLoaded: 'âœ… å­˜æ¡£å·²åŠ è½½',
            noSaveFound: 'âŒ æ²¡æœ‰æ‰¾åˆ°å­˜æ¡£',
            loadError: 'âŒ åŠ è½½å­˜æ¡£å¤±è´¥',
            saveDeleted: 'ğŸ—‘ï¸ å­˜æ¡£å·²åˆ é™¤',
            continueGame: 'ğŸ“‚ ç»§ç»­æ¸¸æˆ',
            newGame: 'ğŸ® æ–°æ¸¸æˆ',
            saveGame: 'ğŸ’¾ ä¿å­˜æ¸¸æˆ',
            loadGameBtn: 'ğŸ“‚ åŠ è½½å­˜æ¡£',
            deleteSaveBtn: 'ğŸ—‘ï¸ åˆ é™¤å­˜æ¡£',
        },
        de: {
            gameTitle: 'Surviving',
            gameSubtitle: '2020 - 2025',
            gameQuote: '"Das Leben ist kein Ponyhof"',
            gameDesc: 'Handle klug, zahle deine Schulden ab und erreiche finanzielle Freiheit!',
            initialFunds: 'Startkapital',
            mortgage: 'Hypothek',
            mortgageDesc: 'Nach Hauspreis (max. 500kâ‚¬)',
            mortgageHint: 'Chemnitz 50kâ‚¬ = 268â‚¬/Monat, Berlin 500kâ‚¬ = 2.684â‚¬/Monat',
            duration: 'Spieldauer',
            months: ' Monate',
            years: ' Jahre',
            winConditions: 'Siegbedingungen',
            winCond1: 'Hypothek bis Dezember 2025 abbezahlen',
            winCond2: 'Positives NettovermÃ¶gen (Geld+Waren+Haus-Schulden>0)',
            loseConditions: 'Niederlage',
            loseCond1: 'Gesundheit auf Null',
            loseCond2: 'Bankrott (Geld<-10kâ‚¬ und keine Waren)',
            loseCond3: 'Zeit abgelaufen mit Schulden oder neg. VermÃ¶gen',
            selectCity: 'WÃ¤hle deine Stadt',
            selectCityDesc: 'Hier wirst du wohnen. Hauspreise und Mieten variieren.',
            housePrice: 'Hauspreis',
            loanAmount: 'Kredit',
            monthlyPayment: 'Rate',
            cityHint: 'Kredit = Hauspreis (max. 500kâ‚¬)',
            warehouse: 'Lager ist zu Hause. Verkauf in anderen StÃ¤dten = 5% Transportkosten',
            startTip: 'Tipp: WÃ¤hle eine Stadt, kaufe ein Haus und starte dein Handelsabenteuer!',
            market: 'Markt',
            inventory: 'Lager',
            actions: 'Aktionen',
            marketTitle: 'Marktpreise',
            marketHint: 'Zum Handeln klicken',
            emptyInventory: 'Lager ist leer',
            goShop: 'Geh zum Markt und kaufe etwas!',
            actionCenter: 'Aktionszentrum',
            moveCity: 'Stadt wechseln',
            moveCost: 'Kostet 1 Monat',
            hospital: 'Zum Arzt',
            hospitalCost: 'Kostenlos! ğŸ‡©ğŸ‡ª',
            prepayLoan: 'Sondertilgung',
            remaining: 'Restschuld',
            news: 'Nachrichten',
            newsHistory: 'Ereignisse',
            expandStorage: 'Lager erweitern',
            housing: 'Immobilien',
            yourHouse: ' (Eigentum)',
            endMonth: 'Monat beenden',
            nextMonth: 'Zum nÃ¤chsten Monat',
            housingStatus: 'Wohnsituation',
            hasHouse: 'Eigentum in',
            renting: 'Zur Miete',
            currentValue: 'Aktueller Wert ğŸ“ˆ',
            basePrice2: 'Basispreis',
            remainingLoan: 'Restschuld',
            houseEquity: 'Eigenkapital',
            warehouseLocation: 'Lagerort',
            monthlyPmt: 'Monatsrate',
            loanTerms: '30 Jahre, 5% Zinsen',
            cannotSell: 'Hauswert deckt Restschuld nicht - Verkauf nicht mÃ¶glich',
            sellWarning: 'Nach Verkauf musst du Miete zahlen!',
            sellProceeds: 'VerkaufserlÃ¶s',
            currentRent: 'Miete hier',
            sellHouse: 'Haus verkaufen',
            netProceeds: 'Netto',
            noHouse: 'Du besitzt keine Immobilie',
            currentCity: 'Aktueller Standort',
            monthlyRent: 'Monatsmiete',
            changeRentHint: 'Umzug Ã¤ndert die Miete',
            close: 'SchlieÃŸen',
            otherStatus: 'Weitere Stats',
            mood: 'Stimmung',
            credit: 'Schufa',
            salary: 'Gehalt',
            moveStatus: 'MobilitÃ¤t',
            canMove: 'Kann reisen',
            lockdown: 'Streik!',
            buy: 'Kaufen',
            sell: 'Verkaufen',
            owned: 'Besitz',
            avgCost: 'Ã˜ Preis',
            buyAmount: 'Kaufmenge',
            buyAll: 'Alles kaufen',
            unitPrice: 'StÃ¼ckpreis',
            totalCost: 'Gesamtpreis',
            availableFunds: 'VerfÃ¼gbar',
            confirmBuy: 'Kaufen bestÃ¤tigen',
            sellAmount: 'Verkaufsmenge',
            sellAll: 'Alles verkaufen',
            costPrice: 'Einkaufspreis',
            sellPrice: 'Verkaufspreis',
            transportFee: 'Transport (5%)',
            expectedProfit: 'Gewinn/Verlust',
            confirmSell: 'Verkauf bestÃ¤tigen',
            cancel: 'Abbrechen',
            selectDest: 'Reiseziel wÃ¤hlen',
            moveTime: 'Reise dauert 1 Monat',
            hospitalTitle: 'Arztbesuch',
            healthLow: 'Niedrige Gesundheit beeinflusst dich!',
            currentHealth: 'Gesundheit',
            healCost: 'Behandlung',
            heal: 'Behandeln',
            prepayTitle: 'Sondertilgung',
            currentLoan: 'Restschuld',
            currentPmt: 'Monatsrate',
            availableFunds2: 'VerfÃ¼gbar',
            prepayHint: 'Sondertilgung spart Zinsen! Schuldenfreiheit = Sieg',
            loanCleared: 'Hypothek abbezahlt! ğŸ‰',
            keepEarning: 'Weiter VermÃ¶gen aufbauen!',
            payAll: 'Alles zahlen',
            payOff: 'Komplett tilgen',
            newsTitle: 'Nachrichten',
            noNews: 'Keine Nachrichten',
            storageTitle: 'Lager erweitern',
            currentStorage: 'KapazitÃ¤t',
            usedStorage: 'Belegt',
            nextLevel: 'NÃ¤chste Stufe',
            upgradeCost: 'Upgrade-Kosten',
            upgrade: 'Erweitern',
            maxStorage: 'Maximale KapazitÃ¤t erreicht',
            money: 'Geld',
            loan: 'Schulden',
            health: 'Gesundheit',
            storage: 'Lager',
            remainingMonths: 'Noch',
            gameOver: 'Spiel vorbei',
            finalMoney: 'Endguthaben',
            finalLoan: 'Restschuld',
            finalHouseValue: 'Hauswert',
            finalNetWorth: 'NettovermÃ¶gen',
            restart: 'Neustart',
            youWin: 'Finanzielle Freiheit!',
            winMsg: 'GlÃ¼ckwunsch! Du hast in 6 Jahren deine Schulden abbezahlt!',
            yourHouse2: 'Immobilie',
            playAgain: 'Nochmal spielen',
            currency: 'â‚¬',
            transportWarning: 'Fernverkauf = Transportkosten',
            warehouseAt: 'Lager in',
            currentAt: 'Du bist in',
            transportRate: 'Transport:',
            toastEarn: 'Gewinn',
            toastLose: 'Verlust',
            toastBought: 'Gekauft',
            toastSold: 'Verkauft',
            toastTransport: 'Transport',
            healthZero: 'Deine Gesundheit ist am Ende...',
            bankrupt: 'Du bist pleite und obdachlos...',
            timeUp: '6 Jahre vorbei',
            loanRemain: 'Restschuld',
            negativeWorth: 'Negatives VermÃ¶gen',
            netWorth: 'NettovermÃ¶gen',
            freeHealthcare: 'Krankenversicherung zahlt! ğŸ¥',
            // æ¨¡æ€æ¡†å’Œç•Œé¢æ–‡æœ¬
            myInventory: 'Mein Lager',
            slots: ' PlÃ¤tze',
            warehouseLocated: 'Lager in',
            remoteWarning: 'Fernverkauf = 5% Transport',
            emptyWarehouse: 'Lager ist leer',
            goShopping: 'Geh zum Markt einkaufen!',
            quantity: 'Menge',
            space: 'Platz',
            currentPrice: 'Aktuell',
            cost: 'Kosten',
            value: 'Wert',
            profitLoss: 'Gewinn',
            totalCostSum: 'Gesamtkosten',
            totalValueSum: 'Gesamtwert',
            totalProfitLoss: 'Gesamtgewinn',
            propertyStatus: 'Immobilienstatus',
            hasProperty: 'Eigentum',
            isRenting: 'Zur Miete',
            monthlyPayOrRent: 'Monatlich',
            paymentText: 'Rate',
            rentText: 'Miete',
            otherStats: 'Weitere Stats',
            moodValue: 'Stimmung',
            creditScore: 'Schufa',
            salaryIncome: 'Gehalt',
            iKnow: 'Verstanden',
            selectDestination: 'Reiseziel wÃ¤hlen',
            travelCostTime: 'Reise dauert 1 Monat',
            hospitalTitle2: 'Arztpraxis',
            currentHealthIs: 'Gesundheit',
            healDescription: 'Behandlung stellt 40 Punkte her',
            prepayModalTitle: 'Sondertilgung',
            prepayTip: 'Sondertilgung spart Zinsen! Schuldenfreiheit = Sieg',
            loanClearedMsg: 'Hypothek abbezahlt! ğŸ‰',
            keepEarningMsg: 'Weiter VermÃ¶gen aufbauen!',
            repayPrefix: 'Zahlen',
            repayAllMy: 'Alles zahlen',
            repayComplete: 'Komplett tilgen',
            housingManage: 'Immobilienverwaltung',
            propertyLocation: 'Standort',
            monthlyMarketValue: 'Marktwert ğŸ“ˆ',
            basePrice3: 'Basispreis',
            warehouseLocationLabel: 'Lagerort',
            monthlyMortgage: 'Monatsrate',
            loanTermsDetail: '30 Jahre, 5% Zinsen',
            sellHouseWarning: 'Nach Verkauf musst du Miete zahlen!',
            sellHouseProceeds: 'VerkaufserlÃ¶s',
            currentCityRent: 'Miete hier',
            sellHouseBtn: 'Haus verkaufen',
            netProceedsLabel: 'Netto',
            cannotSellHouse: 'Hauswert deckt Schulden nicht',
            noPropertyNow: 'Keine Immobilie',
            currentCityLabel: 'Aktueller Standort',
            monthlyRentLabel: 'Monatsmiete',
            rentChangeHint: 'Umzug Ã¤ndert Mietkosten',
            newsHistoryTitle: 'Nachrichten',
            noNewsYet: 'Keine Nachrichten',
            storageUpgradeTitle: 'Lager-Upgrade',
            currentStorageLabel: 'Aktuelles Lager',
            capacityLabel: 'KapazitÃ¤t',
            upgradeToNextLevel: 'NÃ¤chste Stufe:',
            upgradeFee: 'Upgrade-Kosten',
            maxLevelReached: 'Maximale Stufe erreicht!',
            allStorageLevels: 'Alle Lagerstufen:',
            // éš¾åº¦ç³»ç»Ÿ
            selectDifficulty: 'Schwierigkeit wÃ¤hlen',
            selectDifficultyDesc: 'Verschiedene Startbedingungen, verschiedene Leben',
            difficultyHard: 'Dorfkind',
            difficultyNormal: 'Einheimischer',
            difficultyEasy: 'Erbe',
            noHouse: 'Kein Eigentum (Miete)',
            hasHouseLabel: 'Eigentum (Familie)',
            livesWithParents: 'Wohnt bei Eltern',
            salaryLabel: 'Gehalt',
            livingCostLabel: 'Lebenskosten',
            rentLabel: 'Miete',
            storageLabel: 'Lager',
            familyEventsLabel: 'Familienevents',
            yes: 'Ja',
            no: 'Nein',
            needWorkMonths: '{n} Monate Arbeit fÃ¼r Hauskauf nÃ¶tig',
            canBuyNow: 'Sofort kaufbar',
            back: 'â† ZurÃ¼ck',
            rentMultiplier: 'Miete erhÃ¶ht',
            monthsWorked: 'Gearbeitet',
            monthsUnit: ' Monate',
            buyHouseBtn: 'Haus kaufen',
            buyHouseNotQualified: 'Noch {n} Monate Arbeit nÃ¶tig',
            buyHouseSuccess: 'GlÃ¼ckwunsch zum Hauskauf!',
            familyLoanBtn: 'Von Eltern leihen',
            familyLoanMax: 'Maximal',
            familyLoanAmount: 'Betrag',
            familyLoanConfirm: 'Leihen',
            familyLoanOwed: 'Schulden bei Eltern',
            familyLoanRepay: 'Eltern zurÃ¼ckzahlen',
            // é€€å‡ºæ¸¸æˆ
            exitGame: 'Beenden',
            exitConfirmTitle: 'Spiel beenden',
            exitConfirmMsg: 'MÃ¶chtest du wirklich beenden?',
            exitWithSave: 'Speichern & Beenden',
            exitWithoutSave: 'Ohne Speichern',
            cancelExit: 'Abbrechen',
            // å­˜æ¡£ç³»ç»Ÿ
            backToCatalog: 'â† ZurÃ¼ck zum Katalog',
            gameSaved: 'âœ… Spiel gespeichert',
            gameLoaded: 'âœ… Spielstand geladen',
            noSaveFound: 'âŒ Kein Spielstand gefunden',
            loadError: 'âŒ Fehler beim Laden',
            saveDeleted: 'ğŸ—‘ï¸ Spielstand gelÃ¶scht',
            continueGame: 'ğŸ“‚ Weiterspielen',
            newGame: 'ğŸ® Neues Spiel',
            saveGame: 'ğŸ’¾ Spiel speichern',
            loadGameBtn: 'ğŸ“‚ Spielstand laden',
            deleteSaveBtn: 'ğŸ—‘ï¸ Spielstand lÃ¶schen',
        }
    };
    
    // è·å–ç¿»è¯‘æ–‡æœ¬
    const t = (key) => T[currentLang.value]?.[key] || T.zh[key] || key;

    // ==================== GAME DATA ====================
    
    // ä¸­æ–‡åŸå¸‚é…ç½®
    const CITIES_CN = {
        beijing: { name: 'åŒ—äº¬', emoji: 'ğŸ›ï¸', desc: 'æ”¿æ²»ä¸­å¿ƒï¼Œç‰©ä»·ç¨³å®š', modifier: 1.0 },
        shanghai: { name: 'ä¸Šæµ·', emoji: 'ğŸŒ†', desc: 'é‡‘èä¸­å¿ƒï¼Œé«˜æ¶ˆè´¹', modifier: 1.2 },
        guangzhou: { name: 'å¹¿å·', emoji: 'ğŸ­', desc: 'åˆ¶é€ ä¸šå‘è¾¾ï¼Œè´§æºå……è¶³', modifier: 0.9 },
        shenzhen: { name: 'æ·±åœ³', emoji: 'ğŸ’»', desc: 'ç§‘æŠ€ä¹‹éƒ½ï¼Œç”µå­äº§å“ä¾¿å®œ', modifier: 1.1 },
        hegang: { name: 'é¹¤å²—', emoji: 'ğŸ ', desc: 'æˆ¿ä»·æ´¼åœ°ï¼Œç”Ÿæ´»æˆæœ¬ä½', modifier: 0.5 },
        hangzhou: { name: 'æ­å·', emoji: 'ğŸ›’', desc: 'ç”µå•†ä¹‹éƒ½ï¼Œç›´æ’­å¸¦è´§å‘è¾¾', modifier: 1.0 },
        chengdu: { name: 'æˆéƒ½', emoji: 'ğŸ¼', desc: 'ä¼‘é—²ä¹‹éƒ½ï¼Œå‹åŠ›å°', modifier: 0.8 },
        hongkong: { name: 'é¦™æ¸¯', emoji: 'ğŸ™ï¸', desc: 'å›½é™…é‡‘èä¸­å¿ƒï¼Œå¥¢ä¾ˆå“å¤©å ‚', modifier: 1.5 },
    };
    
    // å¾·è¯­åŸå¸‚é…ç½®
    const CITIES_DE = {
        berlin: { name: 'Berlin', emoji: 'ğŸ»', desc: 'Arm aber sexy, viele Chancen', modifier: 1.0 },
        muenchen: { name: 'MÃ¼nchen', emoji: 'ğŸ°', desc: 'Teuer aber schÃ¶n', modifier: 1.4 },
        hamburg: { name: 'Hamburg', emoji: 'âš“', desc: 'Hafenstadt, Handel', modifier: 1.1 },
        frankfurt: { name: 'Frankfurt', emoji: 'ğŸ¦', desc: 'Finanzmetropole', modifier: 1.3 },
        koeln: { name: 'KÃ¶ln', emoji: 'â›ª', desc: 'Karneval und Medien', modifier: 1.0 },
        leipzig: { name: 'Leipzig', emoji: 'ğŸµ', desc: 'Aufstrebend, gÃ¼nstig', modifier: 0.7 },
        schwarzwald: { name: 'Schwarzwald', emoji: 'ğŸŒ²', desc: 'Tourismus, Ruhe', modifier: 0.8 },
        chemnitz: { name: 'Chemnitz', emoji: 'ğŸšï¸', desc: 'GÃ¼nstigste Stadt!', modifier: 0.4 },
    };
    
    // åŠ¨æ€è·å–å½“å‰è¯­è¨€çš„åŸå¸‚
    const CITIES = computed(() => currentLang.value === 'de' ? CITIES_DE : CITIES_CN);

    // ä¸­æ–‡å•†å“é…ç½® - å……æ»¡æ—¶ä»£æ¢— (å•†å“ä¼šéšå¹´ä»½è§£é”/é€€å‡º)
    const ITEMS_CN = {
        // ========== åŸºç¡€å•†å“ (å…¨å¹´å¯äº¤æ˜“) ==========
        mask_n95: {
            name: 'N95å£ç½©',
            emoji: 'ğŸ˜·',
            category: 'pandemic',
            basePrice: 50,
            volatility: 0.8,
            space: 1,
            desc: 'ä¸€ç½©éš¾æ±‚çš„æ—¥å­',
            yearRange: [2020, 2023]
        },
        lianhua: {
            name: 'è¿èŠ±æ¸…ç˜Ÿ',
            emoji: 'ğŸ’Š',
            category: 'pandemic',
            basePrice: 25,
            volatility: 0.6,
            space: 1,
            desc: 'ç¥ç§˜çš„è‰æœ¬åŠ›é‡',
            yearRange: [2020, 2023]
        },
        switch: {
            name: 'Switchæ¸¸æˆæœº',
            emoji: 'ğŸ®',
            category: 'electronics',
            basePrice: 2500,
            volatility: 0.3,
            space: 3,
            desc: 'å±…å®¶éš”ç¦»å¿…å¤‡',
            yearRange: [2020, 2025]
        },
        maotai: {
            name: 'é£å¤©èŒ…å°',
            emoji: 'ğŸ¾',
            category: 'luxury',
            basePrice: 3000,
            volatility: 0.2,
            space: 2,
            desc: 'æ°¸è¿œçš„ç¡¬é€šè´§',
            yearRange: [2020, 2025]
        },
        gold_bean: {
            name: 'é»„é‡‘è±†',
            emoji: 'ğŸ¥‡',
            category: 'luxury',
            basePrice: 600,
            volatility: 0.15,
            space: 1,
            desc: '1å…‹çš„å®‰å…¨æ„Ÿ',
            yearRange: [2020, 2025]
        },
        iphone: {
            name: 'iPhoneæ‰‹æœº',
            emoji: 'ğŸ“±',
            category: 'electronics',
            basePrice: 8000,
            volatility: 0.25,
            space: 1,
            desc: 'å¹´å¹´æŒ¤ç‰™è†',
            yearRange: [2020, 2025]
        },
        ps5: {
            name: 'PS5æ¸¸æˆæœº',
            emoji: 'ğŸ®',
            category: 'electronics',
            basePrice: 4500,
            volatility: 0.4,
            space: 4,
            desc: 'æŠ¢ä¸åˆ°çš„æ¬¡ä¸–ä»£',
            yearRange: [2020, 2025]
        },
        bike_share: {
            name: 'å…±äº«å•è½¦æœˆå¡',
            emoji: 'ğŸš²',
            category: 'daily',
            basePrice: 15,
            volatility: 0.3,
            space: 0,
            desc: 'æœ€åä¸€å…¬é‡Œ',
            yearRange: [2020, 2025]
        },
        milk_tea: {
            name: 'å¥¶èŒ¶åˆ¸',
            emoji: 'ğŸ§‹',
            category: 'food',
            basePrice: 20,
            volatility: 0.5,
            space: 0,
            desc: 'ç§‹å¤©ç¬¬ä¸€æ¯',
            yearRange: [2020, 2025]
        },
        
        // ========== 2021å¹´è§£é” ==========
        antigen: {
            name: 'å®¶ç”¨æŠ—åŸ',
            emoji: 'ğŸ§ª',
            category: 'pandemic',
            basePrice: 30,
            volatility: 1.2,
            space: 1,
            desc: 'ä¸¤é“æ çš„ç„¦è™‘',
            yearRange: [2021, 2023]
        },
        rtx3090: {
            name: 'RTX3090æ˜¾å¡',
            emoji: 'ğŸ–¥ï¸',
            category: 'electronics',
            basePrice: 15000,
            volatility: 1.5,
            space: 5,
            desc: 'çŸ¿å·¥çš„å°é’æœº',
            yearRange: [2021, 2024]
        },
        nft_ape: {
            name: 'æ— èŠçŒ¿NFT',
            emoji: 'ğŸµ',
            category: 'crypto',
            basePrice: 200000,
            volatility: 3.0,
            space: 0,
            desc: 'JPEGçš„å¤©ä»·ç¥è¯',
            yearRange: [2021, 2023]
        },
        metaverse_land: {
            name: 'å…ƒå®‡å®™åœ°çš®',
            emoji: 'ğŸŒ',
            category: 'crypto',
            basePrice: 50000,
            volatility: 2.5,
            space: 0,
            desc: 'è™šæ‹Ÿä¸–ç•Œçš„æˆ¿äº§',
            yearRange: [2021, 2023]
        },
        bitcoin: {
            name: 'æ¯”ç‰¹å¸',
            emoji: 'â‚¿',
            category: 'crypto',
            basePrice: 300000,
            volatility: 2.0,
            space: 0,
            desc: 'æ•°å­—é»„é‡‘',
            yearRange: [2020, 2025]
        },
        
        // ========== æˆ¿äº§ (é«˜ä»·å€¼å•†å“) ==========
        house_hegang: {
            name: 'é¹¤å²—æˆ¿äº§',
            emoji: 'ğŸšï¸',
            category: 'property',
            basePrice: 30000,
            volatility: 0.3,
            space: 0,
            desc: '3ä¸‡ä¸€å¥—çš„æ¢¦æƒ³',
            yearRange: [2020, 2025]
        },
        house_tier2: {
            name: 'äºŒçº¿åŸå¸‚æˆ¿',
            emoji: 'ğŸ ',
            category: 'property',
            basePrice: 1500000,
            volatility: 0.4,
            space: 0,
            desc: 'æ­å·/æˆéƒ½çš„å°çª',
            yearRange: [2020, 2025]
        },
        house_tier1: {
            name: 'ä¸€çº¿åŸå¸‚æˆ¿',
            emoji: 'ğŸ¢',
            category: 'property',
            basePrice: 5000000,
            volatility: 0.3,
            space: 0,
            desc: 'åŒ—ä¸Šå¹¿æ·±çš„èœ—å±…',
            yearRange: [2020, 2025]
        },
        
        // ========== æ–°èƒ½æºæ±½è½¦ ==========
        tesla_model3: {
            name: 'ç‰¹æ–¯æ‹‰Model 3',
            emoji: 'ğŸš—',
            category: 'vehicle',
            basePrice: 280000,
            volatility: 0.35,
            space: 0,
            desc: 'å‰²éŸ­èœä¸“ç”¨',
            yearRange: [2020, 2025]
        },
        byd_han: {
            name: 'æ¯”äºšè¿ªæ±‰',
            emoji: 'ğŸš™',
            category: 'vehicle',
            basePrice: 230000,
            volatility: 0.25,
            space: 0,
            desc: 'å›½è´§ä¹‹å…‰',
            yearRange: [2020, 2025]
        },
        nio_et5: {
            name: 'è”šæ¥ET5',
            emoji: 'ğŸš˜',
            category: 'vehicle',
            basePrice: 350000,
            volatility: 0.4,
            space: 0,
            desc: 'æ¢ç”µæ–°åŠ¿åŠ›',
            yearRange: [2021, 2025]
        },
        xiaomi_su7: {
            name: 'å°ç±³SU7',
            emoji: 'ğŸï¸',
            category: 'vehicle',
            basePrice: 250000,
            volatility: 0.5,
            space: 0,
            desc: 'å¹´è½»äººçš„ç¬¬ä¸€å°è½¦',
            yearRange: [2024, 2025]
        },
        
        // ========== 2023å¹´è§£é” ==========
        sauce_latte: {
            name: 'é…±é¦™æ‹¿é“',
            emoji: 'â˜•',
            category: 'food',
            basePrice: 35,
            volatility: 0.4,
            space: 1,
            desc: 'ç¾é…’åŠ å’–å•¡',
            yearRange: [2023, 2025]
        },
        chatgpt_account: {
            name: 'ChatGPTè´¦å·',
            emoji: 'ğŸ¤–',
            category: 'digital',
            basePrice: 200,
            volatility: 0.8,
            space: 0,
            desc: 'AIæ—¶ä»£çš„é—¨ç¥¨',
            yearRange: [2023, 2025]
        },
        nvidia_stock: {
            name: 'è‹±ä¼Ÿè¾¾è‚¡ç¥¨',
            emoji: 'ğŸ“ˆ',
            category: 'stock',
            basePrice: 5000,
            volatility: 1.8,
            space: 0,
            desc: 'AIèŠ¯ç‰‡çš„ç‹è€…',
            yearRange: [2023, 2025]
        },
        
        // ========== 2024å¹´è§£é” ==========
        wukong_merch: {
            name: 'é»‘ç¥è¯å‘¨è¾¹',
            emoji: 'ğŸ’',
            category: 'collectible',
            basePrice: 800,
            volatility: 1.0,
            space: 2,
            desc: 'å¤©å‘½äººçš„ä¿¡ä»°',
            yearRange: [2024, 2025]
        },
        drone: {
            name: 'ä½ç©ºç»æµæ— äººæœº',
            emoji: 'ğŸš',
            category: 'tech',
            basePrice: 8000,
            volatility: 0.6,
            space: 8,
            desc: 'ä¸‹ä¸€ä¸ªé£å£',
            yearRange: [2024, 2025]
        },
        humanoid_robot: {
            name: 'äººå½¢æœºå™¨äºº',
            emoji: 'ğŸ¦¾',
            category: 'tech',
            basePrice: 150000,
            volatility: 1.2,
            space: 20,
            desc: 'åŠ³åŠ¨åŠ›çš„æœªæ¥',
            yearRange: [2025, 2025]
        },
        deepseek: {
            name: 'DeepSeek APIé¢åº¦',
            emoji: 'ğŸ§ ',
            category: 'digital',
            basePrice: 100,
            volatility: 0.6,
            space: 0,
            desc: 'å›½äº§AIæ–°ç§€',
            yearRange: [2025, 2025]
        },
    };
    
    // å¾·è¯­å•†å“é…ç½® - German items with German cultural elements
    const ITEMS_DE = {
        // ========== åŸºç¡€å•†å“ (å…¨å¹´å¯äº¤æ˜“) ==========
        pfandflaschen: {
            name: 'Pfandflaschen',
            emoji: 'ğŸ¾',
            category: 'basic',
            basePrice: 2, // 0.25â‚¬ per bottle, trade in bulk
            volatility: 0.1,
            space: 1,
            desc: 'Berliner Gold - 25 Cent pro Flasche',
            yearRange: [2020, 2025]
        },
        currywurst: {
            name: 'Currywurst',
            emoji: 'ğŸŒ­',
            category: 'food',
            basePrice: 4,
            volatility: 0.3,
            space: 1,
            desc: 'Berliner Klassiker',
            yearRange: [2020, 2025]
        },
        doener: {
            name: 'DÃ¶ner Kebab',
            emoji: 'ğŸ¥™',
            category: 'food',
            basePrice: 8,
            volatility: 0.5,
            space: 1,
            desc: 'Der wahre deutsche Klassiker',
            yearRange: [2020, 2025]
        },
        birkenstock: {
            name: 'Birkenstock',
            emoji: 'ğŸ©´',
            category: 'fashion',
            basePrice: 80,
            volatility: 0.25,
            space: 2,
            desc: 'Deutsche Ingenieurskunst fÃ¼r FÃ¼ÃŸe',
            yearRange: [2020, 2025]
        },
        brezel: {
            name: 'Brezeln (100 StÃ¼ck)',
            emoji: 'ğŸ¥¨',
            category: 'food',
            basePrice: 50,
            volatility: 0.2,
            space: 2,
            desc: 'Bayern-Export',
            yearRange: [2020, 2025]
        },
        bier_kasten: {
            name: 'Bierkasten',
            emoji: 'ğŸº',
            category: 'basic',
            basePrice: 15,
            volatility: 0.15,
            space: 3,
            desc: '20 Flaschen Augustiner',
            yearRange: [2020, 2025]
        },
        bahncard: {
            name: 'BahnCard 100',
            emoji: 'ğŸš‚',
            category: 'transport',
            basePrice: 4000,
            volatility: 0.1,
            space: 0,
            desc: 'Unbegrenzt fahren, unbegrenzt warten',
            yearRange: [2020, 2025]
        },
        
        // ========== Techno & Nightlife ==========
        techno_ticket: {
            name: 'Berghain Ticket',
            emoji: 'ğŸ§',
            category: 'nightlife',
            basePrice: 25,
            volatility: 0.8,
            space: 0,
            desc: 'Vielleicht kommst du rein...',
            yearRange: [2020, 2025]
        },
        festival_pass: {
            name: 'Festival Pass',
            emoji: 'ğŸª',
            category: 'nightlife',
            basePrice: 200,
            volatility: 0.6,
            space: 1,
            desc: 'Wacken, Fusion, Rock am Ring',
            yearRange: [2020, 2025]
        },
        
        // ========== Fahrzeuge ==========
        gebrauchtwagen: {
            name: 'Gebrauchter BMW',
            emoji: 'ğŸš—',
            category: 'vehicle',
            basePrice: 15000,
            volatility: 0.3,
            space: 0,
            desc: 'E46, 200.000km, Rost inklusive',
            yearRange: [2020, 2025]
        },
        mercedes_amg: {
            name: 'Mercedes AMG',
            emoji: 'ğŸï¸',
            category: 'vehicle',
            basePrice: 80000,
            volatility: 0.2,
            space: 0,
            desc: 'Stuttgart-Export',
            yearRange: [2020, 2025]
        },
        ebike: {
            name: 'E-Bike',
            emoji: 'ğŸš´',
            category: 'vehicle',
            basePrice: 3000,
            volatility: 0.35,
            space: 5,
            desc: 'Umweltfreundlich zur Arbeit',
            yearRange: [2020, 2025]
        },
        vw_id4: {
            name: 'VW ID.4',
            emoji: 'ğŸ”Œ',
            category: 'vehicle',
            basePrice: 45000,
            volatility: 0.25,
            space: 0,
            desc: 'Deutsche E-MobilitÃ¤t',
            yearRange: [2021, 2025]
        },
        
        // ========== Pandemie (2020-2022) ==========
        ffp2_masken: {
            name: 'FFP2 Masken (50er)',
            emoji: 'ğŸ˜·',
            category: 'pandemic',
            basePrice: 50,
            volatility: 0.9,
            space: 1,
            desc: 'Maskenpflicht!',
            yearRange: [2020, 2022]
        },
        schnelltest: {
            name: 'Schnelltests (25er)',
            emoji: 'ğŸ§ª',
            category: 'pandemic',
            basePrice: 100,
            volatility: 1.0,
            space: 1,
            desc: '3G, 2G, 2G+...',
            yearRange: [2021, 2022]
        },
        klopapier: {
            name: 'Klopapier (100 Rollen)',
            emoji: 'ğŸ§»',
            category: 'pandemic',
            basePrice: 40,
            volatility: 1.5,
            space: 5,
            desc: 'Das weiÃŸe Gold von 2020',
            yearRange: [2020, 2021]
        },
        
        // ========== Investitionen ==========
        bitcoin: {
            name: 'Bitcoin',
            emoji: 'â‚¿',
            category: 'crypto',
            basePrice: 30000, // in EUR
            volatility: 2.0,
            space: 0,
            desc: 'Digitales Gold',
            yearRange: [2020, 2025]
        },
        immobilien_aktien: {
            name: 'Immobilien Aktien',
            emoji: 'ğŸ¢',
            category: 'stock',
            basePrice: 500,
            volatility: 0.4,
            space: 0,
            desc: 'Vonovia, LEG, etc.',
            yearRange: [2020, 2025]
        },
        dax_etf: {
            name: 'DAX ETF',
            emoji: 'ğŸ“ˆ',
            category: 'stock',
            basePrice: 150,
            volatility: 0.3,
            space: 0,
            desc: 'Deutschlands Top 40',
            yearRange: [2020, 2025]
        },
        gold_barren: {
            name: 'Goldbarren (10g)',
            emoji: 'ğŸ¥‡',
            category: 'luxury',
            basePrice: 600,
            volatility: 0.15,
            space: 1,
            desc: 'Sichere Anlage',
            yearRange: [2020, 2025]
        },
        
        // ========== 2023+ Items ==========
        waermepumpe: {
            name: 'WÃ¤rmepumpe',
            emoji: 'â™¨ï¸',
            category: 'tech',
            basePrice: 15000,
            volatility: 0.5,
            space: 10,
            desc: 'Habecks Liebling',
            yearRange: [2023, 2025]
        },
        balkonkraftwerk: {
            name: 'Balkonkraftwerk',
            emoji: 'â˜€ï¸',
            category: 'tech',
            basePrice: 800,
            volatility: 0.4,
            space: 5,
            desc: '600W Solarstrom',
            yearRange: [2022, 2025]
        },
        chatgpt_plus: {
            name: 'ChatGPT Plus',
            emoji: 'ğŸ¤–',
            category: 'digital',
            basePrice: 20,
            volatility: 0.3,
            space: 0,
            desc: 'KI-Revolution',
            yearRange: [2023, 2025]
        },
        deutschlandticket: {
            name: 'Deutschlandticket',
            emoji: 'ğŸ«',
            category: 'transport',
            basePrice: 49,
            volatility: 0.1,
            space: 0,
            desc: '49â‚¬ fÃ¼r ganz Deutschland',
            yearRange: [2023, 2025]
        },
        nvidia_aktie: {
            name: 'Nvidia Aktie',
            emoji: 'ğŸ“Š',
            category: 'stock',
            basePrice: 400,
            volatility: 1.5,
            space: 0,
            desc: 'KI-Chip KÃ¶nig',
            yearRange: [2023, 2025]
        },
    };
    
    // åŠ¨æ€è·å–å½“å‰è¯­è¨€çš„å•†å“
    const ITEMS = computed(() => currentLang.value === 'de' ? ITEMS_DE : ITEMS_CN);
    
    // ä»“åº“å‡çº§é…ç½®
    const STORAGE_UPGRADES_CN = [
        { level: 1, capacity: 100, cost: 0, name: 'åˆå§‹ä»“åº“' },
        { level: 2, capacity: 200, cost: 10000, name: 'å°å‹ä»“åº“' },
        { level: 3, capacity: 350, cost: 30000, name: 'ä¸­å‹ä»“åº“' },
        { level: 4, capacity: 500, cost: 80000, name: 'å¤§å‹ä»“åº“' },
        { level: 5, capacity: 800, cost: 200000, name: 'è¶…çº§ä»“åº“' },
        { level: 6, capacity: 1500, cost: 500000, name: 'ç‰©æµä¸­å¿ƒ' },
    ];
    const STORAGE_UPGRADES_DE = [
        { level: 1, capacity: 100, cost: 0, name: 'Basislager' },
        { level: 2, capacity: 200, cost: 10000, name: 'Kleines Lager' },
        { level: 3, capacity: 350, cost: 30000, name: 'Mittleres Lager' },
        { level: 4, capacity: 500, cost: 80000, name: 'GroÃŸes Lager' },
        { level: 5, capacity: 800, cost: 200000, name: 'Superlager' },
        { level: 6, capacity: 1500, cost: 500000, name: 'Logistikzentrum' },
    ];
    const STORAGE_UPGRADES = computed(() => currentLang.value === 'de' ? STORAGE_UPGRADES_DE : STORAGE_UPGRADES_CN);

    // ä¸­æ–‡éšæœºäº‹ä»¶é…ç½®
    const EVENTS_CN = [
        {
            id: 'lockdown',
            title: 'ğŸ”’ çªå‘å°æ§ï¼',
            desc: 'ä½ æ‰€åœ¨çš„åŸå¸‚è¿›å…¥é™æ€ç®¡ç†ï¼Œå±…å®¶éš”ç¦»ç‰©èµ„ä»·æ ¼é£™å‡ï¼',
            targetItems: ['mask_n95', 'lianhua', 'switch'],
            effect: (state, itemsData, marketItemIds) => {
                state.canMove = false;
                state.lockdownDays = 2;
                state.health = Math.min(100, state.health + 20);
                
                // å°æ§æœŸé—´é˜²ç–«ç‰©èµ„å’Œå±…å®¶å¨±ä¹äº§å“æ¶¨ä»·
                const results = [];
                const targets = ['mask_n95', 'lianhua', 'switch'].filter(id => marketItemIds.includes(id));
                targets.forEach(id => {
                    if (state.prices[id]) {
                        state.prices[id] = Math.floor(state.prices[id] * 2.5);
                        results.push(`${itemsData[id]?.name || id} +150%`);
                    }
                });
                
                if (results.length > 0) {
                    return `å¥åº·+20ï¼Œå°æ§2æœˆã€‚${results.join('ã€')}ï¼`;
                }
                return 'å¥åº·+20ï¼Œå°æ§2æœˆæ— æ³•ç§»åŠ¨';
            },
            chance: 0.15,
            yearRange: [2020, 2023]
        },
        {
            id: 'layoff',
            title: 'ğŸ“¦ å¤§å‚"æ¯•ä¸š"',
            desc: 'å¾ˆé—æ†¾ï¼Œä½ è¢«ä¼˜åŒ–äº†ã€‚å…¬å¸ç»™äº†N+1ï¼Œä½†å¿ƒæƒ…å¾ˆç³Ÿã€‚',
            effect: (state) => {
                const compensation = Math.floor(state.salary * 3);
                state.money += compensation;
                state.salary = 0;
                state.mood = Math.max(0, state.mood - 30);
                return `è·å¾—è¡¥å¿é‡‘ Â¥${compensation.toLocaleString()}ï¼Œä½†å¤±å»å·¥ä½œï¼Œå¿ƒæƒ… -30`;
            },
            condition: (state) => state.salary > 0,
            chance: 0.1,
            yearRange: [2022, 2025]
        },
        {
            id: 'stock_crash',
            title: 'ğŸ“‰ Aè‚¡ä¿å«æˆ˜ï¼',
            desc: 'å¸‚åœºå‰§çƒˆæ³¢åŠ¨ï¼Œé‡‘èèµ„äº§ä»·æ ¼æš´è·Œï¼',
            targetItems: ['nvidia_stock', 'nft_ape', 'metaverse_land'],
            effect: (state, itemsData, marketItemIds) => {
                const targets = ['nvidia_stock', 'nft_ape', 'metaverse_land'].filter(id => marketItemIds.includes(id));
                if (targets.length === 0) return null;
                const affected = [];
                targets.forEach(id => {
                    if (state.prices[id]) {
                        state.prices[id] = Math.floor(state.prices[id] * 0.5);
                        affected.push(itemsData[id]?.name || id);
                    }
                });
                return `${affected.join('ã€')} ä»·æ ¼æš´è·Œ50%ï¼`;
            },
            chance: 0.08,
            yearRange: [2020, 2025]
        },
        {
            id: 'livestream_boom',
            title: 'ğŸ“± ç›´æ’­å¸¦è´§çˆ†ç«ï¼',
            desc: 'æŸç½‘çº¢ä¸»æ’­å¤§åŠ›æ¨èï¼Œå•†å“ä»·æ ¼é£™å‡ï¼',
            effect: (state, itemsData, marketItemIds) => {
                // åªä»å½“å‰å¸‚åœºä¸Šçš„å•†å“ä¸­é€‰æ‹©
                const items = marketItemIds.filter(id => state.prices[id] && itemsData[id]);
                if (items.length === 0) return null; // ä¸è§¦å‘
                const luckyItem = items[Math.floor(Math.random() * items.length)];
                state.prices[luckyItem] = Math.floor(state.prices[luckyItem] * 5);
                return `${itemsData[luckyItem].emoji} ${itemsData[luckyItem].name} ä»·æ ¼ç¿»5å€ï¼`;
            },
            chance: 0.12,
            yearRange: [2020, 2025]
        },
        {
            id: 'consumption_downgrade',
            title: 'ğŸ’¸ æ¶ˆè´¹é™çº§',
            desc: 'ç»æµä¸æ™¯æ°”ï¼Œå¤§å®¶å¼€å§‹ç²¾æ‰“ç»†ç®—...',
            targetItems: ['maotai', 'nft_ape', 'mask_n95', 'lianhua'],
            effect: (state, itemsData, marketItemIds) => {
                const results = [];
                ['maotai', 'nft_ape'].filter(id => marketItemIds.includes(id)).forEach(id => {
                    if (state.prices[id]) {
                        state.prices[id] = Math.floor(state.prices[id] * 0.6);
                        results.push(`${itemsData[id]?.name || id} -40%`);
                    }
                });
                ['mask_n95', 'lianhua'].filter(id => marketItemIds.includes(id)).forEach(id => {
                    if (state.prices[id]) {
                        state.prices[id] = Math.floor(state.prices[id] * 1.5);
                        results.push(`${itemsData[id]?.name || id} +50%`);
                    }
                });
                return results.length > 0 ? results.join('ï¼Œ') : null;
            },
            chance: 0.1,
            yearRange: [2022, 2025]
        },
        {
            id: 'crypto_pump',
            title: 'ğŸš€ åŠ å¯†è´§å¸æš´æ¶¨ï¼',
            desc: 'é©¬æ–¯å…‹åˆå‘æ¨äº†ï¼æ•°å­—èµ„äº§é›†ä½“æ‹‰å‡ï¼',
            targetItems: ['nft_ape', 'metaverse_land'],
            effect: (state, itemsData, marketItemIds) => {
                const targets = ['nft_ape', 'metaverse_land'].filter(id => marketItemIds.includes(id));
                if (targets.length === 0) return null;
                const affected = [];
                targets.forEach(id => {
                    if (state.prices[id]) {
                        state.prices[id] = Math.floor(state.prices[id] * 3);
                        affected.push(itemsData[id]?.name || id);
                    }
                });
                return `${affected.join('ã€')} ä»·æ ¼ç¿»3å€ï¼`;
            },
            chance: 0.08,
            yearRange: [2021, 2023]
        },
        {
            id: 'gpu_shortage',
            title: 'â›ï¸ æŒ–çŸ¿çƒ­æ½®',
            desc: 'æ¯”ç‰¹å¸ä»·æ ¼æš´æ¶¨ï¼ŒçŸ¿å·¥ä»¬ç–¯ç‹‚æŠ¢è´­æ˜¾å¡ï¼',
            targetItems: ['rtx3090'],
            effect: (state, itemsData, marketItemIds) => {
                if (!marketItemIds.includes('rtx3090') || !state.prices['rtx3090']) return null;
                state.prices['rtx3090'] = Math.floor(state.prices['rtx3090'] * 4);
                return 'RTX3090ä»·æ ¼ç¿»4å€ï¼';
            },
            chance: 0.1,
            yearRange: [2021, 2022]
        },
        {
            id: 'ai_revolution',
            title: 'ğŸ¤– AIé©å‘½',
            desc: 'ChatGPTåˆ·å±ï¼Œäººäººéƒ½åœ¨è°ˆè®ºAIï¼',
            targetItems: ['chatgpt_account', 'nvidia_stock'],
            effect: (state, itemsData, marketItemIds) => {
                const targets = ['chatgpt_account', 'nvidia_stock'].filter(id => marketItemIds.includes(id));
                if (targets.length === 0) return null;
                const affected = [];
                targets.forEach(id => {
                    if (state.prices[id]) {
                        state.prices[id] = Math.floor(state.prices[id] * 2.5);
                        affected.push(itemsData[id]?.name || id);
                    }
                });
                return `${affected.join('ã€')} ä»·æ ¼æš´æ¶¨150%ï¼`;
            },
            chance: 0.12,
            yearRange: [2023, 2025]
        },
        {
            id: 'wukong_hype',
            title: 'ğŸ’ é»‘ç¥è¯çˆ†ç«',
            desc: '3Aå¤§ä½œéœ‡æ’¼å‘å¸ƒï¼Œå‘¨è¾¹è¢«æŠ¢ç–¯äº†ï¼',
            targetItems: ['wukong_merch'],
            effect: (state, itemsData, marketItemIds) => {
                if (!marketItemIds.includes('wukong_merch') || !state.prices['wukong_merch']) return null;
                state.prices['wukong_merch'] = Math.floor(state.prices['wukong_merch'] * 6);
                return 'é»‘ç¥è¯å‘¨è¾¹ä»·æ ¼ç¿»6å€ï¼';
            },
            chance: 0.15,
            yearRange: [2024, 2025]
        },
        {
            id: 'housing_policy',
            title: 'ğŸ  æ¥¼å¸‚è°ƒæ§',
            desc: 'æ”¿åºœå‡ºå°æˆ¿äº§è°ƒæ§æ”¿ç­–ï¼Œå¸‚åœºè§‚æœ›æƒ…ç»ªæµ“åš...',
            targetItems: ['house_hegang', 'house_tier2', 'house_tier1'],
            effect: (state, itemsData, marketItemIds) => {
                const targets = ['house_hegang', 'house_tier2', 'house_tier1'].filter(id => marketItemIds.includes(id));
                if (targets.length === 0) return null;
                targets.forEach(id => {
                    if (state.prices[id]) {
                        state.prices[id] = Math.floor(state.prices[id] * 0.7);
                    }
                });
                return 'æˆ¿äº§ä»·æ ¼ä¸‹è·Œ30%ï¼';
            },
            chance: 0.1,
            yearRange: [2021, 2025]
        },
        {
            id: 'housing_boom',
            title: 'ğŸ—ï¸ æ¥¼å¸‚å›æš–',
            desc: 'é™æ¯é™å‡†ï¼Œåœ°äº§è‚¡æš´æ¶¨ï¼Œä¹°æˆ¿çƒ­æƒ…é«˜æ¶¨ï¼',
            targetItems: ['house_hegang', 'house_tier2', 'house_tier1'],
            effect: (state, itemsData, marketItemIds) => {
                const targets = ['house_hegang', 'house_tier2', 'house_tier1'].filter(id => marketItemIds.includes(id));
                if (targets.length === 0) return null;
                targets.forEach(id => {
                    if (state.prices[id]) {
                        state.prices[id] = Math.floor(state.prices[id] * 1.5);
                    }
                });
                return 'æˆ¿äº§ä»·æ ¼ä¸Šæ¶¨50%ï¼';
            },
            chance: 0.08,
            yearRange: [2020, 2025]
        },
        {
            id: 'ev_subsidy',
            title: 'ğŸ”‹ æ–°èƒ½æºè¡¥è´´',
            desc: 'å›½å®¶å¤§åŠ›è¡¥è´´æ–°èƒ½æºæ±½è½¦ï¼Œé”€é‡æš´å¢ï¼',
            targetItems: ['tesla_model3', 'byd_han', 'nio_et5', 'xiaomi_su7'],
            effect: (state, itemsData, marketItemIds) => {
                const targets = ['tesla_model3', 'byd_han', 'nio_et5', 'xiaomi_su7'].filter(id => marketItemIds.includes(id));
                if (targets.length === 0) return null;
                const affected = [];
                targets.forEach(id => {
                    if (state.prices[id]) {
                        state.prices[id] = Math.floor(state.prices[id] * 1.3);
                        affected.push(itemsData[id]?.name || id);
                    }
                });
                return `${affected.join('ã€')} æ¶¨ä»·30%ï¼`;
            },
            chance: 0.1,
            yearRange: [2020, 2025]
        },
        {
            id: 'ev_price_war',
            title: 'âš”ï¸ æ–°èƒ½æºä»·æ ¼æˆ˜',
            desc: 'ç‰¹æ–¯æ‹‰å¸¦å¤´é™ä»·ï¼Œå¼•å‘è¡Œä¸šä»·æ ¼æˆ˜ï¼',
            targetItems: ['tesla_model3', 'byd_han', 'nio_et5', 'xiaomi_su7'],
            effect: (state, itemsData, marketItemIds) => {
                const targets = ['tesla_model3', 'byd_han', 'nio_et5', 'xiaomi_su7'].filter(id => marketItemIds.includes(id));
                if (targets.length === 0) return null;
                const affected = [];
                targets.forEach(id => {
                    if (state.prices[id]) {
                        state.prices[id] = Math.floor(state.prices[id] * 0.75);
                        affected.push(itemsData[id]?.name || id);
                    }
                });
                return `${affected.join('ã€')} é™ä»·25%ï¼`;
            },
            chance: 0.12,
            yearRange: [2023, 2025]
        },
        {
            id: 'xiaomi_launch',
            title: 'ğŸ“± å°ç±³æ±½è½¦å‘å¸ƒ',
            desc: 'é›·å†›äº²è‡ªç«™å°ï¼Œå°ç±³SU7æ­£å¼å‘å¸ƒï¼',
            targetItems: ['xiaomi_su7'],
            effect: (state, itemsData, marketItemIds) => {
                if (!marketItemIds.includes('xiaomi_su7') || !state.prices['xiaomi_su7']) return null;
                state.prices['xiaomi_su7'] = Math.floor(state.prices['xiaomi_su7'] * 2);
                return 'å°ç±³SU7ä»·æ ¼ç¿»å€ï¼ä¸€è½¦éš¾æ±‚ï¼';
            },
            chance: 0.15,
            yearRange: [2024, 2025]
        },
        {
            id: 'find_money',
            title: 'ğŸŠ æ„å¤–ä¹‹è´¢',
            desc: 'ä½ åœ¨æ—§è¡£æœå£è¢‹é‡Œå‘ç°äº†ä¸€ç¬”é’±ï¼',
            effect: (state) => {
                const amount = Math.floor(Math.random() * 5000) + 1000;
                state.money += amount;
                return `è·å¾— Â¥${amount.toLocaleString()}ï¼`;
            },
            chance: 0.1,
            yearRange: [2020, 2025]
        },
        {
            id: 'hospital',
            title: 'ğŸ¥ èº«ä½“ä¸é€‚',
            desc: 'ç†¬å¤œå¤ªå¤šï¼Œèº«ä½“å‘å‡ºè­¦å‘Š...',
            effect: (state) => {
                const cost = Math.floor(Math.random() * 3000) + 1000;
                state.money -= cost;
                state.health = Math.max(0, state.health - 15);
                return `åŒ»è¯è´¹ -Â¥${cost.toLocaleString()}ï¼Œå¥åº· -15`;
            },
            chance: 0.1,
            yearRange: [2020, 2025]
        },
        {
            id: 'scam',
            title: 'âš ï¸ é­é‡è¯ˆéª—',
            desc: 'ä½ æ¥åˆ°ä¸€ä¸ªè‡ªç§°"å…¬å®‰å±€"çš„ç”µè¯...',
            effect: (state) => {
                if (state.credit < 50) {
                    const loss = Math.floor(state.money * 0.3);
                    state.money -= loss;
                    return `è¢«éª—èµ° Â¥${loss.toLocaleString()}ï¼ä¿¡ç”¨åˆ†å¤ªä½å®¹æ˜“è¢«éª—ï¼`;
                }
                return 'ä½ è¯†ç ´äº†éª—å±€ï¼Œæ²¡æœ‰ä¸Šå½“ï¼';
            },
            chance: 0.08,
            yearRange: [2020, 2025]
        },
    ];
    
    // å¾·è¯­éšæœºäº‹ä»¶é…ç½® - German-specific events
    const EVENTS_DE = [
        {
            id: 'db_verspaetung',
            title: 'ğŸš‚ DB VerspÃ¤tung!',
            desc: 'Der Zug hat 3 Stunden VerspÃ¤tung. Wieder mal...',
            effect: (state) => {
                state.canMove = false;
                state.lockdownDays = 1;
                return 'Bewegung diesen Monat nicht mÃ¶glich. Danke, Deutsche Bahn!';
            },
            chance: 0.2, // Very common in Germany!
            yearRange: [2020, 2025]
        },
        {
            id: 'finanzamt',
            title: 'ğŸ“‹ Finanzamt-PrÃ¼fung!',
            desc: 'Das Finanzamt mÃ¶chte deine SteuererklÃ¤rung Ã¼berprÃ¼fen...',
            effect: (state) => {
                if (state.money > 10000) {
                    const tax = Math.floor(state.money * 0.2);
                    state.money -= tax;
                    return `Steuernachzahlung: -â‚¬${tax.toLocaleString()}. Das ist nicht gut!`;
                }
                return 'Alles in Ordnung. Puh!';
            },
            chance: 0.08,
            yearRange: [2020, 2025]
        },
        {
            id: 'streik',
            title: 'âœŠ Streik!',
            desc: 'Die Gewerkschaft ruft zum Generalstreik auf!',
            effect: (state) => {
                state.canMove = false;
                state.lockdownDays = 2;
                return 'Ã–ffentlicher Nahverkehr lahmgelegt. 2 Monate keine Bewegung!';
            },
            chance: 0.12,
            yearRange: [2020, 2025]
        },
        {
            id: 'schwarzarbeit',
            title: 'ğŸ‘® Zoll-Kontrolle!',
            desc: 'Verdacht auf Schwarzarbeit! Die BehÃ¶rden ermitteln...',
            effect: (state) => {
                if (state.credit < 50) {
                    const fine = Math.floor(state.money * 0.25);
                    state.money -= fine;
                    state.credit = Math.max(0, state.credit - 10);
                    return `Geldstrafe: -â‚¬${fine.toLocaleString()}. Schufa -10!`;
                }
                return 'Alles legal, keine Strafe.';
            },
            chance: 0.06,
            yearRange: [2020, 2025]
        },
        {
            id: 'oktoberfest',
            title: 'ğŸº Oktoberfest!',
            desc: 'O\'zapft is! Die Wiesn sind erÃ¶ffnet!',
            targetItems: ['bier_kasten', 'brezel', 'currywurst'],
            effect: (state, itemsData, marketItemIds) => {
                const targets = ['bier_kasten', 'brezel', 'currywurst'].filter(id => marketItemIds.includes(id));
                if (targets.length === 0) return null;
                targets.forEach(id => {
                    if (state.prices[id]) {
                        state.prices[id] = Math.floor(state.prices[id] * 2);
                    }
                });
                return 'Bier und Essen +100%! Prost!';
            },
            chance: 0.1,
            yearRange: [2020, 2025]
        },
        {
            id: 'buerokratie',
            title: 'ğŸ“ BÃ¼rokratie!',
            desc: 'Du musst zum BÃ¼rgeramt. Termin erst in 3 Monaten...',
            effect: (state) => {
                // Lose one turn doing nothing
                state.mood = Math.max(0, state.mood - 20);
                return 'Stimmung -20. Willkommen in Deutschland!';
            },
            chance: 0.15,
            yearRange: [2020, 2025]
        },
        {
            id: 'energiekrise',
            title: 'âš¡ Energiekrise!',
            desc: 'Gaspreis explodiert! Heizen wird zum Luxus!',
            targetItems: ['waermepumpe'],
            effect: (state, itemsData, marketItemIds) => {
                const cost = Math.floor(Math.random() * 500) + 300;
                state.money -= cost;
                let result = `Nebenkosten: -â‚¬${cost}.`;
                if (marketItemIds.includes('waermepumpe') && state.prices['waermepumpe']) {
                    state.prices['waermepumpe'] = Math.floor(state.prices['waermepumpe'] * 1.5);
                    result += ' WÃ¤rmepumpen +50%!';
                }
                return result;
            },
            chance: 0.1,
            yearRange: [2022, 2024]
        },
        {
            id: 'corona_lockdown',
            title: 'ğŸ”’ Corona-Lockdown!',
            desc: 'KontaktbeschrÃ¤nkungen und Ausgangssperre!',
            targetItems: ['ffp2_masken', 'schnelltest', 'klopapier'],
            effect: (state, itemsData, marketItemIds) => {
                state.canMove = false;
                state.lockdownDays = 3;
                state.health = Math.min(100, state.health + 10);
                const targets = ['ffp2_masken', 'schnelltest', 'klopapier'].filter(id => marketItemIds.includes(id));
                targets.forEach(id => {
                    if (state.prices[id]) {
                        state.prices[id] = Math.floor(state.prices[id] * 2);
                    }
                });
                return targets.length > 0 ? 'Lockdown! Masken und Tests +100%!' : 'Lockdown! Gesundheit +10.';
            },
            chance: 0.15,
            yearRange: [2020, 2022]
        },
        {
            id: 'mietendeckel',
            title: 'ğŸ  Mietendeckel!',
            desc: 'Berlin fÃ¼hrt den Mietendeckel ein!',
            targetItems: ['immobilien_aktien'],
            effect: (state, itemsData, marketItemIds) => {
                if (!marketItemIds.includes('immobilien_aktien') || !state.prices['immobilien_aktien']) return null;
                state.prices['immobilien_aktien'] = Math.floor(state.prices['immobilien_aktien'] * 0.7);
                return 'Immobilienaktien -30%!';
            },
            chance: 0.08,
            yearRange: [2020, 2023]
        },
        {
            id: 'crypto_crash',
            title: 'ğŸ“‰ Krypto-Crash!',
            desc: 'Bitcoin stÃ¼rzt ab! PanikverkÃ¤ufe Ã¼berall!',
            targetItems: ['bitcoin'],
            effect: (state, itemsData, marketItemIds) => {
                if (!marketItemIds.includes('bitcoin') || !state.prices['bitcoin']) return null;
                state.prices['bitcoin'] = Math.floor(state.prices['bitcoin'] * 0.5);
                return 'Bitcoin -50%!';
            },
            chance: 0.1,
            yearRange: [2022, 2025]
        },
        {
            id: 'ki_boom',
            title: 'ğŸ¤– KI-Boom!',
            desc: 'ChatGPT erobert die Welt!',
            targetItems: ['chatgpt_plus', 'nvidia_aktie'],
            effect: (state, itemsData, marketItemIds) => {
                const targets = ['chatgpt_plus', 'nvidia_aktie'].filter(id => marketItemIds.includes(id));
                if (targets.length === 0) return null;
                const affected = [];
                targets.forEach(id => {
                    if (state.prices[id]) {
                        state.prices[id] = Math.floor(state.prices[id] * 1.8);
                        affected.push(itemsData[id]?.name || id);
                    }
                });
                return `${affected.join(', ')} +80%!`;
            },
            chance: 0.12,
            yearRange: [2023, 2025]
        },
        {
            id: 'deutschlandticket',
            title: 'ğŸ« 49â‚¬-Ticket!',
            desc: 'Das Deutschlandticket ist da!',
            targetItems: ['bahncard', 'deutschlandticket'],
            effect: (state, itemsData, marketItemIds) => {
                const results = [];
                if (marketItemIds.includes('bahncard') && state.prices['bahncard']) {
                    state.prices['bahncard'] = Math.floor(state.prices['bahncard'] * 0.6);
                    results.push('BahnCard -40%');
                }
                if (marketItemIds.includes('deutschlandticket') && state.prices['deutschlandticket']) {
                    state.prices['deutschlandticket'] = Math.floor(state.prices['deutschlandticket'] * 0.5);
                    results.push('Deutschlandticket -50%');
                }
                return results.length > 0 ? results.join(', ') : null;
            },
            chance: 0.1,
            yearRange: [2023, 2025]
        },
        {
            id: 'festival_season',
            title: 'ğŸª Festival-Saison!',
            desc: 'Wacken, Rock am Ring und Co. starten!',
            targetItems: ['techno_ticket', 'festival_pass'],
            effect: (state, itemsData, marketItemIds) => {
                const targets = ['techno_ticket', 'festival_pass'].filter(id => marketItemIds.includes(id));
                if (targets.length === 0) return null;
                targets.forEach(id => {
                    if (state.prices[id]) {
                        state.prices[id] = Math.floor(state.prices[id] * 2.5);
                    }
                });
                return 'Festival-Tickets +150%!';
            },
            chance: 0.1,
            yearRange: [2022, 2025]
        },
        {
            id: 'schnÃ¤ppchen',
            title: 'ğŸŠ SchnÃ¤ppchen!',
            desc: 'Du findest ein tolles Angebot auf eBay Kleinanzeigen!',
            effect: (state) => {
                const amount = Math.floor(Math.random() * 500) + 100;
                state.money += amount;
                return `Du findest â‚¬${amount}! Geil!`;
            },
            chance: 0.1,
            yearRange: [2020, 2025]
        },
        {
            id: 'krankenversicherung',
            title: 'ğŸ¥ Arztbesuch',
            desc: 'Du fÃ¼hlst dich nicht gut...',
            effect: (state) => {
                // In Germany, healthcare is free!
                state.health = Math.min(100, state.health + 30);
                return 'Behandlung kostenlos! Gesundheit +30. Krankenversicherung zahlt! ğŸ‡©ğŸ‡ª';
            },
            chance: 0.08,
            yearRange: [2020, 2025]
        },
        {
            id: 'doener_preis',
            title: 'ğŸ¥™ DÃ¶ner-Krise!',
            desc: 'Die DÃ¶ner-Inflation ist real! 10â‚¬ fÃ¼r einen DÃ¶ner?!',
            targetItems: ['doener'],
            effect: (state, itemsData, marketItemIds) => {
                if (!marketItemIds.includes('doener') || !state.prices['doener']) return null;
                state.prices['doener'] = Math.floor(state.prices['doener'] * 1.5);
                state.mood = Math.max(0, state.mood - 10);
                return 'DÃ¶ner +50%! Stimmung -10.';
            },
            chance: 0.12,
            yearRange: [2023, 2025]
        },
        {
            id: 'wohnungsnot',
            title: 'ğŸ˜ï¸ Wohnungsnot!',
            desc: '500 Bewerber fÃ¼r eine Wohnung...',
            effect: (state) => {
                state.mood = Math.max(0, state.mood - 15);
                return 'Stimmung -15. Willkommen in Berlin!';
            },
            chance: 0.1,
            yearRange: [2020, 2025]
        },
    ];
    
    // åŠ¨æ€è·å–å½“å‰è¯­è¨€çš„äº‹ä»¶
    const EVENTS = computed(() => currentLang.value === 'de' ? EVENTS_DE : EVENTS_CN);

    // ==================== MAIN APP ====================
    
    createApp({
        setup() {
            // æ¸¸æˆçŠ¶æ€
            // æˆ¿è´·è®¡ç®—ï¼š30å¹´ï¼Œå¹´åˆ©ç‡5%ï¼Œç­‰é¢æœ¬æ¯
            // MAX_MORTGAGE is now a computed property defined below (language-dependent)
            const MORTGAGE_YEARS = 30;
            const MORTGAGE_RATE = 0.05; // å¹´åˆ©ç‡5%
            const MONTHLY_RATE = MORTGAGE_RATE / 12;
            const TOTAL_MONTHS = MORTGAGE_YEARS * 12;
            
            // è®¡ç®—æœˆä¾›å‡½æ•°ï¼ˆæ ¹æ®å®é™…è´·æ¬¾é‡‘é¢ï¼‰
            const calcMonthlyPayment = (principal) => {
                if (principal <= 0) return 0;
                return Math.floor(
                    principal * MONTHLY_RATE * Math.pow(1 + MONTHLY_RATE, TOTAL_MONTHS) / 
                    (Math.pow(1 + MONTHLY_RATE, TOTAL_MONTHS) - 1)
                );
            };
            
            // è¿è¾“è´¹ç”¨ï¼ˆä»ä»“åº“åŸå¸‚è¿åˆ°å…¶ä»–åŸå¸‚ï¼‰
            const TRANSPORT_COST_RATE = 0.05; // è¿è¾“è´¹ä¸ºè´§å€¼çš„5%
            
            // ä¸­æ–‡åŸå¸‚æˆ¿ç§Ÿé…ç½®ï¼ˆæœˆç§Ÿï¼‰
            const CITY_RENT_CN = {
                beijing: 5000,
                shanghai: 5500,
                guangzhou: 3500,
                shenzhen: 4500,
                hegang: 500,
                hangzhou: 3000,
                chengdu: 2000,
                hongkong: 8000,
            };
            
            // å¾·è¯­åŸå¸‚æˆ¿ç§Ÿé…ç½®ï¼ˆæœˆç§Ÿï¼‰- å¾·å›½æˆ¿ç§Ÿç›¸å¯¹ç¨³å®š
            const CITY_RENT_DE = {
                berlin: 1200,      // Berlin - still relatively cheap
                muenchen: 2000,    // Munich - very expensive
                hamburg: 1400,     // Hamburg
                frankfurt: 1600,   // Frankfurt
                koeln: 1200,       // Cologne
                leipzig: 700,      // Leipzig - cheap
                schwarzwald: 800,  // Black Forest
                chemnitz: 400,     // Cheapest city
            };
            
            // åŠ¨æ€è·å–æˆ¿ç§Ÿé…ç½®
            const CITY_RENT = computed(() => currentLang.value === 'de' ? CITY_RENT_DE : CITY_RENT_CN);
            
            // ä¸­æ–‡åŸå¸‚æˆ¿äº§ä»·å€¼
            const CITY_HOUSE_VALUE_CN = {
                beijing: 5000000,
                shanghai: 5500000,
                guangzhou: 3000000,
                shenzhen: 4000000,
                hegang: 50000,
                hangzhou: 2500000,
                chengdu: 1500000,
                hongkong: 8000000,
            };
            
            // å¾·è¯­åŸå¸‚æˆ¿äº§ä»·å€¼ - å¾·å›½æˆ¿äº§ä»·æ ¼ï¼ˆæ¬§å…ƒï¼Œç›¸å¯¹ç¨³å®šï¼‰
            const CITY_HOUSE_VALUE_DE = {
                berlin: 500000,     // Berlin apartment
                muenchen: 800000,   // Munich - most expensive
                hamburg: 550000,    // Hamburg
                frankfurt: 600000,  // Frankfurt
                koeln: 450000,      // Cologne
                leipzig: 250000,    // Leipzig - affordable
                schwarzwald: 350000, // Black Forest
                chemnitz: 50000,    // Cheapest city in Germany!
            };
            
            // åŠ¨æ€è·å–æˆ¿äº§ä»·å€¼é…ç½®
            const CITY_HOUSE_VALUE = computed(() => currentLang.value === 'de' ? CITY_HOUSE_VALUE_DE : CITY_HOUSE_VALUE_CN);
            
            // å¾·å›½æœ€é«˜è´·æ¬¾50ä¸‡æ¬§å…ƒï¼Œä¸­å›½æœ€é«˜100ä¸‡äººæ°‘å¸
            const MAX_MORTGAGE_CN = 1000000;
            const MAX_MORTGAGE_DE = 500000;
            const MAX_MORTGAGE = computed(() => currentLang.value === 'de' ? MAX_MORTGAGE_DE : MAX_MORTGAGE_CN);

            const gameState = reactive({
                screen: 'start', // start, difficultySelect, citySelect, playing, event, gameover, win
                difficulty: 'normal', // hard, normal, easy
                month: 1,
                year: 2020,
                money: 50000, // åˆå§‹èµ„é‡‘5ä¸‡
                mortgageRemaining: 0, // å‰©ä½™æˆ¿è´·æœ¬é‡‘ï¼ˆæ ¹æ®æˆ¿ä»·è®¡ç®—ï¼‰
                mortgagePaid: 0, // å·²è¿˜æœ¬é‡‘
                monthlyPayment: 0, // æ¯æœˆæœˆä¾›ï¼ˆæ ¹æ®è´·æ¬¾é‡‘é¢è®¡ç®—ï¼‰
                health: 100,
                mood: 80,
                credit: 60,
                salary: 0, // æ‰“å·¥æ”¶å…¥
                storageLevel: 1, // ä»“åº“ç­‰çº§
                maxStorage: 100,
                currentCity: 'beijing',
                homeCity: 'beijing', // æˆ¿äº§æ‰€åœ¨åŸå¸‚
                warehouseCity: 'beijing', // ä»“åº“æ‰€åœ¨åŸå¸‚ï¼ˆè·Ÿéšæˆ¿äº§ï¼‰
                ownsHouse: true, // æ˜¯å¦æ‹¥æœ‰æˆ¿äº§
                housePrices: {}, // å„åŸå¸‚å½“å‰æˆ¿ä»·ï¼ˆåŠ¨æ€æ³¢åŠ¨ï¼‰
                canMove: true,
                lockdownDays: 0,
                inventory: {}, // { itemId: { qty, totalCost } }
                prices: {}, // å½“å‰ä»·æ ¼
                prevPrices: {}, // ä¸Šæœˆä»·æ ¼ï¼ˆç”¨äºæ˜¾ç¤ºæ¶¨è·Œï¼‰
                currentEvent: null,
                eventResult: '',
                gameOverReason: '',
                // éš¾åº¦ç³»ç»Ÿæ–°å¢å­—æ®µ
                monthsWorked: 0, // å·²å·¥ä½œæœˆæ•°ï¼ˆå›°éš¾æ¨¡å¼ä¹°æˆ¿èµ„æ ¼ï¼‰
                rentMultiplier: 1, // æˆ¿ç§Ÿå€ç‡ï¼ˆå¯èƒ½æ¶¨ç§Ÿï¼‰
                familyLoan: 0, // æ¬ çˆ¶æ¯çš„é’±
                livingCost: 1500, // æ¯æœˆç”Ÿæ´»è´¹
                lastFamilyEventYear: 0, // ä¸Šæ¬¡å®¶åº­äº‹ä»¶å‘ç”Ÿçš„å¹´ä»½ï¼ˆæ¯å¹´æœ€å¤šä¸€æ¬¡ï¼‰
                lastRentIncreaseYear: 0, // ä¸Šæ¬¡æ¶¨ç§Ÿçš„å¹´ä»½ï¼ˆæ¯å¹´æœ€å¤šä¸€æ¬¡ï¼‰
            });

            // UIçŠ¶æ€
            const uiState = reactive({
                activeTab: 'market', // market, inventory, actions
                showModal: false,
                modalType: '', // buy, sell, travel, news, hospital, debt, storage, exitConfirm
                selectedItem: null,
                tradeAmount: 1,
                newsHistory: [],
                showToast: false,
                toastMessage: '',
                showExitConfirm: false, // é€€å‡ºç¡®è®¤å¼¹çª—
                showMonthTransition: false, // æœˆä»½è¿‡æ¸¡åŠ¨ç”»
            });

            // è®¡ç®—å±æ€§
            const currentDate = computed(() => {
                const monthNames = ['1æœˆ', '2æœˆ', '3æœˆ', '4æœˆ', '5æœˆ', '6æœˆ', '7æœˆ', '8æœˆ', '9æœˆ', '10æœˆ', '11æœˆ', '12æœˆ'];
                return `${gameState.year}å¹´${monthNames[(gameState.month - 1) % 12]}`;
            });

            // è®¡ç®—å‰©ä½™æœˆæ•°ï¼š2020å¹´1æœˆåˆ°2025å¹´12æœˆï¼Œå…±72ä¸ªæœˆ
            const remainingMonths = computed(() => {
                const endYear = 2025;
                const endMonth = 12;
                const monthsPassed = (gameState.year - 2020) * 12 + gameState.month;
                const totalMonths = (endYear - 2020 + 1) * 12; // 72ä¸ªæœˆ
                return Math.max(0, totalMonths - monthsPassed + 1);
            });

            const usedStorage = computed(() => {
                return Object.entries(gameState.inventory).reduce((sum, [id, data]) => {
                    const qty = data?.qty || 0;
                    return sum + (ITEMS.value[id]?.space || 0) * qty;
                }, 0);
            });

            const availableItems = computed(() => {
                // æ ¹æ®å½“å‰å¹´ä»½è¿‡æ»¤å¯ç”¨å•†å“
                return Object.entries(ITEMS.value)
                    .filter(([id, item]) => {
                        return gameState.year >= item.yearRange[0] && gameState.year <= item.yearRange[1];
                    })
                    .map(([id, item]) => ({
                        id,
                        ...item,
                        price: gameState.prices[id] || item.basePrice,
                        prevPrice: gameState.prevPrices[id] || item.basePrice,
                        change: gameState.prices[id] && gameState.prevPrices[id] 
                            ? ((gameState.prices[id] - gameState.prevPrices[id]) / gameState.prevPrices[id] * 100).toFixed(1)
                            : 0
                    }));
            });

            const inventoryItems = computed(() => {
                return Object.entries(gameState.inventory)
                    .filter(([id, data]) => data && data.qty > 0)
                    .map(([id, data]) => {
                        const currentPrice = gameState.prices[id] || ITEMS.value[id]?.basePrice || 0;
                        const totalValue = currentPrice * data.qty;
                        const avgCost = data.qty > 0 ? data.totalCost / data.qty : 0;
                        const profit = totalValue - data.totalCost;
                        const profitPercent = data.totalCost > 0 ? (profit / data.totalCost * 100) : 0;
                        return {
                            id,
                            ...ITEMS.value[id],
                            quantity: data.qty,
                            price: currentPrice,
                            avgCost: Math.floor(avgCost),
                            totalCost: data.totalCost,
                            totalValue,
                            profit,
                            profitPercent: profitPercent.toFixed(1),
                        };
                    });
            });

            const netWorth = computed(() => {
                const inventoryValue = inventoryItems.value.reduce((sum, item) => sum + item.totalValue, 0);
                const houseValue = currentHouseValue.value;
                return gameState.money + inventoryValue + houseValue - gameState.mortgageRemaining;
            });

            // åˆå§‹åŒ–ä»·æ ¼
            // åˆå§‹åŒ–æˆ¿ä»·ï¼ˆå„åŸå¸‚ï¼‰
            const initHousePrices = () => {
                Object.keys(CITY_HOUSE_VALUE.value).forEach(cityId => {
                    const basePrice = CITY_HOUSE_VALUE.value[cityId];
                    // åˆå§‹æˆ¿ä»·åœ¨åŸºå‡†ä»·æ ¼ Â±10% èŒƒå›´å†…æ³¢åŠ¨
                    // å¾·å›½æˆ¿ä»·æ³¢åŠ¨å°ï¼Œä¸­å›½æˆ¿ä»·æ³¢åŠ¨å¤§
                    const volatility = currentLang.value === 'de' ? 0.05 : 0.2;
                    const variance = 1 + (Math.random() - 0.5) * volatility;
                    gameState.housePrices[cityId] = Math.floor(basePrice * variance);
                });
            };
            
            // æ›´æ–°æˆ¿ä»·ï¼ˆæ¯æœˆï¼Œæ³¢åŠ¨å¹…åº¦è¾ƒå°ï¼‰
            // å¾·å›½æˆ¿ä»·æ³¢åŠ¨å¾ˆå°ï¼ˆÂ±2%ï¼‰ï¼Œä¸­å›½æˆ¿ä»·æ³¢åŠ¨è¾ƒå¤§ï¼ˆÂ±5%ï¼‰
            const updateHousePrices = () => {
                Object.keys(CITY_HOUSE_VALUE.value).forEach(cityId => {
                    const currentPrice = gameState.housePrices[cityId] || CITY_HOUSE_VALUE.value[cityId];
                    const basePrice = CITY_HOUSE_VALUE.value[cityId];
                    // å¾·å›½æˆ¿ä»·ç¨³å®šï¼Œä¸­å›½æˆ¿ä»·æ³¢åŠ¨å¤§
                    const volatility = currentLang.value === 'de' ? 0.02 : 0.1;
                    const variance = 1 + (Math.random() - 0.5) * volatility;
                    let newPrice = Math.floor(currentPrice * variance);
                    // é™åˆ¶åœ¨åŸºå‡†ä»·æ ¼çš„èŒƒå›´å†…ï¼ˆå¾·å›½50%-120%ï¼Œä¸­å›½50%-150%ï¼‰
                    const maxMultiplier = currentLang.value === 'de' ? 1.2 : 1.5;
                    newPrice = Math.max(basePrice * 0.5, Math.min(basePrice * maxMultiplier, newPrice));
                    gameState.housePrices[cityId] = newPrice;
                });
            };
            
            // è·å–å½“å‰æˆ¿äº§å¸‚å€¼
            const currentHouseValue = computed(() => {
                if (!gameState.ownsHouse) return 0;
                return gameState.housePrices[gameState.homeCity] || CITY_HOUSE_VALUE.value[gameState.homeCity];
            });
            
            const initPrices = () => {
                Object.entries(ITEMS.value).forEach(([id, item]) => {
                    const cityMod = CITIES.value[gameState.currentCity]?.modifier || 1;
                    // è®¾ç½®"ä¸Šæœˆ"ä»·æ ¼ï¼ˆæ¨¡æ‹Ÿä¹‹å‰çš„å¸‚åœºï¼‰
                    const prevVariance = 1 + (Math.random() - 0.5) * item.volatility;
                    gameState.prevPrices[id] = Math.floor(item.basePrice * cityMod * prevVariance);
                    // å½“å‰ä»·æ ¼æœ‰æ–°çš„æ³¢åŠ¨
                    const currVariance = 1 + (Math.random() - 0.5) * item.volatility;
                    gameState.prices[id] = Math.floor(item.basePrice * cityMod * currVariance);
                });
                // åŒæ—¶åˆå§‹åŒ–æˆ¿ä»·
                initHousePrices();
            };

            // æ›´æ–°ä»·æ ¼ï¼ˆæ¯æœˆï¼‰
            const updatePrices = () => {
                Object.entries(ITEMS.value).forEach(([id, item]) => {
                    gameState.prevPrices[id] = gameState.prices[id];
                    const cityMod = CITIES.value[gameState.currentCity]?.modifier || 1;
                    const variance = 1 + (Math.random() - 0.5) * item.volatility;
                    // ä»·æ ¼æ³¢åŠ¨ï¼Œä½†ä¸ä¼šåç¦»åŸºç¡€ä»·æ ¼å¤ªè¿œ
                    let newPrice = gameState.prices[id] * (0.7 + Math.random() * 0.6);
                    // å‘åŸºç¡€ä»·æ ¼å›å½’
                    newPrice = newPrice * 0.7 + item.basePrice * cityMod * 0.3 * variance;
                    gameState.prices[id] = Math.floor(Math.max(item.basePrice * 0.1, newPrice));
                });
            };

            // éš¾åº¦é…ç½®
            const DIFFICULTY = computed(() => getDifficulty(currentLang.value));
            const FAMILY_EVENTS = computed(() => getFamilyEvents(currentLang.value));
            
            // è·å–å½“å‰éš¾åº¦é…ç½®
            const currentDifficultyConfig = computed(() => {
                return DIFFICULTY.value[gameState.difficulty] || DIFFICULTY.value.normal;
            });
            
            // å¼€å§‹æ¸¸æˆ
            // è¿›å…¥éš¾åº¦é€‰æ‹©ç•Œé¢
            const goToDifficultySelect = () => {
                gameState.screen = 'difficultySelect';
            };
            
            // é€‰æ‹©éš¾åº¦åè¿›å…¥åŸå¸‚é€‰æ‹©
            const selectDifficulty = (diffId) => {
                gameState.difficulty = diffId;
                gameState.screen = 'citySelect';
            };
            
            // è¿”å›éš¾åº¦é€‰æ‹©
            const goBackToDifficultySelect = () => {
                gameState.screen = 'difficultySelect';
            };
            
            // è¿›å…¥åŸå¸‚é€‰æ‹©ç•Œé¢ï¼ˆå…¼å®¹æ—§ä»£ç ï¼‰
            const goToCitySelect = () => {
                goToDifficultySelect();
            };
            
            // é€‰æ‹©èµ·å§‹åŸå¸‚å¹¶å¼€å§‹æ¸¸æˆ
            const selectStartCity = (cityId) => {
                const diffConfig = DIFFICULTY.value[gameState.difficulty];
                
                // æ ¹æ®éš¾åº¦è·å–åˆå§‹å±æ€§
                const initialMoney = diffConfig.getInitialMoney(cityId);
                const salary = diffConfig.getSalary(cityId);
                const ownsHouse = diffConfig.ownsHouse;
                const storageLevel = diffConfig.storageLevel;
                const maxStorage = diffConfig.maxStorage;
                const livingCost = diffConfig.getLivingCost(cityId);
                
                // è®¡ç®—æˆ¿è´·ï¼ˆåªæœ‰ç®€å•æ¨¡å¼æœ‰æˆ¿å­æ‰æœ‰æˆ¿è´·ï¼‰
                let mortgage = 0;
                let monthlyPmt = 0;
                if (ownsHouse) {
                    const housePrice = CITY_HOUSE_VALUE.value[cityId];
                    mortgage = Math.min(housePrice, MAX_MORTGAGE.value);
                    monthlyPmt = calcMonthlyPayment(mortgage);
                }
                
                Object.assign(gameState, {
                    screen: 'playing',
                    difficulty: gameState.difficulty,
                    month: 1,
                    year: 2020,
                    money: initialMoney,
                    mortgageRemaining: mortgage,
                    mortgagePaid: 0,
                    monthlyPayment: monthlyPmt,
                    health: 100,
                    mood: diffConfig.id === 'hard' ? 60 : 80, // å›°éš¾æ¨¡å¼å¿ƒæƒ…ä½
                    credit: diffConfig.id === 'hard' ? 40 : 60, // å›°éš¾æ¨¡å¼ä¿¡ç”¨ä½
                    salary: salary,
                    storageLevel: storageLevel,
                    maxStorage: maxStorage,
                    currentCity: cityId,
                    homeCity: ownsHouse ? cityId : null,
                    warehouseCity: cityId, // ä»“åº“åœ¨å½“å‰åŸå¸‚ï¼ˆç§Ÿæˆ¿ä¹Ÿå¯ä»¥æœ‰å°ä»“åº“ï¼‰
                    ownsHouse: ownsHouse,
                    canMove: true,
                    lockdownDays: 0,
                    inventory: {},
                    currentEvent: null,
                    eventResult: '',
                    // æ–°å¢å­—æ®µ
                    monthsWorked: 0,
                    rentMultiplier: 1,
                    familyLoan: 0,
                    livingCost: livingCost,
                    lastFamilyEventYear: 0,
                    lastRentIncreaseYear: 0,
                });
                uiState.newsHistory = [];
                initPrices();
                
                // æ˜¾ç¤ºå¼€å§‹æç¤º
                const currency = t('currency');
                if (ownsHouse) {
                    const mortgageInfo = currentLang.value === 'de'
                        ? `Hypothek: ${currency}${Math.floor(mortgage/1000)}k, Rate: ${currency}${monthlyPmt.toLocaleString()}/Monat`
                        : `æˆ¿è´· ${currency}${(mortgage/10000).toFixed(0)}ä¸‡ï¼Œæœˆä¾› ${currency}${monthlyPmt.toLocaleString()}`;
                    showToast(`ğŸ  ${currentLang.value === 'de' ? 'Dein Haus in' : 'ä½ åœ¨'}${CITIES.value[cityId].name}${currentLang.value === 'de' ? '!' : 'çš„æˆ¿å­ï¼'}${mortgageInfo}`);
                } else if (diffConfig.needsRent) {
                    const rent = CITY_RENT.value[cityId];
                    showToast(`ğŸ  ${currentLang.value === 'de' ? 'WG-Zimmer in' : 'ç§Ÿäº†'}${CITIES.value[cityId].name}${currentLang.value === 'de' ? ' gemietet!' : 'çš„æˆ¿å­ï¼'}${currentLang.value === 'de' ? 'Miete' : 'æˆ¿ç§Ÿ'}: ${currency}${rent}/M`);
                } else {
                    showToast(`ğŸ  ${currentLang.value === 'de' ? 'Du wohnst bei deinen Eltern in' : 'ä½åœ¨'}${CITIES.value[cityId].name}${currentLang.value === 'de' ? '' : 'çˆ¶æ¯å®¶'}`);
                }
            };
            
            // æ—§çš„startGameä¿ç•™ç”¨äºé‡æ–°å¼€å§‹ï¼ˆé»˜è®¤åŒ—äº¬ï¼‰
            const startGame = () => {
                selectStartCity('beijing');
            };
            
            // å–æˆ¿
            const sellHouse = () => {
                if (!gameState.ownsHouse) {
                    showToast('âŒ ä½ æ²¡æœ‰æˆ¿äº§å¯å–ï¼');
                    return;
                }
                const houseValue = currentHouseValue.value;
                const netValue = houseValue - gameState.mortgageRemaining;
                
                if (netValue < 0) {
                    showToast('âŒ æˆ¿äº§ä»·å€¼ä¸è¶³ä»¥è¿˜æ¸…æˆ¿è´·ï¼');
                    return;
                }
                
                gameState.money += netValue;
                gameState.mortgageRemaining = 0;
                gameState.ownsHouse = false;
                
                showToast(`ğŸ  å–æ‰äº†${CITIES[gameState.homeCity].name}çš„æˆ¿å­ï¼Œè·å¾— Â¥${netValue.toLocaleString()}ï¼ˆæ‰£é™¤å‰©ä½™æˆ¿è´·ï¼‰`);
                closeModal();
            };
            
            // è®¡ç®—å½“æœˆä½æˆ¿æ”¯å‡º
            const monthlyHousingCost = computed(() => {
                if (gameState.ownsHouse) {
                    return gameState.monthlyPayment; // æœˆä¾›ï¼ˆæ ¹æ®è´·æ¬¾é‡‘é¢è®¡ç®—ï¼‰
                } else {
                    return CITY_RENT.value[gameState.currentCity]; // æˆ¿ç§Ÿ
                }
            });
            
            // è®¡ç®—è¿è¾“è´¹ï¼ˆä»ä»“åº“è¿åˆ°å½“å‰åŸå¸‚ï¼‰
            const needsTransport = computed(() => {
                return gameState.currentCity !== gameState.warehouseCity;
            });
            
            const calcTransportCost = (itemValue) => {
                if (!needsTransport.value) return 0;
                return Math.floor(itemValue * TRANSPORT_COST_RATE);
            };
            
            // æˆ¿äº§å‡€å€¼ï¼ˆå½“å‰å¸‚å€¼ - å‰©ä½™æˆ¿è´·ï¼‰
            const houseEquity = computed(() => {
                if (!gameState.ownsHouse) return 0;
                return currentHouseValue.value - gameState.mortgageRemaining;
            });
            
            // ä¸‹ä¸€çº§ä»“åº“å‡çº§ä¿¡æ¯
            const nextStorageUpgrade = computed(() => {
                const nextLevel = gameState.storageLevel + 1;
                return STORAGE_UPGRADES.value.find(u => u.level === nextLevel) || null;
            });
            
            const currentStorageInfo = computed(() => {
                return STORAGE_UPGRADES.value.find(u => u.level === gameState.storageLevel) || STORAGE_UPGRADES.value[0];
            });
            
            // å‡çº§ä»“åº“
            const upgradeStorage = () => {
                const upgrade = nextStorageUpgrade.value;
                if (!upgrade) {
                    showToast('ğŸ“¦ ä»“åº“å·²è¾¾æœ€é«˜çº§ï¼');
                    return;
                }
                if (gameState.money < upgrade.cost) {
                    showToast('ğŸ’° é‡‘é’±ä¸è¶³ï¼');
                    return;
                }
                gameState.money -= upgrade.cost;
                gameState.storageLevel = upgrade.level;
                gameState.maxStorage = upgrade.capacity;
                showToast(`ğŸ‰ å‡çº§æˆåŠŸï¼ä»“åº“å®¹é‡æå‡è‡³ ${upgrade.capacity} æ ¼`);
                closeModal();
            };

            // æ¨è¿›æ—¶é—´
            // å®é™…çš„æœˆä»½æ¨è¿›é€»è¾‘ï¼ˆå®šä¹‰åœ¨å‰ï¼Œä»¥ä¾¿advanceMonthå¯ä»¥è°ƒç”¨ï¼‰
            function doAdvanceMonth() {
                const diffConfig = currentDifficultyConfig.value;
                const currency = t('currency');
                
                // è®°å½•æœ¬æœˆæ”¶æ”¯æ˜ç»†
                let incomeTotal = 0;
                let expenseTotal = 0;
                let summaryParts = [];
                
                // ä½æˆ¿æ”¯å‡ºï¼šæœˆä¾›æˆ–æˆ¿ç§Ÿ
                if (gameState.ownsHouse && gameState.mortgageRemaining > 0) {
                    // æœ‰æˆ¿æœ‰è´·æ¬¾ï¼šæ‰£æœˆä¾›
                    const payment = Math.min(gameState.monthlyPayment, gameState.mortgageRemaining + Math.floor(gameState.mortgageRemaining * MONTHLY_RATE));
                    const interest = Math.floor(gameState.mortgageRemaining * MONTHLY_RATE);
                    const principal = payment - interest;
                    
                    gameState.money -= payment;
                    gameState.mortgageRemaining = Math.max(0, gameState.mortgageRemaining - principal);
                    gameState.mortgagePaid += principal;
                    expenseTotal += payment;
                    summaryParts.push(`æœˆä¾› -${currency}${payment.toLocaleString()}`);
                    
                    if (gameState.mortgageRemaining <= 0) {
                        gameState.monthlyPayment = 0;
                        showToast(currentLang.value === 'de' ? 'ğŸ‰ Hypothek abbezahlt!' : 'ğŸ‰ æ­å–œï¼æˆ¿è´·å·²è¿˜æ¸…ï¼');
                    }
                } else if (!gameState.ownsHouse && diffConfig.needsRent) {
                    // æ— æˆ¿ä¸”éœ€è¦ä»˜æˆ¿ç§Ÿï¼ˆå›°éš¾æ¨¡å¼ï¼‰
                    const baseRent = CITY_RENT.value[gameState.currentCity];
                    const rent = Math.floor(baseRent * gameState.rentMultiplier);
                    gameState.money -= rent;
                    expenseTotal += rent;
                    summaryParts.push(`æˆ¿ç§Ÿ -${currency}${rent.toLocaleString()}`);
                }
                
                // è–ªèµ„æ”¶å…¥ï¼ˆå…ˆè®¡ç®—æ”¶å…¥ï¼‰
                if (gameState.salary > 0) {
                    gameState.money += gameState.salary;
                    incomeTotal += gameState.salary;
                    gameState.monthsWorked++; // ç´¯è®¡å·¥ä½œæœˆæ•°
                    summaryParts.unshift(`ğŸ’° å·¥èµ„ +${currency}${gameState.salary.toLocaleString()}`);
                }
                
                // ç”Ÿæ´»è´¹æ”¯å‡ºï¼ˆæ ¹æ®æ”¶æ”¯æƒ…å†µå’Œç°é‡‘å‚¨å¤‡è°ƒæ•´ï¼‰
                let actualLivingCost = gameState.livingCost;
                const availableFromSalary = gameState.salary - expenseTotal; // å·¥èµ„å‡å»å·²æ‰£çš„æ”¯å‡ºï¼ˆæˆ¿ç§Ÿ/æœˆä¾›ï¼‰
                
                // è®¡ç®—ç°é‡‘å‚¨å¤‡æ˜¯å¦å……è¶³ï¼ˆèƒ½å¦æ”¯æ’‘6ä¸ªæœˆä»¥ä¸Šçš„ç”Ÿæ´»è´¹ï¼‰
                const monthsOfReserve = gameState.money / (gameState.livingCost + expenseTotal);
                const hasAmpleReserve = monthsOfReserve >= 6;
                
                // å¦‚æœå·¥èµ„ä¸å¤Ÿä½†ç°é‡‘å‚¨å¤‡å……è¶³ï¼Œç”¨ç°é‡‘è¡¥è¶³ï¼Œä¸å½±å“ç”Ÿæ´»è´¨é‡
                if (availableFromSalary < gameState.livingCost && hasAmpleReserve) {
                    // æœ‰è¶³å¤Ÿå‚¨è“„ï¼Œæ­£å¸¸ç”Ÿæ´»
                    summaryParts.push(`ç”Ÿæ´»è´¹ -${currency}${actualLivingCost.toLocaleString()}`);
                } else if (availableFromSalary < gameState.livingCost && availableFromSalary > 0 && gameState.money > gameState.livingCost * 3) {
                    // ç°é‡‘èƒ½æ’‘3ä¸ªæœˆä»¥ä¸Šï¼Œç¨å¾®çœä¸€ç‚¹ä½†ä¸å½±å“å¥åº·
                    actualLivingCost = Math.floor(gameState.livingCost * 0.9);
                    summaryParts.push(`ç”Ÿæ´»è´¹ -${currency}${actualLivingCost.toLocaleString()} (ç•¥çœ)`);
                } else if (availableFromSalary < gameState.livingCost && availableFromSalary > 0 && gameState.money > 0) {
                    // æ”¶å…¥ä¸å¤Ÿä¸”å‚¨è“„ä¸å¤šï¼Œçœåƒä¿­ç”¨
                    actualLivingCost = Math.floor(availableFromSalary * 0.8);
                    const savedAmount = gameState.livingCost - actualLivingCost;
                    const healthLoss = Math.ceil(savedAmount / 200);
                    gameState.health = Math.max(0, gameState.health - healthLoss);
                    gameState.mood = Math.max(0, gameState.mood - 5);
                    summaryParts.push(`ç”Ÿæ´»è´¹ -${currency}${actualLivingCost.toLocaleString()} âš ï¸çœåƒä¿­ç”¨ å¥åº·-${healthLoss}`);
                } else if (availableFromSalary <= 0 && gameState.money > gameState.livingCost) {
                    // å½“æœˆå·¥èµ„è¢«æ‰£å…‰äº†ä½†è¿˜æœ‰å‚¨è“„ï¼Œç”¨å‚¨è“„ç”Ÿæ´»
                    summaryParts.push(`ç”Ÿæ´»è´¹ -${currency}${actualLivingCost.toLocaleString()} (ç”¨å‚¨è“„)`);
                } else if (availableFromSalary <= 0 && gameState.money <= gameState.livingCost) {
                    // çœŸçš„æ²¡é’±äº†ï¼Œåƒä¸èµ·é¥­
                    actualLivingCost = Math.max(0, Math.floor(gameState.money * 0.5));
                    gameState.health = Math.max(0, gameState.health - 15);
                    gameState.mood = Math.max(0, gameState.mood - 20);
                    summaryParts.push(`âš ï¸ åƒä¸èµ·é¥­ï¼å¥åº·-15 å¿ƒæƒ…-20`);
                } else {
                    summaryParts.push(`ç”Ÿæ´»è´¹ -${currency}${actualLivingCost.toLocaleString()}`);
                }
                
                gameState.money -= actualLivingCost;
                expenseTotal += actualLivingCost;
                
                // æ˜¾ç¤ºæœˆåº¦ç»“ç®—æ‘˜è¦
                const netChange = incomeTotal - expenseTotal;
                const netSign = netChange >= 0 ? '+' : '';
                const summaryText = summaryParts.join(' | ') + ` â†’ å‡€${netSign}${currency}${netChange.toLocaleString()}`;
                showToast(summaryText);
                
                // å¿ƒæƒ…è‡ªç„¶æ¢å¤æœºåˆ¶
                // è®¡ç®—å‡€èµ„äº§å’Œç”Ÿæ´»è´¨é‡
                const currentNetWorth = netWorth.value;
                const monthlyExpenses = expenseTotal + gameState.livingCost;
                const financialSecurity = gameState.money / Math.max(1, monthlyExpenses); // ç°é‡‘èƒ½æ’‘å‡ ä¸ªæœˆ
                
                if (financialSecurity >= 12) {
                    // è´¢åŠ¡è‡ªç”±ï¼ˆç°é‡‘èƒ½æ’‘1å¹´+ï¼‰ï¼Œå¿ƒæƒ…å¤§å¹…æ¢å¤
                    gameState.mood = Math.min(100, gameState.mood + 8);
                } else if (financialSecurity >= 6) {
                    // è´¢åŠ¡å®‰å…¨ï¼ˆç°é‡‘èƒ½æ’‘åŠå¹´+ï¼‰ï¼Œå¿ƒæƒ…æ¢å¤
                    gameState.mood = Math.min(100, gameState.mood + 5);
                } else if (financialSecurity >= 3) {
                    // è¿˜ç®—ç¨³å®šï¼Œå¿ƒæƒ…å°å¹…æ¢å¤
                    gameState.mood = Math.min(100, gameState.mood + 2);
                } else if (currentNetWorth > 0 && gameState.health > 50) {
                    // å‡€èµ„äº§ä¸ºæ­£ä¸”å¥åº·ï¼Œå¿ƒæƒ…å¾®å¾®æ¢å¤
                    gameState.mood = Math.min(100, gameState.mood + 1);
                }
                // å¦‚æœæœ‰æˆ¿ä¸”æ— è´·æ¬¾ï¼Œé¢å¤–å¿ƒæƒ…åŠ æˆ
                if (gameState.ownsHouse && gameState.mortgageRemaining <= 0) {
                    gameState.mood = Math.min(100, gameState.mood + 3);
                }
                
                // å¥åº·è‡ªç„¶æ¢å¤ï¼ˆå¿ƒæƒ…å¥½æ—¶æ¢å¤æ›´å¤šï¼‰
                if (gameState.mood > 70) {
                    gameState.health = Math.min(100, gameState.health + 3);
                } else if (gameState.mood > 50) {
                    gameState.health = Math.min(100, gameState.health + 2);
                } else if (gameState.mood > 30) {
                    gameState.health = Math.min(100, gameState.health + 1);
                } else if (gameState.mood < 30) {
                    // å¿ƒæƒ…å¤ªå·®ä¼šé™ä½å¥åº·
                    gameState.health = Math.max(0, gameState.health - 1);
                }
                
                // æ›´æ–°æ—¶é—´
                gameState.month++;
                if (gameState.month > 12) {
                    gameState.month = 1;
                    gameState.year++;
                }
                
                // è§£é™¤å°æ§
                if (gameState.lockdownDays > 0) {
                    gameState.lockdownDays--;
                    if (gameState.lockdownDays === 0) {
                        gameState.canMove = true;
                    }
                }
                
                // æ›´æ–°å•†å“ä»·æ ¼
                updatePrices();
                
                // æ›´æ–°æˆ¿ä»·
                updateHousePrices();
                
                // æ£€æŸ¥éšæœºäº‹ä»¶
                checkRandomEvent();
                
                // å›°éš¾æ¨¡å¼ä¸“å±ï¼šå®¶åº­äº‹ä»¶
                if (diffConfig.familyEvents && !gameState.ownsHouse) {
                    checkFamilyEvent();
                }
                
                // æ£€æŸ¥æ¸¸æˆç»“æŸæ¡ä»¶
                checkGameOver();
                
                // 1ç§’åéšè—æœˆä»½è¿‡æ¸¡åŠ¨ç”»
                setTimeout(() => {
                    uiState.showMonthTransition = false;
                }, 900);
            }
            
            // ç»“æŸæœ¬æœˆï¼ˆå¸¦è¿‡æ¸¡åŠ¨ç”»çš„åŒ…è£…å‡½æ•°ï¼‰
            const advanceMonth = () => {
                // æ˜¾ç¤ºæœˆä»½è¿‡æ¸¡åŠ¨ç”»
                uiState.showMonthTransition = true;
                
                // å»¶è¿Ÿæ‰§è¡Œè®©è¿‡æ¸¡åŠ¨ç”»å…ˆæ˜¾ç¤º
                setTimeout(() => {
                    doAdvanceMonth();
                }, 100);
            };
            
            // å®¶åº­äº‹ä»¶æ£€æŸ¥ï¼ˆå›°éš¾æ¨¡å¼ï¼‰
            const checkFamilyEvent = () => {
                // æ£€æŸ¥ä»Šå¹´æ˜¯å¦å·²ç»å‘ç”Ÿè¿‡å®¶åº­äº‹ä»¶ï¼ˆå®¶é‡Œè¦é’±ç±»ï¼‰- æ¯å¹´æœ€å¤šä¸€æ¬¡
                const familyMoneyEventIds = [
                    // ä¸­æ–‡ç‰ˆ
                    'family_house', 'family_medical', 'family_wedding',
                    // å¾·è¯­ç‰ˆ
                    'eltern_hilfe', 'geschwister_ausbildung'
                ];
                // æ¶¨ç§Ÿ/è¢«èµ¶äº‹ä»¶ - æ¯å¹´æœ€å¤šä¸€æ¬¡
                const rentEventIds = ['rent_increase', 'mietsteigerung', 'eviction', 'kuendigung'];
                
                const availableEvents = FAMILY_EVENTS.value.filter(e => {
                    if (gameState.year < e.yearRange[0] || gameState.year > e.yearRange[1]) return false;
                    
                    // å®¶é‡Œè¦é’±ç±»äº‹ä»¶ï¼šæ¯å¹´æœ€å¤šä¸€æ¬¡
                    if (familyMoneyEventIds.includes(e.id) && gameState.lastFamilyEventYear === gameState.year) {
                        return false;
                    }
                    
                    // æ¶¨ç§Ÿäº‹ä»¶ï¼šæ¯å¹´æœ€å¤šä¸€æ¬¡
                    if (rentEventIds.includes(e.id) && gameState.lastRentIncreaseYear === gameState.year) {
                        return false;
                    }
                    
                    return Math.random() < e.chance;
                });
                
                if (availableEvents.length > 0 && !gameState.currentEvent) {
                    const event = availableEvents[Math.floor(Math.random() * availableEvents.length)];
                    
                    // ç‰¹æ®Šå¤„ç†ï¼šæ¶¨ç§Ÿäº‹ä»¶
                    if (event.special === 'rent_increase') {
                        gameState.rentMultiplier = Math.min(2, gameState.rentMultiplier * 1.2);
                        gameState.lastRentIncreaseYear = gameState.year; // è®°å½•æ¶¨ç§Ÿå¹´ä»½
                    }
                    
                    // è®°å½•å®¶é‡Œè¦é’±ç±»äº‹ä»¶å¹´ä»½
                    if (familyMoneyEventIds.includes(event.id)) {
                        gameState.lastFamilyEventYear = gameState.year;
                    }
                    
                    gameState.currentEvent = event;
                    gameState.eventResult = event.effect(gameState, ITEMS.value, CITY_RENT.value);
                    gameState.screen = 'event';
                    
                    // æ·»åŠ åˆ°æ–°é—»å†å²
                    uiState.newsHistory.unshift({
                        date: currentDate.value,
                        title: event.title,
                        result: gameState.eventResult
                    });
                    if (uiState.newsHistory.length > 20) {
                        uiState.newsHistory.pop();
                    }
                }
            };

            // éšæœºäº‹ä»¶æ£€æŸ¥
            // è·å–å½“å‰å¸‚åœºä¸Šå¯ä¹°åˆ°çš„å•†å“IDåˆ—è¡¨
            const getMarketItemIds = () => {
                return availableItems.value.map(item => item.id);
            };
            
            const checkRandomEvent = () => {
                // è·å–å½“å‰å¸‚åœºå•†å“åˆ—è¡¨ï¼Œç”¨äºè¿‡æ»¤äº‹ä»¶
                const marketItemIds = getMarketItemIds();
                
                const availableEvents = EVENTS.value.filter(e => {
                    if (gameState.year < e.yearRange[0] || gameState.year > e.yearRange[1]) return false;
                    if (e.condition && !e.condition(gameState)) return false;
                    // å¦‚æœäº‹ä»¶æŒ‡å®šäº†ç›®æ ‡å•†å“ï¼Œæ£€æŸ¥æ˜¯å¦åœ¨å½“å‰å¸‚åœºä¸Š
                    if (e.targetItems && e.targetItems.length > 0) {
                        const hasAnyTarget = e.targetItems.some(id => marketItemIds.includes(id));
                        if (!hasAnyTarget) return false; // ç›®æ ‡å•†å“éƒ½ä¸åœ¨å¸‚åœºä¸Šï¼Œè·³è¿‡æ­¤äº‹ä»¶
                    }
                    return Math.random() < e.chance;
                });
                
                if (availableEvents.length > 0) {
                    const event = availableEvents[Math.floor(Math.random() * availableEvents.length)];
                    // ä¼ å…¥å¸‚åœºå•†å“IDåˆ—è¡¨ï¼Œè®©effectåªå½±å“å¸‚åœºä¸Šçš„å•†å“
                    const result = event.effect(gameState, ITEMS.value, marketItemIds);
                    
                    // å¦‚æœeffectè¿”å›nullï¼Œè¯´æ˜æ²¡æœ‰å¯å½±å“çš„å•†å“ï¼Œä¸æ˜¾ç¤ºäº‹ä»¶
                    if (result === null) return;
                    
                    gameState.currentEvent = event;
                    gameState.eventResult = result;
                    gameState.screen = 'event';
                    
                    // æ·»åŠ åˆ°æ–°é—»å†å²
                    uiState.newsHistory.unshift({
                        date: currentDate.value,
                        title: event.title,
                        result: gameState.eventResult
                    });
                    if (uiState.newsHistory.length > 20) {
                        uiState.newsHistory.pop();
                    }
                }
            };

            // å…³é—­äº‹ä»¶å¼¹çª—
            const closeEvent = () => {
                gameState.screen = 'playing';
                gameState.currentEvent = null;
            };

            // æ¸¸æˆç»“æŸæ£€æŸ¥
            const checkGameOver = () => {
                const diffConfig = currentDifficultyConfig.value;
                const currency = t('currency');
                
                if (gameState.health <= 0) {
                    gameState.gameOverReason = currentLang.value === 'de' 
                        ? 'Deine Gesundheit ist am Ende...' 
                        : 'å¥åº·å€¼å½’é›¶ï¼Œä½ ç´¯å€’äº†...';
                    gameState.screen = 'gameover';
                    return;
                }
                
                // å›°éš¾æ¨¡å¼ï¼šè¿ç»­3ä¸ªæœˆä»˜ä¸èµ·æˆ¿ç§Ÿ
                if (diffConfig.needsRent && !gameState.ownsHouse) {
                    const rent = CITY_RENT.value[gameState.currentCity] * gameState.rentMultiplier;
                    if (gameState.money < -rent * 3) {
                        gameState.gameOverReason = currentLang.value === 'de'
                            ? 'Du kannst die Miete nicht mehr zahlen. ZurÃ¼ck aufs Dorf...'
                            : 'è¿ç»­ä»˜ä¸èµ·æˆ¿ç§Ÿï¼Œè¢«æˆ¿ä¸œèµ¶å‡ºå»äº†...åªèƒ½å›è€å®¶äº†';
                        gameState.screen = 'gameover';
                        return;
                    }
                }
                
                if (gameState.money < -100000 && Object.keys(gameState.inventory).length === 0 && !gameState.ownsHouse) {
                    gameState.gameOverReason = currentLang.value === 'de'
                        ? 'Du bist pleite und obdachlos...'
                        : 'ä½ ç ´äº§äº†ï¼Œæ— å®¶å¯å½’...';
                    gameState.screen = 'gameover';
                    return;
                }
                
                // æ¸¸æˆåœ¨2025å¹´12æœˆç»“æŸ
                if (gameState.year > 2025 || (gameState.year === 2025 && gameState.month > 12)) {
                    // æ ¹æ®éš¾åº¦åˆ¤æ–­èƒœåˆ©æ¡ä»¶
                    const winNetWorth = diffConfig.winNetWorth || 0;
                    
                    // ç®€å•æ¨¡å¼ï¼šè¿˜æ¸…æˆ¿è´· + å‡€èµ„äº§ > 200ä¸‡
                    // æ™®é€šæ¨¡å¼ï¼šä¹°äº†æˆ¿å¹¶è¿˜æ¸…æˆ¿è´·
                    // å›°éš¾æ¨¡å¼ï¼šä¹°äº†æˆ¿ + å‡€èµ„äº§ > 10ä¸‡
                    
                    let isWin = false;
                    let failReason = '';
                    
                    if (diffConfig.id === 'easy') {
                        isWin = gameState.mortgageRemaining <= 0 && netWorth.value >= winNetWorth;
                        if (!isWin) {
                            failReason = gameState.mortgageRemaining > 0 
                                ? `${currentLang.value === 'de' ? 'Restschuld' : 'æˆ¿è´·è¿˜å‰©'}: ${currency}${gameState.mortgageRemaining.toLocaleString()}`
                                : `${currentLang.value === 'de' ? 'NettovermÃ¶gen zu niedrig' : 'å‡€èµ„äº§ä¸è¶³'}: ${currency}${netWorth.value.toLocaleString()} < ${currency}${winNetWorth.toLocaleString()}`;
                        }
                    } else if (diffConfig.id === 'normal') {
                        isWin = gameState.ownsHouse && gameState.mortgageRemaining <= 0;
                        if (!isWin) {
                            failReason = !gameState.ownsHouse
                                ? (currentLang.value === 'de' ? 'Kein Eigentum gekauft' : 'è¿˜æ²¡ä¹°æˆ¿')
                                : `${currentLang.value === 'de' ? 'Restschuld' : 'æˆ¿è´·è¿˜å‰©'}: ${currency}${gameState.mortgageRemaining.toLocaleString()}`;
                        }
                    } else { // hard
                        isWin = gameState.ownsHouse && netWorth.value >= winNetWorth;
                        if (!isWin) {
                            failReason = !gameState.ownsHouse
                                ? (currentLang.value === 'de' ? 'Kein Eigentum gekauft' : 'è¿˜æ˜¯æ²¡èƒ½ä¹°æˆ¿...')
                                : `${currentLang.value === 'de' ? 'NettovermÃ¶gen zu niedrig' : 'å‡€èµ„äº§ä¸è¶³'}: ${currency}${netWorth.value.toLocaleString()}`;
                        }
                    }
                    
                    if (isWin) {
                        gameState.screen = 'win';
                    } else {
                        gameState.gameOverReason = `${currentLang.value === 'de' ? '6 Jahre vorbei' : '6å¹´ç»“æŸäº†'}ã€‚${failReason}`;
                        gameState.screen = 'gameover';
                    }
                }
            };
            
            // å›°éš¾/æ™®é€šæ¨¡å¼ï¼šä¹°æˆ¿åŠŸèƒ½
            const canBuyHouse = computed(() => {
                if (gameState.ownsHouse) return false;
                const diffConfig = currentDifficultyConfig.value;
                const requiredMonths = diffConfig.canBuyHouseMonths || 0;
                return gameState.monthsWorked >= requiredMonths;
            });
            
            const monthsUntilCanBuy = computed(() => {
                const diffConfig = currentDifficultyConfig.value;
                const requiredMonths = diffConfig.canBuyHouseMonths || 0;
                return Math.max(0, requiredMonths - gameState.monthsWorked);
            });
            
            const buyHouse = (cityId) => {
                if (!canBuyHouse.value) {
                    showToast(currentLang.value === 'de' 
                        ? `Noch ${monthsUntilCanBuy.value} Monate Arbeit nÃ¶tig!`
                        : `è¿˜éœ€è¦å·¥ä½œ${monthsUntilCanBuy.value}ä¸ªæœˆæ‰èƒ½ä¹°æˆ¿ï¼`);
                    return;
                }
                
                const housePrice = CITY_HOUSE_VALUE.value[cityId];
                const downPayment = Math.floor(housePrice * 0.3); // 30%é¦–ä»˜
                
                if (gameState.money < downPayment) {
                    showToast(currentLang.value === 'de'
                        ? `Anzahlung nÃ¶tig: â‚¬${downPayment.toLocaleString()}`
                        : `é¦–ä»˜éœ€è¦ Â¥${downPayment.toLocaleString()}`);
                    return;
                }
                
                const mortgage = housePrice - downPayment;
                const cappedMortgage = Math.min(mortgage, MAX_MORTGAGE.value);
                const monthlyPmt = calcMonthlyPayment(cappedMortgage);
                
                gameState.money -= downPayment;
                gameState.mortgageRemaining = cappedMortgage;
                gameState.monthlyPayment = monthlyPmt;
                gameState.ownsHouse = true;
                gameState.homeCity = cityId;
                gameState.warehouseCity = cityId;
                gameState.maxStorage = Math.max(gameState.maxStorage, 100); // ä¹°æˆ¿åä»“åº“å‡çº§
                
                showToast(currentLang.value === 'de'
                    ? `ğŸ  Haus in ${CITIES.value[cityId].name} gekauft! Hypothek: â‚¬${cappedMortgage.toLocaleString()}`
                    : `ğŸ  åœ¨${CITIES.value[cityId].name}ä¹°æˆ¿æˆåŠŸï¼æˆ¿è´· Â¥${cappedMortgage.toLocaleString()}`);
                closeModal();
            };
            
            // å‘çˆ¶æ¯å€Ÿé’±ï¼ˆæ™®é€šæ¨¡å¼ï¼‰
            const borrowFromFamily = (amount) => {
                const diffConfig = currentDifficultyConfig.value;
                if (!diffConfig.familyLoanAvailable) return;
                
                const maxLoan = diffConfig.maxFamilyLoan(gameState.currentCity) - gameState.familyLoan;
                const actualAmount = Math.min(amount, maxLoan);
                
                if (actualAmount <= 0) {
                    showToast(currentLang.value === 'de' ? 'Kein Kredit mehr mÃ¶glich' : 'å·²å€Ÿåˆ°ä¸Šé™äº†');
                    return;
                }
                
                gameState.money += actualAmount;
                gameState.familyLoan += actualAmount;
                showToast(currentLang.value === 'de'
                    ? `ğŸ’° Von Eltern geliehen: â‚¬${actualAmount.toLocaleString()}`
                    : `ğŸ’° å‘çˆ¶æ¯å€Ÿäº† Â¥${actualAmount.toLocaleString()}`);
                closeModal();
            };
            
            // è¿˜é’±ç»™çˆ¶æ¯
            const repayFamily = (amount) => {
                const actualAmount = Math.min(amount, gameState.familyLoan, gameState.money);
                if (actualAmount <= 0) return;
                
                gameState.money -= actualAmount;
                gameState.familyLoan -= actualAmount;
                showToast(currentLang.value === 'de'
                    ? `ğŸ’° Eltern zurÃ¼ckgezahlt: â‚¬${actualAmount.toLocaleString()}`
                    : `ğŸ’° è¿˜ç»™çˆ¶æ¯ Â¥${actualAmount.toLocaleString()}`);
                closeModal();
            };

            // è´­ä¹°å•†å“
            const buyItem = () => {
                const item = uiState.selectedItem;
                if (!item) return;
                
                const purchaseCost = item.price * uiState.tradeAmount;
                const totalSpace = item.space * uiState.tradeAmount;
                
                if (gameState.money < purchaseCost) {
                    showToast('ğŸ’° é‡‘é’±ä¸è¶³ï¼');
                    return;
                }
                
                if (usedStorage.value + totalSpace > gameState.maxStorage) {
                    showToast('ğŸ“¦ ä»“åº“ç©ºé—´ä¸è¶³ï¼');
                    return;
                }
                
                gameState.money -= purchaseCost;
                
                // æ›´æ–°åº“å­˜ï¼Œè·Ÿè¸ªæˆæœ¬
                if (!gameState.inventory[item.id]) {
                    gameState.inventory[item.id] = { qty: 0, totalCost: 0 };
                }
                gameState.inventory[item.id].qty += uiState.tradeAmount;
                gameState.inventory[item.id].totalCost += purchaseCost;
                
                showToast(`âœ… è´­ä¹°äº† ${uiState.tradeAmount} ä¸ª ${item.name}ï¼ŒèŠ±è´¹ Â¥${purchaseCost.toLocaleString()}`);
                closeModal();
            };

            // å‡ºå”®å•†å“
            const sellItem = () => {
                const item = uiState.selectedItem;
                if (!item) return;
                
                const invData = gameState.inventory[item.id];
                const owned = invData?.qty || 0;
                if (owned < uiState.tradeAmount) {
                    showToast('ğŸ“¦ åº“å­˜ä¸è¶³ï¼');
                    return;
                }
                
                const saleRevenue = item.price * uiState.tradeAmount;
                
                // è¿è¾“è´¹ï¼šå¦‚æœä¸åœ¨ä»“åº“åŸå¸‚å–è´§ï¼Œéœ€è¦æ”¯ä»˜è¿è¾“è´¹
                const transportCost = needsTransport.value ? calcTransportCost(saleRevenue) : 0;
                const actualRevenue = saleRevenue - transportCost;
                
                // è®¡ç®—å–å‡ºéƒ¨åˆ†çš„æˆæœ¬ï¼ˆæŒ‰æ¯”ä¾‹ï¼‰
                const costPerUnit = invData.totalCost / invData.qty;
                const soldCost = costPerUnit * uiState.tradeAmount;
                const profit = actualRevenue - soldCost;
                
                gameState.money += actualRevenue;
                gameState.inventory[item.id].qty -= uiState.tradeAmount;
                gameState.inventory[item.id].totalCost -= soldCost;
                
                if (gameState.inventory[item.id].qty <= 0) {
                    delete gameState.inventory[item.id];
                }
                
                let msg = `ğŸ’µ å–å‡º ${uiState.tradeAmount} ä¸ª ${item.name}`;
                if (transportCost > 0) {
                    msg += `ï¼ˆè¿è´¹ Â¥${transportCost.toLocaleString()}ï¼‰`;
                }
                const profitText = profit >= 0 ? `èµšäº† Â¥${Math.floor(profit).toLocaleString()}` : `äºäº† Â¥${Math.floor(-profit).toLocaleString()}`;
                showToast(`${msg}ï¼Œ${profitText}`);
                closeModal();
            };

            // åŸå¸‚ç§»åŠ¨
            const travelTo = (cityId) => {
                if (!gameState.canMove) {
                    showToast('ğŸ”’ å½“å‰æ— æ³•ç§»åŠ¨ï¼');
                    return;
                }
                
                if (cityId === gameState.currentCity) {
                    showToast('ğŸ“ ä½ å·²ç»åœ¨è¿™ä¸ªåŸå¸‚äº†ï¼');
                    return;
                }
                
                gameState.currentCity = cityId;
                showToast(`ğŸš„ å‰å¾€ ${CITIES[cityId].emoji} ${CITIES[cityId].name}`);
                closeModal();
                advanceMonth();
            };

            // å»åŒ»é™¢
            const goHospital = () => {
                // å¾·å›½åŒ»ç–—å…è´¹ï¼Krankenversicherung zahlt!
                const cost = currentLang.value === 'de' ? 0 : 5000;
                
                if (cost > 0 && gameState.money < cost) {
                    showToast('ğŸ’° é‡‘é’±ä¸è¶³ï¼');
                    return;
                }
                
                if (cost > 0) {
                    gameState.money -= cost;
                }
                gameState.health = Math.min(100, gameState.health + 40);
                
                if (currentLang.value === 'de') {
                    showToast(`ğŸ¥ Behandlung kostenlos! ğŸ‡©ğŸ‡ª Gesundheit +40`);
                } else {
                    showToast(`ğŸ¥ æ²»ç–—å®Œæˆï¼ŒèŠ±è´¹ Â¥${cost}ï¼Œå¥åº· +40`);
                }
                closeModal();
            };

            // è¿˜å€º
            // æå‰è¿˜è´·ï¼ˆé¢å¤–å¿è¿˜æˆ¿è´·æœ¬é‡‘ï¼‰
            const repayDebt = (amount) => {
                if (!gameState.ownsHouse || gameState.mortgageRemaining <= 0) {
                    showToast('âœ… ä½ æ²¡æœ‰æˆ¿è´·éœ€è¦å¿è¿˜ï¼');
                    closeModal();
                    return;
                }
                
                if (gameState.money < amount) {
                    showToast('ğŸ’° é‡‘é’±ä¸è¶³ï¼');
                    return;
                }
                
                const actualRepay = Math.min(amount, gameState.mortgageRemaining);
                gameState.money -= actualRepay;
                gameState.mortgageRemaining -= actualRepay;
                gameState.credit = Math.min(100, gameState.credit + 5);
                
                showToast(`ğŸ’³ æå‰è¿˜è´· Â¥${actualRepay.toLocaleString()}ï¼Œä¿¡ç”¨åˆ† +5`);
                
                if (gameState.mortgageRemaining <= 0) {
                    gameState.monthlyPayment = 0;
                    showToast('ğŸ‰ æ­å–œï¼æˆ¿è´·å·²å…¨éƒ¨è¿˜æ¸…ï¼');
                }
                closeModal();
            };

            // æ‰“å¼€æ¨¡æ€æ¡†
            const openModal = (type, item = null) => {
                uiState.modalType = type;
                uiState.selectedItem = item;
                uiState.tradeAmount = 1;
                uiState.showModal = true;
            };

            // å…³é—­æ¨¡æ€æ¡†
            const closeModal = () => {
                uiState.showModal = false;
                uiState.selectedItem = null;
            };

            // Toastæç¤º
            const showToast = (message) => {
                uiState.toastMessage = message;
                uiState.showToast = true;
                setTimeout(() => {
                    uiState.showToast = false;
                }, 2000);
            };
            
            // æˆªå±ä¿å­˜åŠŸèƒ½
            const saveScreenshot = async () => {
                try {
                    showToast('ğŸ“¸ æ­£åœ¨ç”Ÿæˆæˆªå›¾...');
                    
                    // è·å–æ¸¸æˆç»“æŸ/èƒœåˆ©ç”»é¢çš„å®¹å™¨
                    const targetEl = document.querySelector('#app > div');
                    if (!targetEl) {
                        showToast('âŒ æˆªå›¾å¤±è´¥');
                        return;
                    }
                    
                    const canvas = await html2canvas(targetEl, {
                        backgroundColor: '#0a0a1a',
                        scale: 2, // é«˜æ¸…æˆªå›¾
                        useCORS: true,
                        logging: false
                    });
                    
                    // è½¬æ¢ä¸ºå›¾ç‰‡å¹¶ä¸‹è½½
                    const link = document.createElement('a');
                    const timestamp = new Date().toISOString().slice(0, 19).replace(/[:-]/g, '');
                    const diffName = gameState.difficulty === 'hard' ? 'å›°éš¾' : gameState.difficulty === 'normal' ? 'æ™®é€š' : 'ç®€å•';
                    const resultName = gameState.screen === 'win' ? 'èƒœåˆ©' : 'ç»“æŸ';
                    link.download = `æµ®ç”Ÿè®°_${diffName}_${resultName}_${timestamp}.png`;
                    link.href = canvas.toDataURL('image/png');
                    link.click();
                    
                    showToast('âœ… æˆªå›¾å·²ä¿å­˜ï¼');
                } catch (err) {
                    console.error('Screenshot error:', err);
                    showToast('âŒ æˆªå›¾å¤±è´¥ï¼Œè¯·å°è¯•æ‰‹åŠ¨æˆªå›¾');
                }
            };

            // æœ€å¤§å¯è´­ä¹°æ•°é‡
            const maxBuyAmount = computed(() => {
                if (!uiState.selectedItem) return 0;
                const byMoney = Math.floor(gameState.money / uiState.selectedItem.price);
                const bySpace = uiState.selectedItem.space > 0 
                    ? Math.floor((gameState.maxStorage - usedStorage.value) / uiState.selectedItem.space)
                    : 999;
                return Math.max(0, Math.min(byMoney, bySpace));
            });

            // æœ€å¤§å¯å‡ºå”®æ•°é‡
            const maxSellAmount = computed(() => {
                if (!uiState.selectedItem) return 0;
                const invData = gameState.inventory[uiState.selectedItem.id];
                return invData?.qty || 0;
            });

            // ==================== å­˜æ¡£ç³»ç»Ÿ ====================
            const SAVE_KEY = 'modern_life_game_save';
            
            // ä¿å­˜æ¸¸æˆ
            const saveGame = () => {
                const saveData = {
                    version: 2,
                    lang: currentLang.value,
                    gameState: JSON.parse(JSON.stringify(gameState)),
                    newsHistory: uiState.newsHistory,
                    savedAt: new Date().toISOString(),
                };
                localStorage.setItem(SAVE_KEY, JSON.stringify(saveData));
                showToast(t('gameSaved'));
            };
            
            // åŠ è½½æ¸¸æˆ
            const loadGame = () => {
                const saveStr = localStorage.getItem(SAVE_KEY);
                if (!saveStr) {
                    showToast(t('noSaveFound'));
                    return false;
                }
                try {
                    const saveData = JSON.parse(saveStr);
                    // æ¢å¤è¯­è¨€è®¾ç½®
                    if (saveData.lang) {
                        currentLang.value = saveData.lang;
                        document.body.classList.toggle('bauhaus-mode', currentLang.value === 'de');
                    }
                    // æ¢å¤æ¸¸æˆçŠ¶æ€
                    Object.assign(gameState, saveData.gameState);
                    if (saveData.newsHistory) {
                        uiState.newsHistory = saveData.newsHistory;
                    }
                    showToast(t('gameLoaded'));
                    return true;
                } catch (e) {
                    console.error('Load game error:', e);
                    showToast(t('loadError'));
                    return false;
                }
            };
            
            // æ£€æŸ¥æ˜¯å¦æœ‰å­˜æ¡£
            const hasSaveGame = computed(() => {
                return !!localStorage.getItem(SAVE_KEY);
            });
            
            // åˆ é™¤å­˜æ¡£
            const deleteSave = () => {
                localStorage.removeItem(SAVE_KEY);
                showToast(t('saveDeleted'));
            };
            
            // é€€å‡ºæ¸¸æˆç›¸å…³
            const showExitConfirm = () => {
                uiState.showExitConfirm = true;
            };
            
            const hideExitConfirm = () => {
                uiState.showExitConfirm = false;
            };
            
            const exitWithSave = () => {
                saveGame();
                uiState.showExitConfirm = false;
                gameState.screen = 'start';
            };
            
            const exitWithoutSave = () => {
                uiState.showExitConfirm = false;
                gameState.screen = 'start';
            };

            return {
                gameState,
                uiState,
                currentLang,
                toggleLang,
                t,
                T,
                CITIES,
                ITEMS,
                CITY_RENT,
                CITY_HOUSE_VALUE,
                MAX_MORTGAGE,
                TRANSPORT_COST_RATE,
                DIFFICULTY,
                currentDifficultyConfig,
                currentDate,
                remainingMonths,
                usedStorage,
                availableItems,
                inventoryItems,
                netWorth,
                monthlyHousingCost,
                houseEquity,
                currentHouseValue,
                needsTransport,
                calcTransportCost,
                calcMonthlyPayment,
                maxBuyAmount,
                maxSellAmount,
                nextStorageUpgrade,
                currentStorageInfo,
                STORAGE_UPGRADES,
                canBuyHouse,
                monthsUntilCanBuy,
                goToDifficultySelect,
                selectDifficulty,
                goBackToDifficultySelect,
                goToCitySelect,
                selectStartCity,
                startGame,
                advanceMonth,
                closeEvent,
                buyItem,
                sellItem,
                sellHouse,
                buyHouse,
                borrowFromFamily,
                repayFamily,
                travelTo,
                goHospital,
                repayDebt,
                upgradeStorage,
                openModal,
                closeModal,
                showToast,
                goBackToCatalog,
                saveGame,
                loadGame,
                hasSaveGame,
                deleteSave,
                showExitConfirm,
                hideExitConfirm,
                exitWithSave,
                exitWithoutSave,
                saveScreenshot,
            };
        },

        template: `
            <div class="h-screen flex flex-col bg-cyber-dark safe-top">
                <!-- å¼€å§‹ç”»é¢ -->
                <div v-if="gameState.screen === 'start'" class="flex-1 flex flex-col items-center p-6 pt-8 bg-cyber-gradient overflow-y-auto">
                    <!-- é¡¶éƒ¨å·¥å…·æ ï¼šè¿”å›æŒ‰é’® + è¯­è¨€åˆ‡æ¢ -->
                    <div class="w-full max-w-xs flex justify-between items-center mb-4">
                        <button 
                            @click="goBackToCatalog"
                            class="px-3 py-2 rounded-lg bg-cyber-card border border-gray-600 text-sm font-bold touch-feedback text-gray-300 hover:text-white"
                        >
                            {{ t('backToCatalog') }}
                        </button>
                        <button 
                            @click="toggleLang"
                            class="px-4 py-2 rounded-lg bg-cyber-card border border-gray-600 text-sm font-bold touch-feedback flex items-center gap-2"
                        >
                            <span>{{ currentLang === 'zh' ? 'ğŸ‡¨ğŸ‡³ ä¸­æ–‡' : 'ğŸ‡©ğŸ‡ª Deutsch' }}</span>
                            <span class="text-xs text-gray-400">â†’</span>
                            <span class="text-gray-400">{{ currentLang === 'zh' ? 'ğŸ‡©ğŸ‡ª DE' : 'ğŸ‡¨ğŸ‡³ CN' }}</span>
                        </button>
                    </div>
                    
                    <div class="text-center mb-8">
                        <h1 class="font-cyber text-3xl text-cyber-cyan text-glow-cyan mb-2">{{ t('gameTitle') }}</h1>
                        <p class="text-cyber-pink text-xl font-bold">{{ t('gameSubtitle') }}</p>
                        <p class="text-cyber-yellow mt-2 text-sm italic">{{ t('gameQuote') }}</p>
                        <p class="text-gray-400 mt-3 text-sm">{{ t('gameDesc') }}</p>
                    </div>
                    
                    <div class="w-full max-w-xs space-y-4 mb-8">
                        <!-- ä¸‰ç§éš¾åº¦é¢„è§ˆ -->
                        <div class="bg-cyber-card/60 rounded-lg p-4 border border-gray-500/30">
                            <div class="grid grid-cols-3 gap-2 text-center text-xs">
                                <div class="bg-red-900/30 rounded p-2 border border-red-500/30">
                                    <span class="text-lg">ğŸ”´</span>
                                    <p class="text-red-300 font-bold mt-1">{{ currentLang === 'de' ? 'Schwer' : 'å›°éš¾' }}</p>
                                    <p class="text-gray-500">{{ currentLang === 'de' ? 'Miete' : 'ç§Ÿæˆ¿' }}</p>
                                </div>
                                <div class="bg-yellow-900/30 rounded p-2 border border-yellow-500/30">
                                    <span class="text-lg">ğŸŸ¡</span>
                                    <p class="text-yellow-300 font-bold mt-1">{{ currentLang === 'de' ? 'Normal' : 'æ™®é€š' }}</p>
                                    <p class="text-gray-500">{{ currentLang === 'de' ? 'Bei Eltern' : 'ä½å®¶' }}</p>
                                </div>
                                <div class="bg-green-900/30 rounded p-2 border border-green-500/30">
                                    <span class="text-lg">ğŸŸ¢</span>
                                    <p class="text-green-300 font-bold mt-1">{{ currentLang === 'de' ? 'Leicht' : 'ç®€å•' }}</p>
                                    <p class="text-gray-500">{{ currentLang === 'de' ? 'Eigentum' : 'æœ‰æˆ¿' }}</p>
                                </div>
                            </div>
                        </div>
                        <div class="bg-cyber-card/60 rounded-lg p-4 border border-cyber-yellow/30">
                            <div class="flex items-center gap-3">
                                <span class="text-2xl">â±ï¸</span>
                                <div>
                                    <p class="text-sm text-gray-400">{{ t('duration') }}</p>
                                    <p class="text-cyber-yellow font-bold">72{{ t('months') }}ï¼ˆ6{{ t('years') }}ï¼‰</p>
                                    <p class="text-xs text-gray-500">2020/01 â†’ 2025/12</p>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- èƒœåˆ©æ¡ä»¶è¯´æ˜ -->
                    <div class="w-full max-w-xs mb-6 bg-cyber-darker/50 rounded-lg p-4 border border-green-500/30">
                        <p class="text-green-400 font-bold text-center mb-2">ğŸ† {{ t('winConditions') }}</p>
                        <ul class="text-xs text-gray-300 space-y-1">
                            <li>âœ… {{ t('winCond1') }}</li>
                            <li>âœ… {{ t('winCond2') }}</li>
                        </ul>
                        <p class="text-red-400 font-bold text-center mt-3 mb-2">ğŸ’€ {{ t('loseConditions') }}</p>
                        <ul class="text-xs text-gray-300 space-y-1">
                            <li>âŒ {{ t('loseCond1') }}</li>
                            <li>âŒ {{ t('loseCond2') }}</li>
                            <li>âŒ {{ t('loseCond3') }}</li>
                        </ul>
                    </div>
                    
                    <!-- ç»§ç»­æ¸¸æˆæŒ‰é’®ï¼ˆå¦‚æœæœ‰å­˜æ¡£ï¼‰ -->
                    <button 
                        v-if="hasSaveGame"
                        @click="loadGame"
                        class="w-full max-w-xs py-4 rounded-lg font-bold text-lg bg-gradient-to-r from-green-500 to-green-700 text-white touch-feedback mb-3"
                    >
                        {{ t('continueGame') }}
                    </button>
                    
                    <!-- æ–°æ¸¸æˆæŒ‰é’® -->
                    <button 
                        @click="goToDifficultySelect"
                        class="w-full max-w-xs py-4 rounded-lg font-bold text-lg bg-gradient-to-r from-cyber-cyan to-cyber-purple text-black touch-feedback"
                    >
                        ğŸ® {{ hasSaveGame ? t('newGame') : t('selectDifficulty') }}
                    </button>
                    
                    <p class="text-gray-500 text-xs mt-6 mb-8 text-center">
                        {{ t('startTip') }}
                    </p>
                </div>
                
                <!-- éš¾åº¦é€‰æ‹©ç”»é¢ -->
                <div v-else-if="gameState.screen === 'difficultySelect'" class="flex-1 flex flex-col items-center p-4 pt-6 bg-cyber-gradient overflow-y-auto">
                    <!-- é¡¶éƒ¨è¿”å›æŒ‰é’® -->
                    <div class="w-full max-w-md flex justify-between items-center mb-4">
                        <button 
                            @click="gameState.screen = 'start'"
                            class="px-3 py-2 rounded-lg bg-cyber-card border border-gray-600 text-sm font-bold touch-feedback text-gray-300"
                        >
                            {{ t('back') }}
                        </button>
                        <button 
                            @click="toggleLang"
                            class="px-3 py-2 rounded-lg bg-cyber-card border border-gray-600 text-sm font-bold touch-feedback"
                        >
                            {{ currentLang === 'zh' ? 'ğŸ‡¨ğŸ‡³ ä¸­æ–‡' : 'ğŸ‡©ğŸ‡ª DE' }}
                        </button>
                    </div>
                    
                    <div class="text-center mb-6">
                        <h2 class="font-cyber text-2xl text-cyber-cyan text-glow-cyan mb-2">{{ t('selectDifficulty') }}</h2>
                        <p class="text-gray-400 text-sm">{{ t('selectDifficultyDesc') }}</p>
                    </div>
                    
                    <div class="w-full max-w-md space-y-4 mb-6">
                        <!-- å›°éš¾æ¨¡å¼ -->
                        <button 
                            @click="selectDifficulty('hard')"
                            class="w-full bg-cyber-card rounded-lg p-5 border-2 border-red-500/50 touch-feedback text-left hover:border-red-400 transition-colors"
                        >
                            <div class="flex items-center gap-3 mb-3">
                                <span class="text-3xl">{{ DIFFICULTY.hard.emoji }}</span>
                                <div>
                                    <p class="font-bold text-lg text-red-400">{{ DIFFICULTY.hard.name }}</p>
                                    <p class="text-sm text-gray-300">{{ DIFFICULTY.hard.desc }}</p>
                                </div>
                            </div>
                            <p class="text-xs text-gray-400 mb-3 italic">"{{ DIFFICULTY.hard.subtitle }}"</p>
                            <div class="grid grid-cols-2 gap-2 text-xs">
                                <div class="bg-cyber-darker rounded p-2">
                                    <span class="text-gray-500">ğŸ’° {{ t('initialFunds') }}:</span>
                                    <span class="text-red-300 ml-1">{{ t('currency') }}{{ currentLang === 'de' ? '3-5k' : '0.8-2ä¸‡' }}</span>
                                </div>
                                <div class="bg-cyber-darker rounded p-2">
                                    <span class="text-gray-500">ğŸ  {{ t('housingStatus') }}:</span>
                                    <span class="text-red-300 ml-1">{{ t('noHouse') }}</span>
                                </div>
                                <div class="bg-cyber-darker rounded p-2">
                                    <span class="text-gray-500">ğŸ’µ {{ t('salaryLabel') }}:</span>
                                    <span class="text-red-300 ml-1">{{ currentLang === 'de' ? 'â‚¬1.6-2.8k' : 'Â¥3-8k' }}/{{ currentLang === 'de' ? 'M' : 'æœˆ' }}</span>
                                </div>
                                <div class="bg-cyber-darker rounded p-2">
                                    <span class="text-gray-500">ğŸ“¦ {{ t('storageLabel') }}:</span>
                                    <span class="text-red-300 ml-1">20{{ t('slots') }}</span>
                                </div>
                            </div>
                            <p class="text-xs text-gray-500 mt-3 text-center">{{ DIFFICULTY.hard.tips }}</p>
                        </button>
                        
                        <!-- æ™®é€šæ¨¡å¼ -->
                        <button 
                            @click="selectDifficulty('normal')"
                            class="w-full bg-cyber-card rounded-lg p-5 border-2 border-yellow-500/50 touch-feedback text-left hover:border-yellow-400 transition-colors"
                        >
                            <div class="flex items-center gap-3 mb-3">
                                <span class="text-3xl">{{ DIFFICULTY.normal.emoji }}</span>
                                <div>
                                    <p class="font-bold text-lg text-yellow-400">{{ DIFFICULTY.normal.name }}</p>
                                    <p class="text-sm text-gray-300">{{ DIFFICULTY.normal.desc }}</p>
                                </div>
                            </div>
                            <p class="text-xs text-gray-400 mb-3 italic">"{{ DIFFICULTY.normal.subtitle }}"</p>
                            <div class="grid grid-cols-2 gap-2 text-xs">
                                <div class="bg-cyber-darker rounded p-2">
                                    <span class="text-gray-500">ğŸ’° {{ t('initialFunds') }}:</span>
                                    <span class="text-yellow-300 ml-1">{{ t('currency') }}{{ currentLang === 'de' ? '12-20k' : '2.5-5ä¸‡' }}</span>
                                </div>
                                <div class="bg-cyber-darker rounded p-2">
                                    <span class="text-gray-500">ğŸ  {{ t('housingStatus') }}:</span>
                                    <span class="text-yellow-300 ml-1">{{ t('livesWithParents') }}</span>
                                </div>
                                <div class="bg-cyber-darker rounded p-2">
                                    <span class="text-gray-500">ğŸ’µ {{ t('salaryLabel') }}:</span>
                                    <span class="text-yellow-300 ml-1">{{ currentLang === 'de' ? 'â‚¬2.5-4.5k' : 'Â¥4-13k' }}/{{ currentLang === 'de' ? 'M' : 'æœˆ' }}</span>
                                </div>
                                <div class="bg-cyber-darker rounded p-2">
                                    <span class="text-gray-500">ğŸ“¦ {{ t('storageLabel') }}:</span>
                                    <span class="text-yellow-300 ml-1">50{{ t('slots') }}</span>
                                </div>
                            </div>
                            <p class="text-xs text-gray-500 mt-3 text-center">{{ DIFFICULTY.normal.tips }}</p>
                        </button>
                        
                        <!-- ç®€å•æ¨¡å¼ -->
                        <button 
                            @click="selectDifficulty('easy')"
                            class="w-full bg-cyber-card rounded-lg p-5 border-2 border-green-500/50 touch-feedback text-left hover:border-green-400 transition-colors"
                        >
                            <div class="flex items-center gap-3 mb-3">
                                <span class="text-3xl">{{ DIFFICULTY.easy.emoji }}</span>
                                <div>
                                    <p class="font-bold text-lg text-green-400">{{ DIFFICULTY.easy.name }}</p>
                                    <p class="text-sm text-gray-300">{{ DIFFICULTY.easy.desc }}</p>
                                </div>
                            </div>
                            <p class="text-xs text-gray-400 mb-3 italic">"{{ DIFFICULTY.easy.subtitle }}"</p>
                            <div class="grid grid-cols-2 gap-2 text-xs">
                                <div class="bg-cyber-darker rounded p-2">
                                    <span class="text-gray-500">ğŸ’° {{ t('initialFunds') }}:</span>
                                    <span class="text-green-300 ml-1">{{ t('currency') }}{{ currentLang === 'de' ? '70-100k' : '10-20ä¸‡' }}</span>
                                </div>
                                <div class="bg-cyber-darker rounded p-2">
                                    <span class="text-gray-500">ğŸ  {{ t('housingStatus') }}:</span>
                                    <span class="text-green-300 ml-1">{{ t('hasHouseLabel') }}</span>
                                </div>
                                <div class="bg-cyber-darker rounded p-2">
                                    <span class="text-gray-500">ğŸ’µ {{ t('salaryLabel') }}:</span>
                                    <span class="text-green-300 ml-1">{{ currentLang === 'de' ? 'â‚¬4.5-8k' : 'Â¥8-35k' }}/{{ currentLang === 'de' ? 'M' : 'æœˆ' }}</span>
                                </div>
                                <div class="bg-cyber-darker rounded p-2">
                                    <span class="text-gray-500">ğŸ“¦ {{ t('storageLabel') }}:</span>
                                    <span class="text-green-300 ml-1">100{{ t('slots') }}</span>
                                </div>
                            </div>
                            <p class="text-xs text-gray-500 mt-3 text-center">{{ DIFFICULTY.easy.tips }}</p>
                        </button>
                    </div>
                </div>
                
                <!-- åŸå¸‚é€‰æ‹©ç”»é¢ -->
                <div v-else-if="gameState.screen === 'citySelect'" class="flex-1 flex flex-col items-center p-4 pt-6 bg-cyber-gradient overflow-y-auto">
                    <!-- é¡¶éƒ¨è¿”å›æŒ‰é’®å’Œéš¾åº¦æ˜¾ç¤º -->
                    <div class="w-full max-w-md flex justify-between items-center mb-4">
                        <button 
                            @click="goBackToDifficultySelect"
                            class="px-3 py-2 rounded-lg bg-cyber-card border border-gray-600 text-sm font-bold touch-feedback text-gray-300"
                        >
                            {{ t('back') }}
                        </button>
                        <div class="px-3 py-2 rounded-lg bg-cyber-card border border-gray-600 text-sm">
                            <span>{{ DIFFICULTY[gameState.difficulty].emoji }}</span>
                            <span class="ml-1 font-bold" :class="{
                                'text-red-400': gameState.difficulty === 'hard',
                                'text-yellow-400': gameState.difficulty === 'normal',
                                'text-green-400': gameState.difficulty === 'easy'
                            }">{{ DIFFICULTY[gameState.difficulty].name }}</span>
                        </div>
                    </div>
                    
                    <div class="text-center mb-6">
                        <h2 class="font-cyber text-2xl text-cyber-cyan text-glow-cyan mb-2">{{ t('selectCity') }}</h2>
                        <p class="text-gray-400 text-sm">{{ t('selectCityDesc') }}</p>
                    </div>
                    
                    <div class="w-full max-w-md grid grid-cols-2 gap-3 mb-6">
                        <button 
                            v-for="(city, id) in CITIES" 
                            :key="id"
                            @click="selectStartCity(id)"
                            class="bg-cyber-card rounded-lg p-4 border border-gray-700 touch-feedback text-left hover:border-cyber-cyan transition-colors"
                        >
                            <div class="flex items-center gap-2 mb-2">
                                <span class="text-2xl">{{ city.emoji }}</span>
                                <span class="font-bold text-cyber-cyan">{{ city.name }}</span>
                            </div>
                            <p class="text-xs text-gray-400 mb-2">{{ city.desc }}</p>
                            <div class="text-xs space-y-1">
                                <!-- æ ¹æ®éš¾åº¦æ˜¾ç¤ºä¸åŒä¿¡æ¯ -->
                                <template v-if="gameState.difficulty === 'easy'">
                                    <!-- ç®€å•æ¨¡å¼ï¼šæ˜¾ç¤ºæˆ¿ä»·å’Œæœˆä¾› -->
                                    <div class="flex justify-between">
                                        <span class="text-gray-500">{{ t('housePrice') }}</span>
                                        <span class="text-cyber-pink">{{ t('currency') }}{{ currentLang === 'de' ? Math.floor(CITY_HOUSE_VALUE[id]/1000) + 'k' : (CITY_HOUSE_VALUE[id]/10000).toFixed(0) + 'ä¸‡' }}</span>
                                    </div>
                                    <div class="flex justify-between">
                                        <span class="text-gray-500">{{ t('monthlyPayment') }}</span>
                                        <span class="text-cyber-yellow">{{ t('currency') }}{{ calcMonthlyPayment(Math.min(CITY_HOUSE_VALUE[id], MAX_MORTGAGE)).toLocaleString() }}/M</span>
                                    </div>
                                    <div class="flex justify-between">
                                        <span class="text-gray-500">{{ t('salaryLabel') }}</span>
                                        <span class="text-green-400">{{ t('currency') }}{{ DIFFICULTY.easy.getSalary(id).toLocaleString() }}/M</span>
                                    </div>
                                    <div class="flex justify-between">
                                        <span class="text-gray-500">{{ t('livingCostLabel') }}</span>
                                        <span class="text-orange-400">{{ t('currency') }}{{ DIFFICULTY.easy.getLivingCost(id).toLocaleString() }}/M</span>
                                    </div>
                                </template>
                                <template v-else-if="gameState.difficulty === 'hard'">
                                    <!-- å›°éš¾æ¨¡å¼ï¼šæ˜¾ç¤ºæˆ¿ç§Ÿå’Œå·¥èµ„ -->
                                    <div class="flex justify-between">
                                        <span class="text-gray-500">{{ t('rentLabel') }}</span>
                                        <span class="text-cyber-pink">{{ t('currency') }}{{ CITY_RENT[id].toLocaleString() }}/M</span>
                                    </div>
                                    <div class="flex justify-between">
                                        <span class="text-gray-500">{{ t('salaryLabel') }}</span>
                                        <span class="text-green-400">{{ t('currency') }}{{ DIFFICULTY.hard.getSalary(id).toLocaleString() }}/M</span>
                                    </div>
                                    <div class="flex justify-between">
                                        <span class="text-gray-500">{{ t('livingCostLabel') }}</span>
                                        <span class="text-orange-400">{{ t('currency') }}{{ DIFFICULTY.hard.getLivingCost(id).toLocaleString() }}/M</span>
                                    </div>
                                    <div class="flex justify-between">
                                        <span class="text-gray-500">{{ t('initialFunds') }}</span>
                                        <span class="text-cyber-cyan">{{ t('currency') }}{{ DIFFICULTY.hard.getInitialMoney(id).toLocaleString() }}</span>
                                    </div>
                                </template>
                                <template v-else>
                                    <!-- æ™®é€šæ¨¡å¼ï¼šä½çˆ¶æ¯å®¶ -->
                                    <div class="flex justify-between">
                                        <span class="text-gray-500">{{ t('housePrice') }}</span>
                                        <span class="text-cyber-pink">{{ t('currency') }}{{ currentLang === 'de' ? Math.floor(CITY_HOUSE_VALUE[id]/1000) + 'k' : (CITY_HOUSE_VALUE[id]/10000).toFixed(0) + 'ä¸‡' }}</span>
                                    </div>
                                    <div class="flex justify-between">
                                        <span class="text-gray-500">{{ t('salaryLabel') }}</span>
                                        <span class="text-green-400">{{ t('currency') }}{{ DIFFICULTY.normal.getSalary(id).toLocaleString() }}/M</span>
                                    </div>
                                    <div class="flex justify-between">
                                        <span class="text-gray-500">{{ t('livingCostLabel') }}</span>
                                        <span class="text-orange-400">{{ t('currency') }}{{ DIFFICULTY.normal.getLivingCost(id).toLocaleString() }}/M</span>
                                    </div>
                                    <div class="flex justify-between">
                                        <span class="text-gray-500">{{ t('initialFunds') }}</span>
                                        <span class="text-cyber-cyan">{{ t('currency') }}{{ DIFFICULTY.normal.getInitialMoney(id).toLocaleString() }}</span>
                                    </div>
                                </template>
                            </div>
                        </button>
                    </div>
                    
                    <div class="w-full max-w-md bg-cyber-darker/50 rounded-lg p-4 border border-gray-700">
                        <p class="text-xs text-gray-400 text-center">
                            <template v-if="gameState.difficulty === 'hard'">
                                âš ï¸ {{ currentLang === 'de' ? 'Miete jeden Monat! Kaufe nach 24 Monaten Arbeit ein Haus.' : 'æ¯æœˆè¦ä»˜æˆ¿ç§Ÿï¼å·¥ä½œ24ä¸ªæœˆåå¯ä»¥ä¹°æˆ¿ã€‚' }}<br>
                                ğŸ“± {{ currentLang === 'de' ? 'Familie kann jederzeit anrufen...' : 'å¯èƒ½ä¼šæ”¶åˆ°è€å®¶æ¥ç”µè¦é’±...' }}
                            </template>
                            <template v-else-if="gameState.difficulty === 'normal'">
                                ğŸ’¡ {{ currentLang === 'de' ? 'Du wohnst bei den Eltern (keine Miete). Kaufe dir dein eigenes Haus!' : 'ä½çˆ¶æ¯å®¶ä¸ç”¨æˆ¿ç§Ÿï¼Œä½†è¦é è‡ªå·±ä¹°æˆ¿ï¼' }}<br>
                                ğŸ’° {{ currentLang === 'de' ? 'Du kannst dir Geld von den Eltern leihen.' : 'å¯ä»¥å‘çˆ¶æ¯å€Ÿé’±å‡‘é¦–ä»˜ã€‚' }}
                            </template>
                            <template v-else>
                                ğŸ’¡ {{ t('cityHint') }}<br>
                                ğŸ“¦ {{ t('warehouse') }}
                            </template>
                        </p>
                    </div>
                </div>

                <!-- æ¸¸æˆä¸»ç•Œé¢ -->
                <template v-else-if="gameState.screen === 'playing'">
                    <!-- é¡¶éƒ¨çŠ¶æ€æ  -->
                    <div class="bg-cyber-card border-b border-cyber-cyan/20 p-3">
                        <div class="flex items-center justify-between mb-2">
                            <div class="flex items-center gap-2">
                                <span class="text-lg">{{ CITIES[gameState.currentCity].emoji }}</span>
                                <span class="font-bold text-cyber-cyan">{{ CITIES[gameState.currentCity].name }}</span>
                                <!-- éš¾åº¦æ ‡è¯† -->
                                <span class="px-2 py-0.5 rounded text-xs font-bold" :class="{
                                    'bg-red-900/50 text-red-300 border border-red-500/30': gameState.difficulty === 'hard',
                                    'bg-yellow-900/50 text-yellow-300 border border-yellow-500/30': gameState.difficulty === 'normal',
                                    'bg-green-900/50 text-green-300 border border-green-500/30': gameState.difficulty === 'easy'
                                }">{{ DIFFICULTY[gameState.difficulty].emoji }}</span>
                                <button @click="toggleLang" class="px-2 py-1 rounded text-xs bg-cyber-darker border border-gray-600">
                                    {{ currentLang === 'zh' ? 'ğŸ‡¨ğŸ‡³' : 'ğŸ‡©ğŸ‡ª' }}
                                </button>
                            </div>
                            <!-- æ“ä½œæŒ‰é’® + æ—¥æœŸ -->
                            <div class="flex items-center gap-2">
                                <button @click="advanceMonth" class="px-2 py-1 rounded bg-cyber-cyan/20 border border-cyber-cyan/50 touch-feedback" title="ç»“æŸæœ¬æœˆ">
                                    <span class="text-sm">â­ï¸</span>
                                </button>
                                <button @click="saveGame" class="px-2 py-1 rounded bg-green-900/30 border border-green-500/50 touch-feedback" title="ä¿å­˜">
                                    <span class="text-sm">ğŸ’¾</span>
                                </button>
                                <button @click="showExitConfirm" class="px-2 py-1 rounded bg-red-900/30 border border-red-500/50 touch-feedback" title="é€€å‡º">
                                    <span class="text-sm">ğŸšª</span>
                                </button>
                                <div class="text-right ml-1">
                                    <p class="text-sm text-cyber-yellow font-cyber">{{ currentDate }}</p>
                                    <p class="text-xs text-gray-400">{{ t('remainingMonths') }} {{ remainingMonths }} {{ t('months') }}</p>
                                </div>
                            </div>
                        </div>
                        
                        <div class="grid grid-cols-4 gap-2 text-center text-xs">
                            <div class="bg-cyber-darker rounded p-2">
                                <p class="text-gray-400">ğŸ’° {{ t('money') }}</p>
                                <p class="text-cyber-cyan font-bold truncate">{{ t('currency') }}{{ gameState.money.toLocaleString() }}</p>
                            </div>
                            <div class="bg-cyber-darker rounded p-2" :class="{
                                'border border-cyber-pink/30': gameState.ownsHouse && gameState.mortgageRemaining > 0,
                                'border border-green-500/30': gameState.ownsHouse && gameState.mortgageRemaining <= 0,
                                'border border-yellow-500/30': !gameState.ownsHouse
                            }">
                                <p class="text-gray-400">
                                    {{ gameState.ownsHouse ? 'ğŸ  ' + t('loan') : (currentDifficultyConfig.needsRent ? 'ğŸ  ' + t('rentLabel') : 'ğŸ ') }}
                                </p>
                                <p class="font-bold truncate" :class="{
                                    'text-cyber-pink': gameState.ownsHouse && gameState.mortgageRemaining > 0,
                                    'text-green-400': gameState.ownsHouse && gameState.mortgageRemaining <= 0,
                                    'text-yellow-400': !gameState.ownsHouse
                                }">
                                    <template v-if="gameState.ownsHouse">
                                        {{ gameState.mortgageRemaining > 0 ? t('currency') + (currentLang === 'de' ? Math.floor(gameState.mortgageRemaining/1000) + 'k' : (gameState.mortgageRemaining/10000).toFixed(1) + 'ä¸‡') : 'âœ…' }}
                                    </template>
                                    <template v-else-if="currentDifficultyConfig.needsRent">
                                        {{ t('currency') }}{{ Math.floor(CITY_RENT[gameState.currentCity] * gameState.rentMultiplier) }}/M
                                    </template>
                                    <template v-else>
                                        {{ t('livesWithParents') }}
                                    </template>
                                </p>
                            </div>
                            <div class="bg-cyber-darker rounded p-2">
                                <p class="text-gray-400">â¤ï¸ {{ t('health') }}</p>
                                <p :class="gameState.health < 30 ? 'text-red-500' : 'text-green-400'" class="font-bold">{{ gameState.health }}%</p>
                            </div>
                            <div class="bg-cyber-darker rounded p-2">
                                <p class="text-gray-400">ğŸ“¦ {{ t('storage') }}</p>
                                <p class="text-cyber-purple font-bold">{{ usedStorage }}/{{ gameState.maxStorage }}</p>
                            </div>
                        </div>
                        
                        <!-- å›°éš¾æ¨¡å¼é¢å¤–ä¿¡æ¯æ  -->
                        <div v-if="gameState.difficulty === 'hard' && !gameState.ownsHouse" class="mt-2 flex items-center justify-between text-xs bg-red-900/20 rounded p-2 border border-red-500/20">
                            <span class="text-gray-400">â³ {{ t('monthsWorked') }}: <span class="text-red-300 font-bold">{{ gameState.monthsWorked }}</span>{{ t('monthsUnit') }}</span>
                            <span v-if="!canBuyHouse" class="text-yellow-400">{{ currentLang === 'de' ? (monthsUntilCanBuy + 'M bis Hauskauf') : ('è·ä¹°æˆ¿èµ„æ ¼' + monthsUntilCanBuy + 'æœˆ') }}</span>
                            <span v-else class="text-green-400">âœ… {{ currentLang === 'de' ? 'Hauskauf mÃ¶glich!' : 'å¯ä»¥ä¹°æˆ¿äº†!' }}</span>
                        </div>
                        
                        <!-- æ™®é€šæ¨¡å¼ï¼šçˆ¶æ¯å€Ÿæ¬¾ä¿¡æ¯ -->
                        <div v-if="gameState.difficulty === 'normal' && gameState.familyLoan > 0" class="mt-2 flex items-center justify-between text-xs bg-yellow-900/20 rounded p-2 border border-yellow-500/20">
                            <span class="text-gray-400">{{ t('familyLoanOwed') }}: <span class="text-yellow-300 font-bold">{{ t('currency') }}{{ gameState.familyLoan.toLocaleString() }}</span></span>
                        </div>
                    </div>

                    <!-- ä¸»å†…å®¹åŒºåŸŸ -->
                    <div class="flex-1 overflow-y-auto p-3 pb-20">
                        <!-- å¸‚åœºæ ‡ç­¾ -->
                        <template v-if="uiState.activeTab === 'market'">
                            <h2 class="text-lg font-bold mb-3 flex items-center gap-2">
                                <span>ğŸª</span> {{ t('marketTitle') }}
                                <span class="text-xs text-gray-400 font-normal">ï¼ˆ{{ t('marketHint') }}ï¼‰</span>
                            </h2>
                            
                            <div class="space-y-2">
                                <div 
                                    v-for="item in availableItems" 
                                    :key="item.id"
                                    @click="openModal('buy', item)"
                                    class="item-card bg-cyber-card rounded-lg p-3 border border-gray-700/50"
                                >
                                    <div class="flex items-center justify-between">
                                        <div class="flex items-center gap-3">
                                            <span class="text-2xl">{{ item.emoji }}</span>
                                            <div>
                                                <p class="font-bold">{{ item.name }}</p>
                                                <p class="text-xs text-gray-400">{{ item.desc }}</p>
                                            </div>
                                        </div>
                                        <div class="text-right">
                                            <p class="font-bold text-cyber-cyan">{{ t('currency') }}{{ item.price.toLocaleString() }}</p>
                                            <p 
                                                class="text-xs"
                                                :class="item.change > 0 ? 'price-up' : item.change < 0 ? 'price-down' : 'text-gray-400'"
                                            >
                                                {{ item.change > 0 ? 'ğŸ“ˆ' : item.change < 0 ? 'ğŸ“‰' : 'â–' }}
                                                {{ item.change > 0 ? '+' : '' }}{{ item.change }}%
                                            </p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </template>

                        <!-- ä»“åº“æ ‡ç­¾ -->
                        <template v-else-if="uiState.activeTab === 'inventory'">
                            <h2 class="text-lg font-bold mb-3 flex items-center gap-2">
                                <span>ğŸ“¦</span> {{ t('myInventory') }}
                                <span class="text-xs text-gray-400 font-normal">ï¼ˆ{{ usedStorage }}/{{ gameState.maxStorage }}{{ t('slots') }}ï¼‰</span>
                            </h2>
                            
                            <!-- ä»“åº“ä½ç½®æç¤º -->
                            <div class="mb-3 bg-cyber-darker/50 rounded-lg p-2 text-xs">
                                <span class="text-gray-400">ğŸ“ {{ t('warehouseLocated') }}ï¼š</span>
                                <span class="text-cyber-purple font-bold">{{ CITIES[gameState.warehouseCity].name }}</span>
                                <span v-if="needsTransport" class="text-yellow-400 ml-2">
                                    âš ï¸ {{ t('currentAt') }} {{ CITIES[gameState.currentCity].name }}ï¼Œ{{ t('remoteWarning') }}
                                </span>
                            </div>
                            
                            <div v-if="inventoryItems.length === 0" class="text-center py-12 text-gray-500">
                                <p class="text-4xl mb-2">ğŸ“­</p>
                                <p>{{ t('emptyWarehouse') }}</p>
                                <p class="text-sm">{{ t('goShopping') }}</p>
                            </div>
                            
                            <div v-else class="space-y-2">
                                <div 
                                    v-for="item in inventoryItems" 
                                    :key="item.id"
                                    @click="openModal('sell', item)"
                                    class="item-card bg-cyber-card rounded-lg p-3 border border-cyber-purple/30"
                                >
                                    <div class="flex items-center justify-between mb-2">
                                        <div class="flex items-center gap-3">
                                            <span class="text-2xl">{{ item.emoji }}</span>
                                            <div>
                                                <p class="font-bold">{{ item.name }}</p>
                                                <p class="text-xs text-gray-400">{{ t('quantity') }}: {{ item.quantity }} | {{ t('space') }}: {{ item.space * item.quantity }}{{ t('slots') }}</p>
                                            </div>
                                        </div>
                                        <div class="text-right">
                                            <p class="text-xs text-gray-400">{{ t('currentPrice') }} {{ t('currency') }}{{ item.price.toLocaleString() }}</p>
                                            <p 
                                                class="text-sm font-bold"
                                                :class="item.profit >= 0 ? 'text-green-400' : 'text-red-400'"
                                            >
                                                {{ item.profit >= 0 ? 'ğŸ“ˆ' : 'ğŸ“‰' }} {{ item.profit >= 0 ? '+' : '' }}{{ item.profitPercent }}%
                                            </p>
                                        </div>
                                    </div>
                                    <div class="grid grid-cols-3 gap-2 text-xs bg-cyber-darker rounded p-2">
                                        <div class="text-center">
                                            <p class="text-gray-400">{{ t('cost') }}</p>
                                            <p class="text-cyber-pink">{{ t('currency') }}{{ item.totalCost.toLocaleString() }}</p>
                                        </div>
                                        <div class="text-center">
                                            <p class="text-gray-400">{{ t('value') }}</p>
                                            <p class="text-cyber-cyan">{{ t('currency') }}{{ item.totalValue.toLocaleString() }}</p>
                                        </div>
                                        <div class="text-center">
                                            <p class="text-gray-400">{{ t('profitLoss') }}</p>
                                            <p :class="item.profit >= 0 ? 'text-green-400' : 'text-red-400'">
                                                {{ item.profit >= 0 ? '+' : '' }}{{ t('currency') }}{{ Math.floor(item.profit).toLocaleString() }}
                                            </p>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="bg-cyber-darker rounded-lg p-3 mt-4 border border-cyber-cyan/20">
                                    <div class="flex justify-between items-center">
                                        <span class="text-gray-400">ğŸ’° {{ t('totalCostSum') }}</span>
                                        <span class="text-cyber-pink font-bold">{{ t('currency') }}{{ inventoryItems.reduce((s, i) => s + i.totalCost, 0).toLocaleString() }}</span>
                                    </div>
                                    <div class="flex justify-between items-center mt-2">
                                        <span class="text-gray-400">ğŸ’ {{ t('totalValueSum') }}</span>
                                        <span class="text-cyber-cyan font-bold">{{ t('currency') }}{{ inventoryItems.reduce((s, i) => s + i.totalValue, 0).toLocaleString() }}</span>
                                    </div>
                                    <div class="flex justify-between items-center mt-2">
                                        <span class="text-gray-400">ğŸ“Š {{ t('totalProfitLoss') }}</span>
                                        <span :class="inventoryItems.reduce((s, i) => s + i.profit, 0) >= 0 ? 'text-green-400' : 'text-red-400'" class="font-bold">
                                            {{ inventoryItems.reduce((s, i) => s + i.profit, 0) >= 0 ? '+' : '' }}{{ t('currency') }}{{ Math.floor(inventoryItems.reduce((s, i) => s + i.profit, 0)).toLocaleString() }}
                                        </span>
                                    </div>
                                    <div class="border-t border-gray-600 mt-2 pt-2 flex justify-between items-center">
                                        <span class="text-gray-400">ğŸ¦ {{ t('netWorth') }}</span>
                                        <span :class="netWorth >= 0 ? 'text-green-400' : 'text-red-400'" class="font-bold">
                                            {{ t('currency') }}{{ netWorth.toLocaleString() }}
                                        </span>
                                    </div>
                                </div>
                            </div>
                        </template>

                        <!-- æ“ä½œæ ‡ç­¾ -->
                        <template v-else-if="uiState.activeTab === 'actions'">
                            <h2 class="text-lg font-bold mb-3 flex items-center gap-2">
                                <span>âš¡</span> {{ t('actionCenter') }}
                            </h2>
                            
                            <div class="grid grid-cols-2 gap-3">
                                <button 
                                    @click="openModal('travel')"
                                    :disabled="!gameState.canMove"
                                    class="bg-cyber-card rounded-lg p-4 border border-cyber-cyan/30 touch-feedback text-left disabled:opacity-50"
                                >
                                    <span class="text-2xl block mb-2">ğŸš„</span>
                                    <p class="font-bold">{{ t('moveCity') }}</p>
                                    <p class="text-xs text-gray-400">{{ t('moveCost') }}</p>
                                </button>
                                
                                <button 
                                    @click="openModal('hospital')"
                                    class="bg-cyber-card rounded-lg p-4 border border-green-500/30 touch-feedback text-left"
                                >
                                    <span class="text-2xl block mb-2">ğŸ¥</span>
                                    <p class="font-bold">{{ t('hospital') }}</p>
                                    <p class="text-xs text-gray-400">{{ t('hospitalCost') }}</p>
                                </button>
                                
                                <button 
                                    @click="openModal('debt')"
                                    class="bg-cyber-card rounded-lg p-4 border border-cyber-pink/30 touch-feedback text-left"
                                >
                                    <span class="text-2xl block mb-2">ğŸ’³</span>
                                    <p class="font-bold">{{ t('prepayLoan') }}</p>
                                    <p class="text-xs text-gray-400">{{ t('remaining') }} {{ t('currency') }}{{ gameState.mortgageRemaining.toLocaleString() }}</p>
                                </button>
                                
                                <button 
                                    @click="openModal('news')"
                                    class="bg-cyber-card rounded-lg p-4 border border-cyber-yellow/30 touch-feedback text-left"
                                >
                                    <span class="text-2xl block mb-2">ğŸ“°</span>
                                    <p class="font-bold">{{ t('news') }}</p>
                                    <p class="text-xs text-gray-400">{{ t('newsHistory') }}</p>
                                </button>
                                
                                <button 
                                    @click="openModal('storage')"
                                    class="bg-cyber-card rounded-lg p-4 border border-cyber-purple/30 touch-feedback text-left"
                                >
                                    <span class="text-2xl block mb-2">ğŸ“¦</span>
                                    <p class="font-bold">{{ t('expandStorage') }}</p>
                                    <p class="text-xs text-gray-400">{{ currentStorageInfo.name }} ({{ gameState.maxStorage }})</p>
                                </button>
                                
                                <button 
                                    @click="openModal('housing')"
                                    class="bg-cyber-card rounded-lg p-4 border border-cyber-cyan/30 touch-feedback text-left"
                                >
                                    <span class="text-2xl block mb-2">ğŸ </span>
                                    <p class="font-bold">{{ t('housing') }}</p>
                                    <p class="text-xs text-gray-400">{{ gameState.ownsHouse ? CITIES[gameState.homeCity].name + t('yourHouse') : t('renting') }}</p>
                                </button>
                            </div>
                            
                            <!-- ä½æˆ¿çŠ¶æ€ -->
                            <div class="mt-4 bg-cyber-darker rounded-lg p-4 border border-gray-700/30">
                                <h3 class="font-bold mb-3 text-gray-300">ğŸ  {{ t('housingStatus') }}</h3>
                                <div class="space-y-2 text-sm">
                                    <div class="flex justify-between">
                                        <span class="text-gray-400">{{ t('propertyStatus') }}</span>
                                        <span :class="gameState.ownsHouse ? 'text-green-400' : 'text-yellow-400'">
                                            {{ gameState.ownsHouse ? CITIES[gameState.homeCity].name + ' ' + t('hasProperty') : t('isRenting') }}
                                        </span>
                                    </div>
                                    <div v-if="gameState.ownsHouse" class="flex justify-between">
                                        <span class="text-gray-400">{{ t('monthlyMarketValue') }}</span>
                                        <span class="text-cyber-yellow">{{ t('currency') }}{{ currentHouseValue.toLocaleString() }}</span>
                                    </div>
                                    <div v-if="gameState.ownsHouse" class="flex justify-between">
                                        <span class="text-gray-400">{{ t('remainingLoan') }}</span>
                                        <span class="text-cyber-pink">{{ t('currency') }}{{ gameState.mortgageRemaining.toLocaleString() }}</span>
                                    </div>
                                    <div class="flex justify-between">
                                        <span class="text-gray-400">{{ t('monthlyPayOrRent') }}{{ gameState.ownsHouse ? t('paymentText') : t('rentText') }}</span>
                                        <span class="text-cyber-purple">{{ t('currency') }}{{ monthlyHousingCost.toLocaleString() }}</span>
                                    </div>
                                    <div v-if="gameState.ownsHouse" class="flex justify-between">
                                        <span class="text-gray-400">{{ t('houseEquity') }}</span>
                                        <span :class="houseEquity >= 0 ? 'text-green-400' : 'text-red-400'">{{ t('currency') }}{{ houseEquity.toLocaleString() }}</span>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- çŠ¶æ€è¯¦æƒ… -->
                            <div class="mt-4 bg-cyber-darker rounded-lg p-4 border border-gray-700/30">
                                <h3 class="font-bold mb-3 text-gray-300">ğŸ“Š {{ t('otherStats') }}</h3>
                                <div class="space-y-2 text-sm">
                                    <div class="flex justify-between">
                                        <span class="text-gray-400">ğŸ˜Š {{ t('moodValue') }}</span>
                                        <span :class="gameState.mood > 50 ? 'text-green-400' : 'text-yellow-400'">{{ gameState.mood }}%</span>
                                    </div>
                                    <div class="flex justify-between">
                                        <span class="text-gray-400">â­ {{ t('creditScore') }}</span>
                                        <span :class="gameState.credit > 60 ? 'text-green-400' : 'text-red-400'">{{ gameState.credit }}</span>
                                    </div>
                                    <div class="flex justify-between">
                                        <span class="text-gray-400">ğŸ’¼ {{ t('salaryIncome') }}</span>
                                        <span class="text-cyber-cyan">{{ t('currency') }}{{ gameState.salary.toLocaleString() }}</span>
                                    </div>
                                    <div class="flex justify-between">
                                        <span class="text-gray-400">ğŸ”’ ç§»åŠ¨çŠ¶æ€</span>
                                        <span :class="gameState.canMove ? 'text-green-400' : 'text-red-400'">
                                            {{ gameState.canMove ? 'å¯ç§»åŠ¨' : 'å°æ§ä¸­(' + gameState.lockdownDays + 'æœˆ)' }}
                                        </span>
                                    </div>
                                </div>
                            </div>
                        </template>
                    </div>

                    <!-- åº•éƒ¨å¯¼èˆªæ  -->
                    <div class="fixed bottom-0 left-0 right-0 bg-cyber-card border-t border-cyber-cyan/20 safe-bottom">
                        <div class="grid grid-cols-3 h-16">
                            <button 
                                @click="uiState.activeTab = 'market'"
                                :class="uiState.activeTab === 'market' ? 'tab-active text-cyber-cyan' : 'text-gray-400'"
                                class="flex flex-col items-center justify-center touch-feedback"
                            >
                                <span class="text-xl">ğŸª</span>
                                <span class="text-xs mt-1">{{ t('market') }}</span>
                            </button>
                            <button 
                                @click="uiState.activeTab = 'inventory'"
                                :class="uiState.activeTab === 'inventory' ? 'tab-active text-cyber-cyan' : 'text-gray-400'"
                                class="flex flex-col items-center justify-center touch-feedback"
                            >
                                <span class="text-xl">ğŸ“¦</span>
                                <span class="text-xs mt-1">{{ t('inventory') }}</span>
                            </button>
                            <button 
                                @click="uiState.activeTab = 'actions'"
                                :class="uiState.activeTab === 'actions' ? 'tab-active text-cyber-cyan' : 'text-gray-400'"
                                class="flex flex-col items-center justify-center touch-feedback"
                            >
                                <span class="text-xl">âš¡</span>
                                <span class="text-xs mt-1">{{ t('actions') }}</span>
                            </button>
                        </div>
                    </div>
                    
                    <!-- é€€å‡ºç¡®è®¤å¼¹çª— -->
                    <div v-if="uiState.showExitConfirm" class="fixed inset-0 modal-backdrop z-50 flex items-center justify-center p-4">
                        <div class="bg-cyber-card rounded-xl p-6 w-full max-w-sm animate-slide-up border border-cyber-pink/30">
                            <h3 class="text-lg font-bold mb-4 text-center text-cyber-pink">ğŸšª {{ t('exitConfirmTitle') }}</h3>
                            <p class="text-gray-300 text-center mb-6">{{ t('exitConfirmMsg') }}</p>
                            <div class="space-y-3">
                                <button 
                                    @click="exitWithSave"
                                    class="w-full py-3 rounded-lg bg-green-600/50 border border-green-500 font-bold touch-feedback flex items-center justify-center gap-2"
                                >
                                    <span>ğŸ’¾</span> {{ t('exitWithSave') }}
                                </button>
                                <button 
                                    @click="exitWithoutSave"
                                    class="w-full py-3 rounded-lg bg-red-600/50 border border-red-500 font-bold touch-feedback flex items-center justify-center gap-2"
                                >
                                    <span>ğŸš«</span> {{ t('exitWithoutSave') }}
                                </button>
                                <button 
                                    @click="hideExitConfirm"
                                    class="w-full py-3 rounded-lg bg-gray-700 font-bold touch-feedback"
                                >
                                    {{ t('cancelExit') }}
                                </button>
                            </div>
                        </div>
                    </div>
                    
                    <!-- æœˆä»½è¿‡æ¸¡åŠ¨ç”» -->
                    <div v-if="uiState.showMonthTransition" class="fixed inset-0 z-[100] pointer-events-none flex items-center justify-center month-transition-overlay">
                        <div class="text-center month-transition-content">
                            <div class="text-6xl md:text-8xl font-bold text-cyber-cyan month-pulse">
                                ğŸ“…
                            </div>
                            <div class="mt-4 text-2xl md:text-4xl font-bold text-white">
                                {{ gameState.year }}å¹´ {{ gameState.month }}æœˆ
                            </div>
                            <div class="mt-2 text-lg text-cyber-cyan animate-pulse">
                                {{ currentLang === 'de' ? 'Zeit vergeht...' : 'æ—¶å…‰æµè½¬...' }}
                            </div>
                        </div>
                    </div>
                </template>

                <!-- äº‹ä»¶å¼¹çª— -->
                <div v-if="gameState.screen === 'event'" class="fixed inset-0 modal-backdrop flex items-center justify-center p-6 z-50">
                    <div class="bg-cyber-card rounded-2xl p-6 w-full max-w-sm border border-cyber-yellow/50 neon-yellow animate-slide-up">
                        <h2 class="text-xl font-bold text-center mb-4">{{ gameState.currentEvent?.title }}</h2>
                        <p class="text-gray-300 text-center mb-4">{{ gameState.currentEvent?.desc }}</p>
                        <div class="bg-cyber-darker rounded-lg p-4 mb-6">
                            <p class="text-cyber-cyan text-center font-bold">{{ gameState.eventResult }}</p>
                        </div>
                        <button 
                            @click="closeEvent"
                            class="w-full py-3 rounded-lg bg-cyber-yellow text-black font-bold touch-feedback"
                        >
                            {{ t('iKnow') }}
                        </button>
                    </div>
                </div>

                <!-- æ¨¡æ€æ¡† -->
                <div v-if="uiState.showModal" class="fixed inset-0 modal-backdrop flex items-end justify-center z-50" @click.self="closeModal">
                    <div class="bg-cyber-card rounded-t-2xl p-6 w-full max-w-lg border-t border-cyber-cyan/30 animate-slide-up safe-bottom">
                        <!-- è´­ä¹°æ¨¡æ€ -->
                        <template v-if="uiState.modalType === 'buy' && uiState.selectedItem">
                            <div class="flex items-center gap-3 mb-4">
                                <span class="text-3xl">{{ uiState.selectedItem.emoji }}</span>
                                <div>
                                    <h3 class="text-lg font-bold">{{ t('buy') }} {{ uiState.selectedItem.name }}</h3>
                                    <p class="text-sm text-gray-400">{{ t('unitPrice') }}: {{ t('currency') }}{{ uiState.selectedItem.price.toLocaleString() }} | {{ t('space') }}: {{ uiState.selectedItem.space }}{{ t('slots') }}</p>
                                </div>
                            </div>
                            
                            <div class="mb-4">
                                <div class="flex justify-between items-center mb-2">
                                    <label class="text-sm text-gray-400">{{ t('buyAmount') }}</label>
                                    <span class="text-3xl font-bold text-cyber-cyan">{{ uiState.tradeAmount }}</span>
                                </div>
                                <!-- æ»‘å—æ§åˆ¶ -->
                                <input 
                                    type="range" 
                                    v-model.number="uiState.tradeAmount" 
                                    min="1" 
                                    :max="Math.max(1, maxBuyAmount)"
                                    class="slider w-full"
                                >
                                <div class="flex justify-between items-center mt-3">
                                    <span class="text-gray-500 text-sm">1</span>
                                    <button @click="uiState.tradeAmount = maxBuyAmount" class="px-4 py-2 bg-cyber-cyan text-black font-bold rounded-lg text-sm">{{ t('buyAll') }}: {{ maxBuyAmount }}</button>
                                </div>
                            </div>
                            
                            <div class="bg-cyber-darker rounded-lg p-3 mb-4">
                                <div class="flex justify-between">
                                    <span class="text-gray-400">{{ t('totalCost') }}</span>
                                    <span class="text-cyber-pink font-bold">{{ t('currency') }}{{ (uiState.selectedItem.price * uiState.tradeAmount).toLocaleString() }}</span>
                                </div>
                                <div class="flex justify-between mt-2">
                                    <span class="text-gray-400">{{ t('availableFunds') }}</span>
                                    <span class="text-cyber-cyan">{{ t('currency') }}{{ gameState.money.toLocaleString() }}</span>
                                </div>
                            </div>
                            
                            <div class="flex gap-3">
                                <button @click="closeModal" class="flex-1 py-3 rounded-lg bg-gray-700 font-bold touch-feedback">{{ t('cancel') }}</button>
                                <button @click="buyItem" :disabled="maxBuyAmount < 1" class="flex-1 py-3 rounded-lg bg-cyber-cyan text-black font-bold touch-feedback disabled:opacity-50">{{ t('confirmBuy') }}</button>
                            </div>
                        </template>

                        <!-- å‡ºå”®æ¨¡æ€ -->
                        <template v-else-if="uiState.modalType === 'sell' && uiState.selectedItem">
                            <div class="flex items-center gap-3 mb-4">
                                <span class="text-3xl">{{ uiState.selectedItem.emoji }}</span>
                                <div>
                                    <h3 class="text-lg font-bold">{{ t('sell') }} {{ uiState.selectedItem.name }}</h3>
                                    <p class="text-sm text-gray-400">{{ t('owned') }}: {{ uiState.selectedItem.quantity }} | {{ t('avgCost') }}: {{ t('currency') }}{{ uiState.selectedItem.avgCost.toLocaleString() }}</p>
                                </div>
                            </div>
                            
                            <!-- è¿è¾“è´¹æç¤º -->
                            <div v-if="needsTransport" class="bg-yellow-900/30 rounded-lg p-3 mb-4 border border-yellow-500/30">
                                <p class="text-yellow-400 text-sm font-bold">ğŸšš {{ t('transportWarning') }}</p>
                                <p class="text-xs text-gray-400 mt-1">
                                    {{ t('warehouseAt') }} {{ CITIES[gameState.warehouseCity].name }}ï¼Œ{{ t('currentAt') }} {{ CITIES[gameState.currentCity].name }}<br>
                                    {{ t('transportRate') }} {{ (TRANSPORT_COST_RATE * 100).toFixed(0) }}%
                                </p>
                            </div>
                            
                            <div class="mb-4">
                                <div class="flex justify-between items-center mb-2">
                                    <label class="text-sm text-gray-400">{{ t('sellAmount') }}</label>
                                    <span class="text-3xl font-bold text-cyber-purple">{{ uiState.tradeAmount }}</span>
                                </div>
                                <!-- æ»‘å—æ§åˆ¶ -->
                                <input 
                                    type="range" 
                                    v-model.number="uiState.tradeAmount" 
                                    min="1" 
                                    :max="Math.max(1, maxSellAmount)"
                                    class="slider w-full"
                                >
                                <div class="flex justify-between items-center mt-3">
                                    <span class="text-gray-500 text-sm">1</span>
                                    <button @click="uiState.tradeAmount = maxSellAmount" class="px-4 py-2 bg-cyber-purple text-white font-bold rounded-lg text-sm">{{ t('sellAll') }}: {{ maxSellAmount }}</button>
                                </div>
                            </div>
                            
                            <div class="bg-cyber-darker rounded-lg p-3 mb-4 space-y-2">
                                <div class="flex justify-between text-sm">
                                    <span class="text-gray-400">{{ t('costPrice') }}</span>
                                    <span class="text-cyber-pink">{{ t('currency') }}{{ (uiState.selectedItem.avgCost * uiState.tradeAmount).toLocaleString() }}</span>
                                </div>
                                <div class="flex justify-between text-sm">
                                    <span class="text-gray-400">{{ t('sellPrice') }}</span>
                                    <span class="text-cyber-cyan">{{ t('currency') }}{{ (uiState.selectedItem.price * uiState.tradeAmount).toLocaleString() }}</span>
                                </div>
                                <div v-if="needsTransport" class="flex justify-between text-sm">
                                    <span class="text-gray-400">{{ t('transportFee') }}</span>
                                    <span class="text-yellow-400">-{{ t('currency') }}{{ calcTransportCost(uiState.selectedItem.price * uiState.tradeAmount).toLocaleString() }}</span>
                                </div>
                                <div class="border-t border-gray-600 pt-2 flex justify-between font-bold">
                                    <span class="text-gray-300">{{ t('expectedProfit') }}</span>
                                    <span :class="(uiState.selectedItem.price * (1 - (needsTransport ? TRANSPORT_COST_RATE : 0)) - uiState.selectedItem.avgCost) >= 0 ? 'text-green-400' : 'text-red-400'">
                                        {{ (uiState.selectedItem.price * (1 - (needsTransport ? TRANSPORT_COST_RATE : 0)) - uiState.selectedItem.avgCost) >= 0 ? '+' : '' }}{{ t('currency') }}{{ Math.floor((uiState.selectedItem.price * (1 - (needsTransport ? TRANSPORT_COST_RATE : 0)) - uiState.selectedItem.avgCost) * uiState.tradeAmount).toLocaleString() }}
                                    </span>
                                </div>
                            </div>
                            
                            <div class="flex gap-3">
                                <button @click="closeModal" class="flex-1 py-3 rounded-lg bg-gray-700 font-bold touch-feedback">{{ t('cancel') }}</button>
                                <button @click="sellItem" class="flex-1 py-3 rounded-lg bg-cyber-pink text-white font-bold touch-feedback">{{ t('confirmSell') }}</button>
                            </div>
                        </template>

                        <!-- ç§»åŠ¨åŸå¸‚æ¨¡æ€ -->
                        <template v-else-if="uiState.modalType === 'travel'">
                            <h3 class="text-lg font-bold mb-4 text-center">ğŸš„ {{ t('selectDestination') }}</h3>
                            <p class="text-sm text-gray-400 text-center mb-4">{{ t('travelCostTime') }}</p>
                            
                            <div class="grid grid-cols-2 gap-2 mb-4">
                                <button 
                                    v-for="(city, id) in CITIES" 
                                    :key="id"
                                    @click="travelTo(id)"
                                    :class="gameState.currentCity === id ? 'border-cyber-cyan bg-cyber-cyan/10' : 'border-gray-700'"
                                    class="p-3 rounded-lg border text-left touch-feedback"
                                >
                                    <p class="font-bold">{{ city.emoji }} {{ city.name }}</p>
                                    <p class="text-xs text-gray-400">{{ city.desc }}</p>
                                </button>
                            </div>
                            
                            <button @click="closeModal" class="w-full py-3 rounded-lg bg-gray-700 font-bold touch-feedback">{{ t('cancel') }}</button>
                        </template>

                        <!-- åŒ»é™¢æ¨¡æ€ -->
                        <template v-else-if="uiState.modalType === 'hospital'">
                            <h3 class="text-lg font-bold mb-4 text-center">ğŸ¥ {{ t('hospitalTitle2') }}</h3>
                            <div class="bg-cyber-darker rounded-lg p-4 mb-4">
                                <p class="text-center mb-2">{{ t('currentHealthIs') }}: <span class="text-cyber-cyan font-bold">{{ gameState.health }}%</span></p>
                                <p v-if="currentLang === 'de'" class="text-center text-sm text-green-400">{{ t('freeHealthcare') }}</p>
                                <p v-else class="text-center text-sm text-gray-400">{{ t('healDescription') }} {{ t('currency') }}5,000</p>
                            </div>
                            <div class="flex gap-3">
                                <button @click="closeModal" class="flex-1 py-3 rounded-lg bg-gray-700 font-bold touch-feedback">{{ t('cancel') }}</button>
                                <button @click="goHospital" class="flex-1 py-3 rounded-lg bg-green-600 font-bold touch-feedback">ğŸ’Š {{ t('heal') }}</button>
                            </div>
                        </template>

                        <!-- æå‰è¿˜è´·æ¨¡æ€ -->
                        <template v-else-if="uiState.modalType === 'debt'">
                            <h3 class="text-lg font-bold mb-4 text-center">ğŸ’³ {{ t('prepayModalTitle') }}</h3>
                            
                            <div v-if="gameState.mortgageRemaining > 0" class="bg-cyber-darker rounded-lg p-4 mb-4">
                                <div class="flex justify-between mb-2">
                                    <span class="text-gray-400">{{ t('remainingLoan') }}</span>
                                    <span class="text-cyber-pink font-bold">{{ t('currency') }}{{ gameState.mortgageRemaining.toLocaleString() }}</span>
                                </div>
                                <div class="flex justify-between mb-2 text-sm">
                                    <span class="text-gray-400">{{ t('monthlyMortgage') }}</span>
                                    <span class="text-cyber-purple">{{ t('currency') }}{{ gameState.monthlyPayment.toLocaleString() }}</span>
                                </div>
                                <div class="flex justify-between text-sm">
                                    <span class="text-gray-400">{{ t('availableFunds') }}</span>
                                    <span class="text-cyber-cyan">{{ t('currency') }}{{ gameState.money.toLocaleString() }}</span>
                                </div>
                                <div class="mt-3 pt-3 border-t border-gray-600 text-xs text-gray-400 text-center">
                                    ğŸ’¡ {{ t('prepayTip') }}
                                </div>
                            </div>
                            
                            <div v-else class="bg-green-900/30 rounded-lg p-4 mb-4 text-center">
                                <p class="text-green-400 font-bold text-xl">ğŸ‰ {{ t('loanClearedMsg') }}</p>
                                <p class="text-gray-300 text-sm mt-2">{{ t('keepEarningMsg') }}</p>
                            </div>
                            
                            <div v-if="gameState.mortgageRemaining > 0" class="grid grid-cols-2 gap-2 mb-4">
                                <button @click="repayDebt(10000)" :disabled="gameState.money < 10000" :class="gameState.money >= 10000 ? '' : 'opacity-50'" class="py-3 rounded-lg bg-cyber-darker border border-gray-700 touch-feedback text-sm">{{ t('repayPrefix') }} {{ t('currency') }}10,000</button>
                                <button @click="repayDebt(50000)" :disabled="gameState.money < 50000" :class="gameState.money >= 50000 ? '' : 'opacity-50'" class="py-3 rounded-lg bg-cyber-darker border border-gray-700 touch-feedback text-sm">{{ t('repayPrefix') }} {{ t('currency') }}50,000</button>
                                <button @click="repayDebt(100000)" :disabled="gameState.money < 100000" :class="gameState.money >= 100000 ? '' : 'opacity-50'" class="py-3 rounded-lg bg-cyber-darker border border-gray-700 touch-feedback text-sm">{{ t('repayPrefix') }} {{ t('currency') }}100,000</button>
                                <button @click="repayDebt(500000)" :disabled="gameState.money < 500000" :class="gameState.money >= 500000 ? '' : 'opacity-50'" class="py-3 rounded-lg bg-cyber-darker border border-gray-700 touch-feedback text-sm">{{ t('repayPrefix') }} {{ t('currency') }}500,000</button>
                                <button @click="repayDebt(gameState.money)" :disabled="gameState.money <= 0" class="py-3 rounded-lg bg-cyber-cyan/20 border border-cyber-cyan touch-feedback text-sm">{{ t('repayAllMy') }}({{ t('currency') }}{{ gameState.money.toLocaleString() }})</button>
                                <button @click="repayDebt(gameState.mortgageRemaining)" :disabled="gameState.money < gameState.mortgageRemaining" :class="gameState.money >= gameState.mortgageRemaining ? 'bg-green-600/30 border-green-500' : 'opacity-50'" class="py-3 rounded-lg border touch-feedback text-sm">{{ t('repayComplete') }}</button>
                            </div>
                            
                            <button @click="closeModal" class="w-full py-3 rounded-lg bg-gray-700 font-bold touch-feedback">{{ t('close') }}</button>
                        </template>
                        
                        <!-- æˆ¿äº§ç®¡ç†æ¨¡æ€ -->
                        <template v-else-if="uiState.modalType === 'housing'">
                            <h3 class="text-lg font-bold mb-4 text-center">ğŸ  {{ t('housingManage') }}</h3>
                            
                            <!-- æœ‰æˆ¿äº§çš„æƒ…å†µ -->
                            <div v-if="gameState.ownsHouse" class="space-y-4">
                                <div class="bg-cyber-darker rounded-lg p-4">
                                    <div class="flex justify-between mb-2">
                                        <span class="text-gray-400">{{ t('propertyLocation') }}</span>
                                        <span class="text-cyber-cyan font-bold">{{ CITIES[gameState.homeCity].name }}</span>
                                    </div>
                                    <div class="flex justify-between mb-2">
                                        <span class="text-gray-400">{{ t('monthlyMarketValue') }}</span>
                                        <span class="text-cyber-yellow font-bold">{{ t('currency') }}{{ currentHouseValue.toLocaleString() }}</span>
                                    </div>
                                    <div class="flex justify-between mb-2 text-xs">
                                        <span class="text-gray-500">{{ t('basePrice3') }}</span>
                                        <span class="text-gray-500">{{ t('currency') }}{{ CITY_HOUSE_VALUE[gameState.homeCity].toLocaleString() }}</span>
                                    </div>
                                    <div class="flex justify-between mb-2">
                                        <span class="text-gray-400">{{ t('remainingLoan') }}</span>
                                        <span class="text-cyber-pink font-bold">{{ t('currency') }}{{ gameState.mortgageRemaining.toLocaleString() }}</span>
                                    </div>
                                    <div class="flex justify-between mb-2">
                                        <span class="text-gray-400">{{ t('houseEquity') }}</span>
                                        <span :class="houseEquity >= 0 ? 'text-green-400' : 'text-red-400'" class="font-bold">{{ t('currency') }}{{ houseEquity.toLocaleString() }}</span>
                                    </div>
                                    <div class="flex justify-between mb-2">
                                        <span class="text-gray-400">ğŸ“¦ {{ t('warehouseLocationLabel') }}</span>
                                        <span class="text-cyber-purple font-bold">{{ CITIES[gameState.warehouseCity].name }}</span>
                                    </div>
                                    <div class="border-t border-gray-600 pt-2 mt-2">
                                        <div class="flex justify-between text-sm">
                                            <span class="text-gray-400">{{ t('monthlyMortgage') }}</span>
                                            <span class="text-cyber-purple">{{ t('currency') }}{{ gameState.monthlyPayment.toLocaleString() }}</span>
                                        </div>
                                        <p class="text-xs text-gray-500 mt-1">{{ t('loanTermsDetail') }}</p>
                                    </div>
                                </div>
                                
                                <div v-if="houseEquity > 0" class="bg-red-900/20 rounded-lg p-4 border border-red-500/30">
                                    <p class="text-sm text-gray-300 mb-3">âš ï¸ {{ t('sellHouseWarning') }}</p>
                                    <div class="flex justify-between text-xs mb-2">
                                        <span class="text-gray-400">{{ t('sellHouseProceeds') }}</span>
                                        <span class="text-green-400">{{ t('currency') }}{{ houseEquity.toLocaleString() }}</span>
                                    </div>
                                    <div class="flex justify-between text-xs mb-3">
                                        <span class="text-gray-400">{{ t('currentCityRent') }}</span>
                                        <span class="text-cyber-pink">{{ t('currency') }}{{ CITY_RENT[gameState.currentCity] }}/{{ currentLang === 'de' ? 'Monat' : 'æœˆ' }}</span>
                                    </div>
                                    <button @click="sellHouse" class="w-full py-2 rounded-lg bg-red-600/50 border border-red-500 font-bold touch-feedback text-sm">
                                        ğŸ  {{ t('sellHouseBtn') }} ({{ t('netProceedsLabel') }} {{ t('currency') }}{{ houseEquity.toLocaleString() }})
                                    </button>
                                </div>
                                <div v-else class="bg-gray-800 rounded-lg p-4 border border-gray-600">
                                    <p class="text-sm text-gray-400 text-center">âŒ {{ t('cannotSellHouse') }}</p>
                                </div>
                            </div>
                            
                            <!-- æ— æˆ¿äº§çš„æƒ…å†µ -->
                            <div v-else class="space-y-4">
                                <div class="bg-cyber-darker rounded-lg p-4">
                                    <p class="text-center text-gray-400 mb-3">ğŸ  {{ t('noPropertyNow') }}</p>
                                    <div class="flex justify-between text-sm mb-2">
                                        <span class="text-gray-400">{{ t('currentCityLabel') }}</span>
                                        <span class="text-cyber-cyan">{{ CITIES[gameState.currentCity].name }}</span>
                                    </div>
                                    <div v-if="currentDifficultyConfig.needsRent" class="flex justify-between text-sm mb-2">
                                        <span class="text-gray-400">{{ t('monthlyRentLabel') }}</span>
                                        <span class="text-cyber-pink font-bold">{{ t('currency') }}{{ Math.floor(CITY_RENT[gameState.currentCity] * gameState.rentMultiplier) }}</span>
                                        <span v-if="gameState.rentMultiplier > 1" class="text-yellow-400 text-xs">({{ t('rentMultiplier') }})</span>
                                    </div>
                                    <div v-else class="flex justify-between text-sm mb-2">
                                        <span class="text-gray-400">{{ t('housingStatus') }}</span>
                                        <span class="text-green-400">{{ t('livesWithParents') }}</span>
                                    </div>
                                    <p class="text-xs text-gray-500 mt-3 text-center">ğŸ’¡ {{ t('rentChangeHint') }}</p>
                                </div>
                                
                                <!-- ä¹°æˆ¿é€‰é¡¹ï¼ˆå›°éš¾/æ™®é€šæ¨¡å¼ï¼‰ -->
                                <div v-if="gameState.difficulty !== 'easy'" class="bg-green-900/20 rounded-lg p-4 border border-green-500/30">
                                    <h4 class="font-bold text-green-400 mb-3 text-center">ğŸ  {{ t('buyHouseBtn') }}</h4>
                                    
                                    <!-- å›°éš¾æ¨¡å¼ï¼šéœ€è¦å·¥ä½œæ»¡24ä¸ªæœˆ -->
                                    <div v-if="!canBuyHouse" class="text-center text-sm text-gray-400 mb-3">
                                        <p>â³ {{ t('monthsWorked') }}: {{ gameState.monthsWorked }}{{ t('monthsUnit') }}</p>
                                        <p class="text-xs text-yellow-400">{{ currentLang === 'de' ? ('Noch ' + monthsUntilCanBuy + ' Monate Arbeit nÃ¶tig') : ('è¿˜éœ€å·¥ä½œ' + monthsUntilCanBuy + 'ä¸ªæœˆ') }}</p>
                                    </div>
                                    
                                    <div v-else class="space-y-2">
                                        <p class="text-xs text-gray-400 text-center mb-2">{{ currentLang === 'de' ? 'WÃ¤hle eine Stadt fÃ¼r dein Haus:' : 'é€‰æ‹©ä¸€ä¸ªåŸå¸‚ä¹°æˆ¿:' }}</p>
                                        <div class="grid grid-cols-2 gap-2 max-h-40 overflow-y-auto">
                                            <button 
                                                v-for="(city, id) in CITIES" 
                                                :key="id"
                                                @click="buyHouse(id)"
                                                class="bg-cyber-card rounded p-2 border border-gray-600 text-xs touch-feedback hover:border-green-400"
                                            >
                                                <div class="flex items-center gap-1 mb-1">
                                                    <span>{{ city.emoji }}</span>
                                                    <span class="font-bold">{{ city.name }}</span>
                                                </div>
                                                <div class="text-gray-400">
                                                    {{ currentLang === 'de' ? 'Anzahlung' : 'é¦–ä»˜' }}: {{ t('currency') }}{{ Math.floor(CITY_HOUSE_VALUE[id] * 0.3).toLocaleString() }}
                                                </div>
                                            </button>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- å‘çˆ¶æ¯å€Ÿé’±ï¼ˆæ™®é€šæ¨¡å¼ï¼‰ -->
                                <div v-if="currentDifficultyConfig.familyLoanAvailable" class="bg-yellow-900/20 rounded-lg p-4 border border-yellow-500/30">
                                    <h4 class="font-bold text-yellow-400 mb-3 text-center">ğŸ’° {{ t('familyLoanBtn') }}</h4>
                                    <div class="flex justify-between text-sm mb-2">
                                        <span class="text-gray-400">{{ t('familyLoanMax') }}</span>
                                        <span class="text-yellow-300">{{ t('currency') }}{{ (currentDifficultyConfig.maxFamilyLoan(gameState.currentCity) - gameState.familyLoan).toLocaleString() }}</span>
                                    </div>
                                    <div v-if="gameState.familyLoan > 0" class="flex justify-between text-sm mb-2">
                                        <span class="text-gray-400">{{ t('familyLoanOwed') }}</span>
                                        <span class="text-red-400">{{ t('currency') }}{{ gameState.familyLoan.toLocaleString() }}</span>
                                    </div>
                                    <div class="flex gap-2 mt-3">
                                        <button 
                                            @click="borrowFromFamily(10000)"
                                            :disabled="gameState.familyLoan >= currentDifficultyConfig.maxFamilyLoan(gameState.currentCity)"
                                            class="flex-1 py-2 rounded bg-yellow-600/50 border border-yellow-500 text-sm font-bold touch-feedback disabled:opacity-50"
                                        >
                                            +{{ t('currency') }}{{ currentLang === 'de' ? '10k' : '1ä¸‡' }}
                                        </button>
                                        <button 
                                            v-if="gameState.familyLoan > 0"
                                            @click="repayFamily(gameState.familyLoan)"
                                            class="flex-1 py-2 rounded bg-green-600/50 border border-green-500 text-sm font-bold touch-feedback"
                                        >
                                            {{ t('familyLoanRepay') }}
                                        </button>
                                    </div>
                                </div>
                            </div>
                            
                            <button @click="closeModal" class="w-full py-3 rounded-lg bg-gray-700 font-bold touch-feedback mt-4">{{ t('close') }}</button>
                        </template>

                        <!-- æ–°é—»å†å²æ¨¡æ€ -->
                        <template v-else-if="uiState.modalType === 'news'">
                            <h3 class="text-lg font-bold mb-4 text-center">ğŸ“° {{ t('newsHistoryTitle') }}</h3>
                            <div class="max-h-64 overflow-y-auto mb-4">
                                <div v-if="uiState.newsHistory.length === 0" class="text-center py-8 text-gray-500">
                                    <p>{{ t('noNewsYet') }}</p>
                                </div>
                                <div v-else class="space-y-2">
                                    <div v-for="(news, index) in uiState.newsHistory" :key="index" class="bg-cyber-darker rounded-lg p-3">
                                        <p class="text-xs text-gray-400 mb-1">{{ news.date }}</p>
                                        <p class="font-bold text-sm">{{ news.title }}</p>
                                        <p class="text-xs text-cyber-cyan">{{ news.result }}</p>
                                    </div>
                                </div>
                            </div>
                            <button @click="closeModal" class="w-full py-3 rounded-lg bg-gray-700 font-bold touch-feedback">{{ t('close') }}</button>
                        </template>
                        
                        <!-- ä»“åº“å‡çº§æ¨¡æ€ -->
                        <template v-else-if="uiState.modalType === 'storage'">
                            <h3 class="text-lg font-bold mb-4 text-center">ğŸ“¦ {{ t('storageUpgradeTitle') }}</h3>
                            <div class="bg-cyber-darker rounded-lg p-4 mb-4">
                                <div class="flex justify-between mb-2">
                                    <span class="text-gray-400">{{ t('currentStorageLabel') }}</span>
                                    <span class="text-cyber-purple font-bold">{{ currentStorageInfo.name }}</span>
                                </div>
                                <div class="flex justify-between">
                                    <span class="text-gray-400">{{ t('capacityLabel') }}</span>
                                    <span class="text-cyber-cyan font-bold">{{ gameState.maxStorage }} {{ t('slots') }}</span>
                                </div>
                            </div>
                            
                            <div v-if="nextStorageUpgrade" class="mb-4">
                                <p class="text-sm text-gray-400 mb-2">{{ t('upgradeToNextLevel') }}</p>
                                <div class="bg-cyber-card rounded-lg p-4 border border-cyber-purple/30">
                                    <div class="flex justify-between mb-2">
                                        <span class="font-bold text-cyber-purple">{{ nextStorageUpgrade.name }}</span>
                                        <span class="text-cyber-cyan">{{ nextStorageUpgrade.capacity }} {{ t('slots') }}</span>
                                    </div>
                                    <div class="flex justify-between text-sm">
                                        <span class="text-gray-400">{{ t('upgradeFee') }}</span>
                                        <span class="text-cyber-pink font-bold">{{ t('currency') }}{{ nextStorageUpgrade.cost.toLocaleString() }}</span>
                                    </div>
                                </div>
                            </div>
                            <div v-else class="bg-cyber-darker rounded-lg p-4 mb-4 text-center">
                                <p class="text-cyber-cyan">ğŸ‰ {{ t('maxLevelReached') }}</p>
                            </div>
                            
                            <div class="space-y-2 mb-4 text-xs text-gray-400">
                                <p class="font-bold text-gray-300">{{ t('allStorageLevels') }}</p>
                                <div v-for="upgrade in STORAGE_UPGRADES" :key="upgrade.level" 
                                     :class="upgrade.level <= gameState.storageLevel ? 'text-cyber-cyan' : 'text-gray-500'"
                                     class="flex justify-between">
                                    <span>{{ upgrade.level === gameState.storageLevel ? 'âœ“' : '' }} {{ upgrade.name }}</span>
                                    <span>{{ upgrade.capacity }}{{ t('slots') }} / {{ t('currency') }}{{ upgrade.cost.toLocaleString() }}</span>
                                </div>
                            </div>
                            
                            <div class="flex gap-3">
                                <button @click="closeModal" class="flex-1 py-3 rounded-lg bg-gray-700 font-bold touch-feedback">{{ t('cancel') }}</button>
                                <button 
                                    v-if="nextStorageUpgrade"
                                    @click="upgradeStorage" 
                                    :disabled="gameState.money < nextStorageUpgrade.cost"
                                    :class="gameState.money >= nextStorageUpgrade.cost ? 'bg-cyber-purple' : 'bg-gray-600 opacity-50'"
                                    class="flex-1 py-3 rounded-lg font-bold touch-feedback"
                                >
                                    ğŸ’° {{ t('upgrade') }} {{ t('currency') }}{{ nextStorageUpgrade.cost.toLocaleString() }}
                                </button>
                            </div>
                        </template>
                    </div>
                </div>

                <!-- æ¸¸æˆç»“æŸç”»é¢ -->
                <div v-if="gameState.screen === 'gameover'" class="flex-1 flex flex-col items-center justify-center p-6 bg-cyber-gradient">
                    <div class="text-center mb-8">
                        <span class="text-6xl block mb-4">ğŸ’€</span>
                        <h1 class="font-cyber text-2xl text-cyber-pink text-glow-pink mb-2">æ¸¸æˆç»“æŸ</h1>
                        <p class="text-gray-300 mt-4">{{ gameState.gameOverReason }}</p>
                    </div>
                    
                    <div class="w-full max-w-xs space-y-3 mb-8">
                        <div class="bg-cyber-card/60 rounded-lg p-3 flex justify-between">
                            <span class="text-gray-400">ğŸ’° æœ€ç»ˆèµ„é‡‘</span>
                            <span class="text-cyber-cyan font-bold">{{ t('currency') }}{{ gameState.money.toLocaleString() }}</span>
                        </div>
                        <div class="bg-cyber-card/60 rounded-lg p-3 flex justify-between">
                            <span class="text-gray-400">ğŸ  å‰©ä½™æˆ¿è´·</span>
                            <span class="text-cyber-pink font-bold">{{ t('currency') }}{{ gameState.mortgageRemaining.toLocaleString() }}</span>
                        </div>
                        <div v-if="gameState.ownsHouse" class="bg-cyber-card/60 rounded-lg p-3 flex justify-between">
                            <span class="text-gray-400">ğŸ¡ æˆ¿äº§å‡€å€¼</span>
                            <span class="text-cyber-yellow font-bold">{{ t('currency') }}{{ houseEquity.toLocaleString() }}</span>
                        </div>
                        <div class="bg-cyber-card/60 rounded-lg p-3 flex justify-between">
                            <span class="text-gray-400">ğŸ“Š æ€»å‡€èµ„äº§</span>
                            <span :class="netWorth >= 0 ? 'text-green-400' : 'text-red-400'" class="font-bold">{{ t('currency') }}{{ netWorth.toLocaleString() }}</span>
                        </div>
                    </div>
                    
                    <div class="w-full max-w-xs space-y-3">
                        <button 
                            @click="saveScreenshot"
                            class="w-full py-3 rounded-lg font-bold text-lg bg-cyber-card border border-cyber-cyan text-cyber-cyan touch-feedback"
                        >
                            ğŸ“¸ ä¿å­˜è®°å½•
                        </button>
                        <button 
                            @click="goToCitySelect"
                            class="w-full py-4 rounded-lg font-bold text-lg bg-gradient-to-r from-cyber-pink to-cyber-purple text-white touch-feedback"
                        >
                            ğŸ”„ é‡æ–°å¼€å§‹
                        </button>
                    </div>
                </div>

                <!-- èƒœåˆ©ç”»é¢ -->
                <div v-if="gameState.screen === 'win'" class="flex-1 flex flex-col items-center justify-center p-6 bg-cyber-gradient">
                    <div class="text-center mb-8">
                        <span class="text-6xl block mb-4">ğŸ‰</span>
                        <h1 class="font-cyber text-2xl text-cyber-cyan text-glow-cyan mb-2">è´¢åŠ¡è‡ªç”±ï¼</h1>
                        <p class="text-gray-300 mt-4">æ­å–œä½ åœ¨6å¹´å†…è¿˜æ¸…æˆ¿è´·ï¼Œå®ç°äº†è´¢åŠ¡è‡ªç”±ï¼</p>
                    </div>
                    
                    <div class="w-full max-w-xs space-y-3 mb-8">
                        <div class="bg-cyber-card/60 rounded-lg p-3 flex justify-between">
                            <span class="text-gray-400">ğŸ’° æœ€ç»ˆèµ„é‡‘</span>
                            <span class="text-cyber-cyan font-bold">{{ t('currency') }}{{ gameState.money.toLocaleString() }}</span>
                        </div>
                        <div v-if="gameState.ownsHouse" class="bg-cyber-card/60 rounded-lg p-3 flex justify-between">
                            <span class="text-gray-400">ğŸ¡ æˆ¿äº§</span>
                            <span class="text-cyber-yellow font-bold">{{ CITIES[gameState.homeCity].name }} ({{ t('currency') }}{{ currentHouseValue.toLocaleString() }})</span>
                        </div>
                        <div class="bg-cyber-card/60 rounded-lg p-3 flex justify-between">
                            <span class="text-gray-400">ğŸ“Š æ€»å‡€èµ„äº§</span>
                            <span class="text-green-400 font-bold">{{ t('currency') }}{{ netWorth.toLocaleString() }}</span>
                        </div>
                    </div>
                    
                    <div class="w-full max-w-xs space-y-3">
                        <button 
                            @click="saveScreenshot"
                            class="w-full py-3 rounded-lg font-bold text-lg bg-cyber-card border border-cyber-yellow text-cyber-yellow touch-feedback"
                        >
                            ğŸ“¸ ä¿å­˜è®°å½•
                        </button>
                        <button 
                            @click="goToCitySelect"
                            class="w-full py-4 rounded-lg font-bold text-lg bg-gradient-to-r from-cyber-cyan to-cyber-purple text-black touch-feedback"
                        >
                            ğŸš€ å†æ¥ä¸€å±€
                        </button>
                    </div>
                </div>

                <!-- Toastæç¤º -->
                <div 
                    v-if="uiState.showToast"
                    class="fixed top-20 left-1/2 -translate-x-1/2 bg-cyber-card px-4 py-2 rounded-lg border border-cyber-cyan/50 z-50 animate-slide-up"
                >
                    <p class="text-sm">{{ uiState.toastMessage }}</p>
                </div>
            </div>
        `
    }).mount('#app');
    </script>
</body>
</html>

